<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Statistics and Machine Learning &mdash; Daniel Mo Houshmand</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sphinx-thebe.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/mo_addmination.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/mo_addmination.css" type="text/css" />
    <link rel="canonical" href="https://mohoushmand.com/data_science/stats/statML.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
        <script src="../../_static/tabs.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script src="../../_static/design-tabs.js"></script>
        <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
        <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Quantum Mechanics" href="../../quantum_information/quantum_mechanics/quantum_mechanics.html" />
    <link rel="prev" title="Data Science" href="ds.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/mo2.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/about.html">About</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Art</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../art/art.html">1. Acrylic Pouring - tegneskole.no versjon</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Applied Mathematics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../applied_mathematics/applied_math.html">Applied Mathematics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Science</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="ds.html">Data Science</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Statistics and Machine Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#visualizing-data">Visualizing data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#descriptive-statistics">Descriptive statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-normalizations-and-outliers">Data normalizations and outliers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#probability-theory">Probability theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compute-probability-mass-functions">Compute probability mass functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#section-probability-theory">SECTION: Probability theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cdfs-and-pdfs">cdf’s and pdf’s</a></li>
<li class="toctree-l2"><a class="reference internal" href="#signal-detection-theory">Signal detection theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#d-prime">d-prime</a></li>
<li class="toctree-l2"><a class="reference internal" href="#regression">Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="#clustering-and-dimension-reduction">Clustering and dimension-reduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#correlation">Correlation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#correlation-matrix">Correlation matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-t-test-family">The t-test family</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-data-note-the-different-sample-sizes">the data (note the different sample sizes)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#confidence-intervals">Confidence intervals</a></li>
<li class="toctree-l2"><a class="reference internal" href="#anova">ANOVA</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-real-world-data-journey">A real-world data journey</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quantum Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quantum_information/quantum_mechanics/quantum_mechanics.html">Quantum Mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quantum_information/quantum_computers/quantum_computers.html">The Hardware of Quantum Computers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quantum_information/quantum_computers/quantum_computers.html#anyons">Anyons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quantum_information/quantum_computers/quantum_computers.html#anyonic-quantum-computer">Anyonic Quantum Computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quantum_information/quantum_machine_learning/quantum_machine_learning.html">Quantum Machine Learning</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="ds.html">Data Science</a></li>
      <li class="breadcrumb-item active">Statistics and Machine Learning</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/data_science/stats/statML.ipynb" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="statistics-and-machine-learning">
<h1>Statistics and Machine Learning<a class="headerlink" href="#statistics-and-machine-learning" title="Permalink to this headline"></a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># import libraries</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>

<span class="n">File</span> <span class="o">~/</span><span class="n">micromamba</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">moenv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.9</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">matplotlib</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">126</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span> <span class="kn">import</span> <span class="nn">tempfile</span>
<span class="g g-Whitespace">    </span><span class="mi">124</span> <span class="kn">import</span> <span class="nn">warnings</span>
<span class="ne">--&gt; </span><span class="mi">126</span> <span class="kn">import</span> <span class="nn">numpy</span>
<span class="g g-Whitespace">    </span><span class="mi">127</span> <span class="kn">from</span> <span class="nn">packaging.version</span> <span class="kn">import</span> <span class="n">parse</span> <span class="k">as</span> <span class="n">parse_version</span>
<span class="g g-Whitespace">    </span><span class="mi">129</span> <span class="c1"># cbook must import matplotlib only within function</span>
<span class="g g-Whitespace">    </span><span class="mi">130</span> <span class="c1"># definitions, so it is safe to import from it here.</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;numpy&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## this section is for parameters that you can specify</span>

<span class="c1"># specify the averages of the two groups</span>
<span class="n">average_group1</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">average_group2</span> <span class="o">=</span> <span class="mi">45</span>

<span class="c1"># the amount of individual variability (same value for both groups)</span>
<span class="n">standard_deviation</span> <span class="o">=</span> <span class="mf">5.6</span>

<span class="c1"># sample sizes for each group</span>
<span class="n">samples_group1</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">samples_group2</span> <span class="o">=</span> <span class="mi">35</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this section generates the data (don&#39;t need to modify)</span>

<span class="c1"># generate the data</span>
<span class="n">data_group1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">samples_group1</span><span class="p">)</span><span class="o">*</span><span class="n">standard_deviation</span> <span class="o">+</span> <span class="n">average_group1</span>
<span class="n">data_group2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">samples_group2</span><span class="p">)</span><span class="o">*</span><span class="n">standard_deviation</span> <span class="o">+</span> <span class="n">average_group2</span>

<span class="c1"># convenient collection of sample sizes</span>
<span class="n">ns</span> <span class="o">=</span> <span class="p">[</span> <span class="n">samples_group1</span><span class="p">,</span> <span class="n">samples_group2</span> <span class="p">]</span>

<span class="n">datalims</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data_group1</span><span class="p">,</span><span class="n">data_group2</span><span class="p">))),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data_group1</span><span class="p">,</span><span class="n">data_group2</span><span class="p">)))]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## this section is for data visualization (don&#39;t need to modify)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">data_group1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">samples_group1</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="n">data_group1</span><span class="p">,</span><span class="s1">&#39;ko&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">datalims</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">data_group2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">samples_group2</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="n">data_group2</span><span class="p">,</span><span class="s1">&#39;ko&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">datalims</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>


<span class="c1"># 2-group t-test</span>
<span class="n">t</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">data_group1</span><span class="p">,</span><span class="n">data_group2</span><span class="p">)</span>

<span class="c1"># print the information to the title</span>
<span class="n">sigtxt</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39; NOT&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;The two groups are</span><span class="si">%s</span><span class="s1"> significantly different! t(</span><span class="si">%g</span><span class="s1">)=</span><span class="si">%g</span><span class="s1">, p=</span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">sigtxt</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">&gt;</span><span class="mf">.05</span><span class="p">)],</span><span class="nb">sum</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/95ae9e96b6458485e05b071ab8a7e871771194387a3ffb065f5b92042cdbd335.png" src="../../_images/95ae9e96b6458485e05b071ab8a7e871771194387a3ffb065f5b92042cdbd335.png" />
</div>
</div>
<section id="representing-types-of-data">
<h2>Representing types of data<a class="headerlink" href="#representing-types-of-data" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create variables of different types (classes)</span>

<span class="c1"># data numerical (here as a list)</span>
<span class="n">numdata</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">1717</span> <span class="p">]</span>

<span class="c1"># character / string</span>
<span class="n">chardata</span> <span class="o">=</span> <span class="s1">&#39;xyz&#39;</span>

<span class="c1"># double-quotes also fine</span>
<span class="n">strdata</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span>

<span class="c1"># boolean (aka logical)</span>
<span class="n">logitdata</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># notice capitalization!</span>

<span class="c1"># a list can be used like a MATLAB cell</span>
<span class="n">listdata</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">34</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;hello&#39;</span> <span class="p">,</span> <span class="mi">4</span> <span class="p">]</span>

<span class="c1"># dict (kindof similar to MATLAB structure)</span>
<span class="n">dictdata</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">dictdata</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Mike&#39;</span>
<span class="n">dictdata</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">dictdata</span><span class="p">[</span><span class="s1">&#39;occupation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Nerdoscientist&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s see what the workspace looks like</span>
<span class="o">%</span><span class="k">whos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variable    Type    Data/Info
-----------------------------
chardata    str     xyz
dictdata    dict    n=3
listdata    list    n=3
logitdata   bool    True
numdata     list    n=4
strdata     str     x
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># clear the Python workspace</span>
<span class="o">%</span><span class="k">reset</span> -sf
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="visualizing-data">
<h1>Visualizing data<a class="headerlink" href="#visualizing-data" title="Permalink to this headline"></a></h1>
<section id="line-plots">
<h2>Line Plots<a class="headerlink" href="#line-plots" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create data for the plot</span>

<span class="c1"># number of data points</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># generate log-normal distribution</span>
<span class="n">data1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span>
<span class="n">data2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span> <span class="p">)</span>
<span class="n">data3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## plots of their histograms</span>

<span class="c1"># number of histogram bins</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data3</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/520d445241b2d39ca6baa49e412edfc3aa290e9e3b9a6bab4a7f4dd9badec5de.png" src="../../_images/520d445241b2d39ca6baa49e412edfc3aa290e9e3b9a6bab4a7f4dd9badec5de.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># histogram discretization for the datasets</span>
<span class="n">y1</span><span class="p">,</span><span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="n">xx1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span> <span class="c1"># convert to probability</span>

<span class="n">y2</span><span class="p">,</span><span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="n">xx2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span> <span class="c1"># convert to probability</span>

<span class="n">y3</span><span class="p">,</span><span class="n">x3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data3</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="n">xx3</span> <span class="o">=</span> <span class="p">(</span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">y3</span> <span class="o">=</span> <span class="n">y3</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y3</span><span class="p">)</span> <span class="c1"># convert to probability</span>



<span class="c1"># show the plots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;s-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;data1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="s1">&#39;o-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;data2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx3</span><span class="p">,</span><span class="n">y3</span><span class="p">,</span><span class="s1">&#39;^-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;data3&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/13923ddae00c20a21cd977ad401e0c99c3e4b9fbbe5faa6242ef535b731fc708.png" src="../../_images/13923ddae00c20a21cd977ad401e0c99c3e4b9fbbe5faa6242ef535b731fc708.png" />
</div>
</div>
</section>
<section id="pie-charts">
<h2>Pie charts<a class="headerlink" href="#pie-charts" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create data for the plot</span>

<span class="n">nbins</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">totalN</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">rawdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nbins</span><span class="o">-</span><span class="mf">.01</span><span class="p">),</span><span class="n">totalN</span><span class="p">))</span>


<span class="c1"># prepare data for pie chart</span>
<span class="n">uniquenums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">rawdata</span><span class="p">)</span>
<span class="n">data4pie</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniquenums</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniquenums</span><span class="p">)):</span>
    <span class="n">data4pie</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">rawdata</span><span class="o">==</span><span class="n">uniquenums</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create data for the plot</span>

<span class="n">nbins</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">totalN</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">rawdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nbins</span><span class="o">-</span><span class="mf">.01</span><span class="p">),</span><span class="n">totalN</span><span class="p">))</span>


<span class="c1"># prepare data for pie chart</span>
<span class="n">uniquenums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">rawdata</span><span class="p">)</span>
<span class="n">data4pie</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniquenums</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniquenums</span><span class="p">)):</span>
    <span class="n">data4pie</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">rawdata</span><span class="o">==</span><span class="n">uniquenums</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create data for the plot</span>

<span class="n">nbins</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">totalN</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">rawdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nbins</span><span class="o">-</span><span class="mf">.01</span><span class="p">),</span><span class="n">totalN</span><span class="p">))</span>


<span class="c1"># prepare data for pie chart</span>
<span class="n">uniquenums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">rawdata</span><span class="p">)</span>
<span class="n">data4pie</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniquenums</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniquenums</span><span class="p">)):</span>
    <span class="n">data4pie</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">rawdata</span><span class="o">==</span><span class="n">uniquenums</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># show the pie chart</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">data4pie</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">data4pie</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">data4pie</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e9f51c0079fea4ad5aba3b9782dbb2e45cd2710bc3e6d50e477a360f70ec287d.png" src="../../_images/e9f51c0079fea4ad5aba3b9782dbb2e45cd2710bc3e6d50e477a360f70ec287d.png" />
</div>
</div>
</section>
<section id="histograms">
<h2>Histograms<a class="headerlink" href="#histograms" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create data for the histogram</span>

<span class="c1"># number of data points</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># generate data - log-normal distribution</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># show as a histogram</span>

<span class="c1"># number of histogram bins</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">40</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/74587c62a4ac54a8320fb6b22b058c6126f39ac9634d207dd7722ee7035cb404.png" src="../../_images/74587c62a4ac54a8320fb6b22b058c6126f39ac9634d207dd7722ee7035cb404.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># another option</span>
<span class="n">y</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>

<span class="c1"># bin centers</span>
<span class="n">xx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/9833d72876da3a9362c092002a3f562964796c75dab300626260781e37895f2b.png" src="../../_images/9833d72876da3a9362c092002a3f562964796c75dab300626260781e37895f2b.png" />
</div>
</div>
</section>
<section id="box-and-whisker-plots">
<h2>Box-and-whisker plots<a class="headerlink" href="#box-and-whisker-plots" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create data for the bar plot</span>

<span class="c1"># data sizes</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1"># rows</span>
<span class="n">n</span> <span class="o">=</span>  <span class="mi">6</span> <span class="c1"># columns</span>

<span class="c1"># generate data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># now for the boxplot</span>

<span class="n">plt</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/db53f77f40a9b428e09da910b73448530ff4bead0734e29f91c70bbb998e7790.png" src="../../_images/db53f77f40a9b428e09da910b73448530ff4bead0734e29f91c70bbb998e7790.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># now with seaborn</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f8c9d105e858f5ffca703693e58f6ff2e4e81c00c8d32aec5c9a6c381cc3105c.png" src="../../_images/f8c9d105e858f5ffca703693e58f6ff2e4e81c00c8d32aec5c9a6c381cc3105c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># or as a pandas data frame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;zero&#39;</span><span class="p">,</span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="s1">&#39;two&#39;</span><span class="p">,</span><span class="s1">&#39;three&#39;</span><span class="p">,</span><span class="s1">&#39;four&#39;</span><span class="p">,</span><span class="s1">&#39;five&#39;</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/m0/mambaforge/lib/python3.10/site-packages/seaborn/categorical.py:82: FutureWarning: iteritems is deprecated and will be removed in a future version. Use .items instead.
  plot_data = [np.asarray(s, float) for k, s in iter_data]
</pre></div>
</div>
<img alt="../../_images/f26496d20f7e272138ab63c9d2c74f742dbd154ae10045edb0a99324573d96e8.png" src="../../_images/f26496d20f7e272138ab63c9d2c74f742dbd154ae10045edb0a99324573d96e8.png" />
</div>
</div>
</section>
<section id="bar-plots">
<h2>Bar plots<a class="headerlink" href="#bar-plots" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create data for the bar plot</span>

<span class="c1"># data sizes</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1"># rows</span>
<span class="n">n</span> <span class="o">=</span>  <span class="mi">6</span> <span class="c1"># columns</span>

<span class="c1"># generate data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># show the bars!</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># &#39;naked&#39; bars</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Bar plot&#39;</span><span class="p">)</span>

<span class="c1"># just the error bars</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Errorbar plot&#39;</span><span class="p">)</span>

<span class="c1"># both</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Error+bar plot&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e62256e604456d63077bb95f1b8739d6d15f85ce83b9e34b7d0b14ad7066fca8.png" src="../../_images/e62256e604456d63077bb95f1b8739d6d15f85ce83b9e34b7d0b14ad7066fca8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## manually specify x-axis coordinates</span>

<span class="n">xcrossings</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span> <span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">xcrossings</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">xcrossings</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Bar+error plot&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a4e5a1b7dc56aa8420fd95d9e25e8986be930daab4be464f1acf8c8c03462781.png" src="../../_images/a4e5a1b7dc56aa8420fd95d9e25e8986be930daab4be464f1acf8c8c03462781.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## note about bars from matrices</span>

<span class="c1"># data are groups (rows) X property (columns)</span>
<span class="n">m</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="p">]</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="c1"># conceptualizing the data as &lt;row&gt; groups of &lt;columns&gt;</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># using pandas dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;prop 0&#39;</span><span class="p">,</span><span class="s1">&#39;prop 1&#39;</span><span class="p">,</span><span class="s1">&#39;prop 2&#39;</span><span class="p">,</span><span class="s1">&#39;prop 3&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Grouping by rows&#39;</span><span class="p">)</span>


<span class="c1"># now other orientation (property X group)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Grouping by columns&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e398767eabe493ef0120e8603bd2f294605a6fdc63826d919b98dbf8147d3813.png" src="../../_images/e398767eabe493ef0120e8603bd2f294605a6fdc63826d919b98dbf8147d3813.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="descriptive-statistics">
<h1>Descriptive statistics<a class="headerlink" href="#descriptive-statistics" title="Permalink to this headline"></a></h1>
<section id="violin-plots">
<h2>Violin plots<a class="headerlink" href="#violin-plots" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create the data</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">thresh</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># threshold for cropping data</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">&gt;</span><span class="n">thresh</span><span class="p">]</span> <span class="o">=</span> <span class="n">thresh</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="o">&gt;</span><span class="n">thresh</span><span class="p">))</span><span class="o">*</span><span class="mf">.1</span>

<span class="c1"># show histogram</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histogram&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># show violin plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Violin&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ca986c0c290a11bbc0a31cf70ced82c011b656c1ac23b2107e6ed9fd7140b4cb.png" src="../../_images/ca986c0c290a11bbc0a31cf70ced82c011b656c1ac23b2107e6ed9fd7140b4cb.png" />
<img alt="../../_images/a51103e506439a9b58991cf8fb53084b8854e107a76f24a193dac5126537277c.png" src="../../_images/a51103e506439a9b58991cf8fb53084b8854e107a76f24a193dac5126537277c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># another option: swarm plot</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">swarmplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/m0/mambaforge/lib/python3.10/site-packages/seaborn/_decorators.py:36: FutureWarning: Pass the following variable as a keyword arg: x. From version 0.12, the only valid positional argument will be `data`, and passing other arguments without an explicit keyword will result in an error or misinterpretation.
  warnings.warn(
/Users/m0/mambaforge/lib/python3.10/site-packages/seaborn/_core.py:1326: UserWarning: Vertical orientation ignored with only `x` specified.
  warnings.warn(single_var_warning.format(&quot;Vertical&quot;, &quot;x&quot;))
/Users/m0/mambaforge/lib/python3.10/site-packages/seaborn/categorical.py:1296: UserWarning: 6.4% of the points cannot be placed; you may want to decrease the size of the markers or use stripplot.
  warnings.warn(msg, UserWarning)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../../_images/4c86fdf9329f841b0796f0fd0a4ff0c157048877d242de943419bc1e762ba55d.png" src="../../_images/4c86fdf9329f841b0796f0fd0a4ff0c157048877d242de943419bc1e762ba55d.png" />
</div>
</div>
</section>
<section id="qq-plots">
<h2>QQ plots<a class="headerlink" href="#qq-plots" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## generate data</span>

<span class="n">n</span>    <span class="o">=</span> <span class="mi">1000</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="c1"># data = np.exp( np.random.randn(n)*.8 ) # log-norm distribution</span>

<span class="c1"># theoretical normal distribution given N</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">10001</span><span class="p">)</span>
<span class="n">theonorm</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">theonorm</span> <span class="o">=</span> <span class="n">theonorm</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">theonorm</span><span class="p">)</span>

<span class="c1"># plot histograms on top of each other</span>
<span class="n">yy</span><span class="p">,</span><span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
<span class="n">yy</span> <span class="o">=</span> <span class="n">yy</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span>
<span class="n">xx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xx</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">xx</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mi">2</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Empirical&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">theonorm</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Theoretical&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7aa4ac46e917c3836d4520725eac12ef30b5b9a9feac1f7bd8a08ef61c839cb4.png" src="../../_images/7aa4ac46e917c3836d4520725eac12ef30b5b9a9feac1f7bd8a08ef61c839cb4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create a QQ plot</span>

<span class="n">zSortData</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="n">sortNormal</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>

<span class="c1"># QQ plot is theory vs reality</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sortNormal</span><span class="p">,</span><span class="n">zSortData</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="c1"># set axes to be equal</span>
<span class="n">xL</span><span class="p">,</span><span class="n">xR</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()</span>
<span class="n">yL</span><span class="p">,</span><span class="n">yR</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()</span>
<span class="n">lims</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">xL</span><span class="p">,</span><span class="n">xR</span><span class="p">,</span><span class="n">yL</span><span class="p">,</span><span class="n">yR</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">xL</span><span class="p">,</span><span class="n">xR</span><span class="p">,</span><span class="n">yL</span><span class="p">,</span><span class="n">yR</span><span class="p">])</span> <span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">lims</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">lims</span><span class="p">)</span>

<span class="c1"># draw red comparison line</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lims</span><span class="p">,</span><span class="n">lims</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Theoretical normal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Observed data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;QQ plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;square&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ed25b1839bd32837f6fa6260fb02034f9e517a661be3e21c176a1b126f457c62.png" src="../../_images/ed25b1839bd32837f6fa6260fb02034f9e517a661be3e21c176a1b126f457c62.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Python solution</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">plot</span><span class="o">=</span><span class="n">plt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c46c5bf666c780cf93061e4b60813948521268cc53a0e9008b5de6278cfa0a66.png" src="../../_images/c46c5bf666c780cf93061e4b60813948521268cc53a0e9008b5de6278cfa0a66.png" />
</div>
</div>
</section>
<section id="inter-quartile-range-iqr">
<h2>Inter-quartile range (IQR)<a class="headerlink" href="#inter-quartile-range-iqr" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create the data</span>

<span class="c1"># random number data</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># rank-transform the data and scale to 1</span>
<span class="n">dataR</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">rankdata</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="n">n</span>

<span class="c1"># find the values closest to 25% and 75% of the distribution</span>
<span class="n">q1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">((</span><span class="n">dataR</span><span class="o">-</span><span class="mf">.25</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">q3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">((</span><span class="n">dataR</span><span class="o">-</span><span class="mf">.75</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># get the two values in the data</span>
<span class="n">iq_vals</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="n">q1</span><span class="p">,</span><span class="n">q3</span><span class="p">]]</span>

<span class="c1"># IQR is the difference between them</span>
<span class="n">iqrange1</span> <span class="o">=</span> <span class="n">iq_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">iq_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># or use Python&#39;s built-in function ;)</span>
<span class="n">iqrange2</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">iqr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">iqrange1</span><span class="p">,</span><span class="n">iqrange2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.211007070531542 1.212300290707061
</pre></div>
</div>
</div>
</div>
</section>
<section id="histogram-bins">
<h2>Histogram bins<a class="headerlink" href="#histogram-bins" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create some data</span>

<span class="c1"># number of data points</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># number of histogram bins</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">40</span>

<span class="c1"># generate log-normal distribution</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="p">)</span>


<span class="c1"># one way to show a histogram</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/9fd2bdd55591cd161e5a212da6a5dff4bce55b9149b037d263264ef366b9e8cb.png" src="../../_images/9fd2bdd55591cd161e5a212da6a5dff4bce55b9149b037d263264ef366b9e8cb.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## try the Freedman-Diaconis rule</span>

<span class="n">r</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">stats</span><span class="o">.</span><span class="n">iqr</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">)</span><span class="o">/</span><span class="n">r</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>

<span class="c1"># or directly from the hist function</span>
<span class="c1">#plt.hist(data,bins=&#39;fd&#39;)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;F-D &quot;rule&quot; using </span><span class="si">%g</span><span class="s1"> bins&#39;</span><span class="o">%</span><span class="k">b</span>)
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d8cd082426b262a594b12d8d09d428b8b7dc3a16f9fd764ffefcd8acef328baf.png" src="../../_images/d8cd082426b262a594b12d8d09d428b8b7dc3a16f9fd764ffefcd8acef328baf.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># small aside on Seaborn</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1"># uses FD rule by default</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/m0/mambaforge/lib/python3.10/site-packages/seaborn/distributions.py:2619: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:ylabel=&#39;Density&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/dc9ba1c30036c4edcd3d679ac455419f7dfd8d96964f4d2ad8f5511a993e19f2.png" src="../../_images/dc9ba1c30036c4edcd3d679ac455419f7dfd8d96964f4d2ad8f5511a993e19f2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## lots of histograms with increasing bins</span>

<span class="n">bins2try</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span> <span class="p">)</span>

<span class="k">for</span> <span class="n">bini</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins2try</span><span class="p">)):</span>
    <span class="n">y</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">bins2try</span><span class="p">[</span><span class="n">bini</span><span class="p">]))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;.-&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ce7f9a4a8ab26e4994824f836639cef7788a36f6ff04ebbcbebea536bddc37b7.png" src="../../_images/ce7f9a4a8ab26e4994824f836639cef7788a36f6ff04ebbcbebea536bddc37b7.png" />
</div>
</div>
</section>
<section id="entropy">
<h2>Entropy<a class="headerlink" href="#entropy" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## &quot;discrete&quot; entropy</span>

<span class="c1"># generate data</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">numbers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span> <span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
<span class="n">numbers</span><span class="p">[</span><span class="n">numbers</span><span class="o">==</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x1518ce050&gt;]
</pre></div>
</div>
<img alt="../../_images/6f1dd6f80ef757a9a2cbef080d3faf86a308d1e1994d10ad5b31ce956ebea10d.png" src="../../_images/6f1dd6f80ef757a9a2cbef080d3faf86a308d1e1994d10ad5b31ce956ebea10d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## &quot;discrete&quot; entropy</span>

<span class="c1"># generate data</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">numbers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span> <span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>


<span class="c1"># get counts and probabilities</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
<span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ui</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)):</span>
    <span class="n">probs</span><span class="p">[</span><span class="n">ui</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">numbers</span><span class="o">==</span><span class="n">u</span><span class="p">[</span><span class="n">ui</span><span class="p">])</span> <span class="o">/</span> <span class="n">N</span>

    
<span class="c1"># compute entropy</span>
<span class="n">entropee</span> <span class="o">=</span> <span class="o">-</span><span class="nb">sum</span><span class="p">(</span> <span class="n">probs</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">probs</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span> <span class="p">)</span>


<span class="c1"># plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">probs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Entropy = </span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">entropee</span>)
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Data value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/68eb59325305e69206fbd0f0e0114d49c53e181c7ff65df161bd765215f53cec.png" src="../../_images/68eb59325305e69206fbd0f0e0114d49c53e181c7ff65df161bd765215f53cec.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## for random variables</span>

<span class="c1"># create Brownian noise</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1123</span>
<span class="n">brownnoise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">brownnoise</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Data index&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Data value&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Brownian noise&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">brownnoise</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Data value&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/3b14c643ce1ef82afe95ad461f6e323e614d6392d0d952b522d96085a99e7950.png" src="../../_images/3b14c643ce1ef82afe95ad461f6e323e614d6392d0d952b522d96085a99e7950.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### now compute entropy</span>
<span class="c1"># number of bins</span>
<span class="n">nbins</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># bin the data and convert to probability</span>
<span class="n">nPerBin</span><span class="p">,</span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">brownnoise</span><span class="p">,</span><span class="n">nbins</span><span class="p">)</span>
<span class="n">probs</span> <span class="o">=</span> <span class="n">nPerBin</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nPerBin</span><span class="p">)</span>

<span class="c1"># compute entropy</span>
<span class="n">entro</span> <span class="o">=</span> <span class="o">-</span><span class="nb">sum</span><span class="p">(</span> <span class="n">probs</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">probs</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Entropy = </span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">entro</span>)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Entropy = 5.23685
</pre></div>
</div>
</div>
</div>
</section>
<section id="data-from-different-distributions">
<h2>Data from different distributions<a class="headerlink" href="#data-from-different-distributions" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Gaussian</span>

<span class="c1"># number of discretizations</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1001</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">gausdist</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">gausdist</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Analytic Gaussian (normal) distribution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># is this a probability distribution?</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">gausdist</span><span class="p">))</span>
<span class="c1"># try scaling by dx...</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5dc7a8436877133b2bd7ea8b208965bc8bda084bbad60edc961283cc61426775.png" src="../../_images/5dc7a8436877133b2bd7ea8b208965bc8bda084bbad60edc961283cc61426775.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>124.99221530601626
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Normally-distributed random numbers</span>

<span class="c1"># parameters</span>
<span class="n">stretch</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># variance (square of standard deviation)</span>
<span class="n">shift</span>   <span class="o">=</span> <span class="mi">5</span> <span class="c1"># mean</span>
<span class="n">n</span>       <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># create data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">stretch</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">shift</span>

<span class="c1"># plot data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Empirical normal distribution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/54086480d958ab595eac43fe9ed3391fff34ff33c2ab8a5d1cc84402dccd8b3a.png" src="../../_images/54086480d958ab595eac43fe9ed3391fff34ff33c2ab8a5d1cc84402dccd8b3a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Uniformly-distributed numbers</span>

<span class="c1"># parameters</span>
<span class="n">stretch</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># not the variance</span>
<span class="n">shift</span>   <span class="o">=</span> <span class="mf">.5</span>
<span class="n">n</span>       <span class="o">=</span> <span class="mi">10000</span>

<span class="c1"># create data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">stretch</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">shift</span><span class="o">-</span><span class="n">stretch</span><span class="o">/</span><span class="mi">2</span>

<span class="c1"># plot data</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Uniform data values&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Uniform data histogram&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7140f76a5c2406e82fd679e2cf92cdf09d77e3f390f5cc0c27038675ff228568.png" src="../../_images/7140f76a5c2406e82fd679e2cf92cdf09d77e3f390f5cc0c27038675ff228568.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## log-normal distribution</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">1001</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">lognormdist</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">lognormdist</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Analytic log-normal distribution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e274e10838adc98e0f619c4dd5f0793e4fb2a93be4466f472d8366437eccbee5.png" src="../../_images/e274e10838adc98e0f619c4dd5f0793e4fb2a93be4466f472d8366437eccbee5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## empirical log-normal distribution</span>

<span class="n">shift</span>   <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># equal to the mean?</span>
<span class="n">stretch</span> <span class="o">=</span> <span class="mf">.5</span> <span class="c1"># equal to standard deviation?</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">2000</span>     <span class="c1"># number of data points</span>

<span class="c1"># generate data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">stretch</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">shift</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>

<span class="c1"># plot data</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Log-normal data values&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Log-normal data histogram&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0dab45aa944c999cecb509aad00cfadfe20a3bc2d28bb383e72d2d0b0589ce37.png" src="../../_images/0dab45aa944c999cecb509aad00cfadfe20a3bc2d28bb383e72d2d0b0589ce37.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## binomial</span>

<span class="c1"># a binomial distribution is the probability of K heads in N coin tosses,</span>
<span class="c1"># given a probability of p heads (e.g., .5 is a fair coin).</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># number on coin tosses</span>
<span class="n">p</span> <span class="o">=</span> <span class="mf">.5</span> <span class="c1"># probability of heads</span>

<span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
<span class="n">bindist</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">binom</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">bindist</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Binomial distribution (n=</span><span class="si">%s</span><span class="s1">, p=</span><span class="si">%g</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">p</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e212c42f0a84f90a87273b2a0f6bd88e91b95a7cb409b9841053a0d3233415ad.png" src="../../_images/e212c42f0a84f90a87273b2a0f6bd88e91b95a7cb409b9841053a0d3233415ad.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## t</span>

<span class="n">x</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1001</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">t</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">df</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t-value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;P(t | H$_0$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;t(</span><span class="si">%g</span><span class="s1">) distribution&#39;</span><span class="o">%</span><span class="k">df</span>)
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/dd79a7e573593441534c3be89d030282bec0d1efc18764d9cdfa92ed9eeb7421.png" src="../../_images/dd79a7e573593441534c3be89d030282bec0d1efc18764d9cdfa92ed9eeb7421.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## F</span>

<span class="c1"># parameters</span>
<span class="n">num_df</span> <span class="o">=</span> <span class="mi">5</span>   <span class="c1"># numerator degrees of freedom</span>
<span class="n">den_df</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># denominator df</span>

<span class="c1"># values to evaluate </span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10001</span><span class="p">)</span>

<span class="c1"># the distribution</span>
<span class="n">fdist</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">num_df</span><span class="p">,</span><span class="n">den_df</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">fdist</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;F(</span><span class="si">{</span><span class="n">num_df</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">den_df</span><span class="si">}</span><span class="s1">) distribution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;F value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5e12ded8789be2428bfae1549a15f7eaeade86ab0a48e25c6dfaa8b6f3241ce9.png" src="../../_images/5e12ded8789be2428bfae1549a15f7eaeade86ab0a48e25c6dfaa8b6f3241ce9.png" />
</div>
</div>
</section>
<section id="computing-dispersion">
<h2>Computing dispersion<a class="headerlink" href="#computing-dispersion" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create some data distributions</span>

<span class="c1"># the distributions</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10001</span>   <span class="c1"># number of data points</span>
<span class="n">nbins</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># number of histogram bins</span>

<span class="n">d1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">d2</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">d3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># need their histograms</span>
<span class="n">y1</span><span class="p">,</span><span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">nbins</span><span class="p">)</span>
<span class="n">x1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">x1</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>

<span class="n">y2</span><span class="p">,</span><span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span><span class="n">nbins</span><span class="p">)</span>
<span class="n">x2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">x2</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>

<span class="n">y3</span><span class="p">,</span><span class="n">x3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">d3</span><span class="p">,</span><span class="n">nbins</span><span class="p">)</span>
<span class="n">x3</span> <span class="o">=</span> <span class="p">(</span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">x3</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>


<span class="c1"># plot them</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="n">y3</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Data values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Data counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ef9f77bd833b2c8a15db2373674c06e9de48b490f3ca32576a130c634673dc7c.png" src="../../_images/ef9f77bd833b2c8a15db2373674c06e9de48b490f3ca32576a130c634673dc7c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># side note:</span>

<span class="n">meanval</span> <span class="o">=</span> <span class="mf">10.2</span>
<span class="n">stdval</span>  <span class="o">=</span> <span class="mf">7.5</span>
<span class="n">numsamp</span> <span class="o">=</span> <span class="mi">123</span>

<span class="c1"># this</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">meanval</span><span class="p">,</span><span class="n">stdval</span><span class="p">,</span><span class="n">numsamp</span><span class="p">)</span>

<span class="c1"># is equivalent to</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">numsamp</span><span class="p">)</span><span class="o">*</span><span class="n">stdval</span> <span class="o">+</span> <span class="n">meanval</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ -0.87388704,  23.65336127,   1.27988544,  17.04829163,
        10.75457484,   9.68249118,  11.22715252,  19.7725035 ,
        -1.01689652,   4.35014906,   2.42744711,  20.90617046,
        13.00854419,  -0.10259506,   6.82944939, -11.89267865,
        21.16631839,  16.39280516,   9.09476693,  19.98243464,
        22.61578168,  -1.46609947,   2.16429265,  20.47355737,
        16.84275579,  31.25852569,  24.34842632,  12.67746311,
        13.28386249,   0.40678189,  -1.74459528,  16.23562355,
        14.31916935,  10.82066382,   7.5758167 ,  19.18904038,
        15.03423568,  18.77275799,  -6.54852808,  -2.15708239,
        -3.49932265,   9.61055948,  -5.41354871,   9.96327393,
        25.30366261,   5.19479576,   4.59751711,  11.50987925,
        13.85467453,   9.74117974,  17.305712  ,   4.52833339,
         7.1356735 ,  13.42456617,   3.70541112,   1.33029122,
        18.38764755,  20.38798885,   8.13071973,  13.0716251 ,
         3.2078581 ,   7.15034437,  10.84541165,   3.66708897,
        -5.58821728,  18.03226744,  14.31356567,  -2.63861608,
         5.34760912,  10.05683736,  -0.52072099,  16.51949691,
        21.48789778,  -2.93630354,  13.84026169,   5.90434504,
         4.16912942,  10.96207774,  20.17271268,  22.72277056,
         6.19739485,   5.07995896,   1.67212248,  20.69802595,
        24.54634857,   9.46639918,  10.33854841,   6.42727657,
        17.52544009,  18.01852162,   7.504182  ,  -8.6243624 ,
        11.46639884,   5.8924707 ,  23.40506416,   5.12431053,
        12.76111211,  21.31636725,  12.37984906, -14.00257955,
        22.03093215,   5.18363698,  17.26538053,   8.50443335,
         8.4218123 ,  17.74338666,  10.88031496,  -0.99600587,
         6.50961604,  12.18119378,  -2.51193418,   4.76236751,
         9.96541643,  12.12123062,  17.64317282,  14.50346946,
         5.86475471,   7.28886638,   4.78059196,  15.49434827,
        25.1052644 ,  11.61240844,   2.67046243])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## overlay the mean</span>

<span class="c1"># compute the means</span>
<span class="n">mean_d1</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span>
<span class="n">mean_d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
<span class="n">mean_d3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">d3</span><span class="p">)</span>

<span class="c1"># plot them</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span><span class="n">y3</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mean_d1</span><span class="p">,</span><span class="n">mean_d1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">)],</span><span class="s1">&#39;b--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mean_d2</span><span class="p">,</span><span class="n">mean_d2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)],</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mean_d3</span><span class="p">,</span><span class="n">mean_d3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">y3</span><span class="p">)],</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Data values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Data counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f31dec7a86d79dfbfffc841c53333a4e9c0864013646327dd3338148ff6cd902.png" src="../../_images/f31dec7a86d79dfbfffc841c53333a4e9c0864013646327dd3338148ff6cd902.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now for the standard deviation</span>

<span class="c1"># initialize</span>
<span class="n">stds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># compute standard deviations</span>
<span class="n">stds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">stds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">stds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">d3</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="c1"># same plot as earlier</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span><span class="n">y3</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mean_d1</span><span class="p">,</span><span class="n">mean_d1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">)],</span><span class="s1">&#39;b--&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">mean_d2</span><span class="p">,</span><span class="n">mean_d2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)],</span><span class="s1">&#39;r--&#39;</span><span class="p">,[</span><span class="n">mean_d3</span><span class="p">,</span><span class="n">mean_d3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">y3</span><span class="p">)],</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>

<span class="c1"># now add stds</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mean_d1</span><span class="o">-</span><span class="n">stds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mean_d1</span><span class="o">+</span><span class="n">stds</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="mf">.4</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">),</span><span class="mf">.4</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">)],</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mean_d2</span><span class="o">-</span><span class="n">stds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">mean_d2</span><span class="o">+</span><span class="n">stds</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="mf">.5</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">),</span><span class="mf">.5</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)],</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mean_d3</span><span class="o">-</span><span class="n">stds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">mean_d3</span><span class="o">+</span><span class="n">stds</span><span class="p">[</span><span class="mi">2</span><span class="p">]],[</span><span class="mf">.6</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">y3</span><span class="p">),</span><span class="mf">.6</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">y3</span><span class="p">)],</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Data values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Data counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/23958ba42315967074b06c37727073c631373b7da9a750e72b45d67ce005044a.png" src="../../_images/23958ba42315967074b06c37727073c631373b7da9a750e72b45d67ce005044a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## different variance measures</span>

<span class="n">variances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">300</span>

<span class="n">varmeasures</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">variances</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">variances</span><span class="p">)):</span>
    
    <span class="c1"># create data and mean-center</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">variances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">datacent</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="c1"># variance</span>
    <span class="n">varmeasures</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">datacent</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># &quot;biased&quot; variance</span>
    <span class="n">varmeasures</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">datacent</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span>
    
    <span class="c1"># standard deviation</span>
    <span class="n">varmeasures</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="nb">sum</span><span class="p">(</span><span class="n">datacent</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    
    <span class="c1"># MAD (mean absolute difference)</span>
    <span class="n">varmeasures</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">datacent</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    

<span class="c1"># show them!</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">variances</span><span class="p">,</span><span class="n">varmeasures</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Var&#39;</span><span class="p">,</span><span class="s1">&#39;biased var&#39;</span><span class="p">,</span><span class="s1">&#39;Std&#39;</span><span class="p">,</span><span class="s1">&#39;MAD&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/41867416c1c6a382f62dbf63c0b1eb3d9915d89ef138af68536e1c32bcc2ccc8.png" src="../../_images/41867416c1c6a382f62dbf63c0b1eb3d9915d89ef138af68536e1c32bcc2ccc8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Fano factor and coefficient of variation (CV)</span>

<span class="c1"># need positive-valued data (why?)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">300</span><span class="p">)</span>  <span class="c1"># &quot;Poisson noise&quot;</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Poisson noise&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b795f5ab882ef59f363a09b446061805750a8483696f7b3c911548aa1f20aac1.png" src="../../_images/b795f5ab882ef59f363a09b446061805750a8483696f7b3c911548aa1f20aac1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## compute fano factor and CV for a range of lambda parameters</span>

<span class="c1"># list of parameters</span>
<span class="n">lambdas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>

<span class="c1"># initialize output vectors</span>
<span class="n">fano</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lambdas</span><span class="p">))</span>
<span class="n">cv</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lambdas</span><span class="p">))</span>

<span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lambdas</span><span class="p">)):</span>
    
    <span class="c1"># generate new data</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">lambdas</span><span class="p">[</span><span class="n">li</span><span class="p">],</span><span class="mi">1000</span><span class="p">)</span>
    
    <span class="c1"># compute the metrics</span>
    <span class="n">cv</span><span class="p">[</span><span class="n">li</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1"># need ddof=1 here?</span>
    <span class="n">fano</span><span class="p">[</span><span class="n">li</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="c1"># and plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lambdas</span><span class="p">,</span><span class="n">cv</span><span class="p">,</span><span class="s1">&#39;bs-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lambdas</span><span class="p">,</span><span class="n">fano</span><span class="p">,</span><span class="s1">&#39;ro-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;CV&#39;</span><span class="p">,</span><span class="s1">&#39;Fano&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$\lambda$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;CV or Fano&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/157e81d5b2b5ed82fc21b1a6c8128b047fbf960308e945665c71cc3995c69026.png" src="../../_images/157e81d5b2b5ed82fc21b1a6c8128b047fbf960308e945665c71cc3995c69026.png" />
</div>
</div>
</section>
<section id="computing-central-tendency">
<h2>Computing central tendency<a class="headerlink" href="#computing-central-tendency" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create some data distributions</span>

<span class="c1"># the distributions</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10001</span>   <span class="c1"># number of data points</span>
<span class="n">nbins</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># number of histogram bins</span>

<span class="n">d1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">d2</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">d3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># need their histograms</span>
<span class="n">y1</span><span class="p">,</span><span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">nbins</span><span class="p">)</span>
<span class="n">x1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">x1</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>

<span class="n">y2</span><span class="p">,</span><span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span><span class="n">nbins</span><span class="p">)</span>
<span class="n">x2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">x2</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>

<span class="n">y3</span><span class="p">,</span><span class="n">x3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">d3</span><span class="p">,</span><span class="n">nbins</span><span class="p">)</span>
<span class="n">x3</span> <span class="o">=</span> <span class="p">(</span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">x3</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>


<span class="c1"># plot them</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="n">y3</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Data values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Data counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/062d7ee652cd5ea2ed93888f8f4c89d04bf674bedabdff22f1d99362f20c27a0.png" src="../../_images/062d7ee652cd5ea2ed93888f8f4c89d04bf674bedabdff22f1d99362f20c27a0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## overlay the mean</span>

<span class="c1"># compute the means</span>
<span class="n">mean_d1</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span>
<span class="n">mean_d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
<span class="n">mean_d3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">d3</span><span class="p">)</span>

<span class="c1"># plot them</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span><span class="n">y3</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mean_d1</span><span class="p">,</span><span class="n">mean_d1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">)],</span><span class="s1">&#39;b--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mean_d2</span><span class="p">,</span><span class="n">mean_d2</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)],</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mean_d3</span><span class="p">,</span><span class="n">mean_d3</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">y3</span><span class="p">)],</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Data values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Data counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0e9de96228d29a4b0b9f5a68d8413ae64c983956b0eb62c471af8865456c5eb2.png" src="../../_images/0e9de96228d29a4b0b9f5a68d8413ae64c983956b0eb62c471af8865456c5eb2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## &quot;failure&quot; of the mean</span>

<span class="c1"># new dataset of distribution combinations</span>
<span class="n">d4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<span class="c1"># and its histogram</span>
<span class="p">[</span><span class="n">y4</span><span class="p">,</span><span class="n">x4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">d4</span><span class="p">,</span><span class="n">nbins</span><span class="p">)</span>
<span class="n">x4</span> <span class="o">=</span> <span class="p">(</span><span class="n">x4</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">x4</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mi">2</span>

<span class="c1"># and its mean</span>
<span class="n">mean_d4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">d4</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x4</span><span class="p">,</span><span class="n">y4</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">mean_d4</span><span class="p">,</span><span class="n">mean_d4</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">y4</span><span class="p">)],</span><span class="s1">&#39;b--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Data values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Data counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/44ebe6bfe2482d13d629b26abbc6c3ed86e63205e73d0e87eb89bff84ff4cecf.png" src="../../_images/44ebe6bfe2482d13d629b26abbc6c3ed86e63205e73d0e87eb89bff84ff4cecf.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## median</span>

<span class="c1"># create a log-normal distribution</span>
<span class="n">shift</span>   <span class="o">=</span> <span class="mi">0</span>
<span class="n">stretch</span> <span class="o">=</span> <span class="mf">.7</span>
<span class="n">n</span>       <span class="o">=</span> <span class="mi">2000</span>
<span class="n">nbins</span>   <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># generate data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">stretch</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">shift</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>

<span class="c1"># and its histogram</span>
<span class="n">y</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">nbins</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mi">2</span>

<span class="c1"># compute mean and median</span>
<span class="n">datamean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">datamedian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="c1"># plot data</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">],[</span><span class="n">datamean</span><span class="p">,</span><span class="n">datamean</span><span class="p">],</span><span class="s1">&#39;r--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">],[</span><span class="n">datamedian</span><span class="p">,</span><span class="n">datamedian</span><span class="p">],</span><span class="s1">&#39;b--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Median&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">datamean</span><span class="p">,</span><span class="n">datamean</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)],</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">datamedian</span><span class="p">,</span><span class="n">datamedian</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)],</span><span class="s1">&#39;b--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Log-normal data histogram&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/db3a14cbc9746c5925c8cced772c0a48c69a4810cf94eb8228dc52c427301e96.png" src="../../_images/db3a14cbc9746c5925c8cced772c0a48c69a4810cf94eb8228dc52c427301e96.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## mode</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="n">uniq_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">uniq_data</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">uniq_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> appears </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="o">==</span><span class="n">uniq_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="si">}</span><span class="s1"> times.&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The modal value is </span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">stats</span>.mode(data)[0][0])
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-2.0 appears 2 times.
0.0 appears 4 times.
1.0 appears 3 times.
3.0 appears 1 times.
 
The modal value is 0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/93/6sy7vf8142969b_8w873sxcc0000gn/T/ipykernel_19313/3832225992.py:10: FutureWarning: Unlike other reduction functions (e.g. `skew`, `kurtosis`), the default behavior of `mode` typically preserves the axis it acts along. In SciPy 1.11.0, this behavior will change: the default value of `keepdims` will become False, the `axis` over which the statistic is taken will be eliminated, and the value None will no longer be accepted. Set `keepdims` to True or False to avoid this warning.
  print(&#39;The modal value is %g&#39;%stats.mode(data)[0][0])
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-normalizations-and-outliers">
<h1>Data normalizations and outliers<a class="headerlink" href="#data-normalizations-and-outliers" title="Permalink to this headline"></a></h1>
<section id="z-score">
<h2>Z-score<a class="headerlink" href="#z-score" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create data</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="c1">## compute the mean and std</span>
<span class="n">datamean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">datastd</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># the previous two lines are equivalent to the following two lines</span>
<span class="c1">#datamean = data.mean()</span>
<span class="c1">#datastd  = data.std(ddof=1)</span>



<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Data index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Data value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mean = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">datamean</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">; std = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">datastd</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/4db468aa275c3b01ab2debab6401814148370882b043313e05addf494c2daed1.png" src="../../_images/4db468aa275c3b01ab2debab6401814148370882b043313e05addf494c2daed1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now for z-scoring</span>

<span class="c1"># z-score is data minus mean divided by stdev</span>
<span class="n">dataz</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">-</span><span class="n">datamean</span><span class="p">)</span> <span class="o">/</span> <span class="n">datastd</span>

<span class="c1"># can also use Python function</span>
<span class="c1">### NOTE the ddof=1 in the zscore function, to match std() below. That&#39;s incorrect in the video :(</span>
<span class="n">dataz</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># compute the mean and std</span>
<span class="n">dataZmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dataz</span><span class="p">)</span>
<span class="n">dataZstd</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dataz</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dataz</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Data index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Data value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mean = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">dataZmean</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">; std = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">dataZstd</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/433ef7eee83bcdcee2e7b28c8a481d259aaa716fdff5f8d97371eb6b5c4ed052.png" src="../../_images/433ef7eee83bcdcee2e7b28c8a481d259aaa716fdff5f8d97371eb6b5c4ed052.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## show that the relative values are preserved</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">dataz</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Z-transformed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation r = </span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">np</span>.corrcoef(data,dataz)[0,0])
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a356cd05db59c74befdee6870c645d7db33c4ee85e8087a6ff88d6d3622df8d2.png" src="../../_images/a356cd05db59c74befdee6870c645d7db33c4ee85e8087a6ff88d6d3622df8d2.png" />
</div>
</div>
</section>
<section id="z-score-for-outlier-removal">
<h2>Z-score for outlier removal<a class="headerlink" href="#z-score-for-outlier-removal" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">statsmodels</span> <span class="kn">import</span> <span class="n">robust</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="c1">## create some data</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">&lt;-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">&lt;-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span>
<span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">;</span> <span class="c1"># try to force a few outliers</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">*</span><span class="mi">200</span> <span class="o">+</span> <span class="mi">50</span>  <span class="c1"># change the scale for comparison with z</span>

<span class="c1"># convert to z</span>
<span class="n">dataZ</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="c1">#### specify the z-score threshold</span>
<span class="n">zscorethresh</span> <span class="o">=</span> <span class="mi">3</span>



<span class="c1"># plot the data</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;k^&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Data index&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Orig. scale&#39;</span><span class="p">)</span>

<span class="c1"># then plot the zscores</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dataZ</span><span class="p">,</span><span class="s1">&#39;k^&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">],[</span><span class="n">zscorethresh</span><span class="p">,</span><span class="n">zscorethresh</span><span class="p">],</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Data index&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Z distance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ef2764e87832e0272d66a89ff430ee8d064b931bfdc90040dc35bef19888eb9b.png" src="../../_images/ef2764e87832e0272d66a89ff430ee8d064b931bfdc90040dc35bef19888eb9b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## identify outliers</span>

<span class="c1"># find &#39;em!</span>
<span class="n">outliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dataZ</span><span class="p">)</span><span class="o">&gt;</span><span class="n">zscorethresh</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># and cross those out</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">outliers</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">outliers</span><span class="p">],</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">outliers</span><span class="p">,</span><span class="n">dataZ</span><span class="p">[</span><span class="n">outliers</span><span class="p">],</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/abb0b18f752847bfd6c1a10a8fb64edce829bac875609de87dd57c03d0dcde58.png" src="../../_images/abb0b18f752847bfd6c1a10a8fb64edce829bac875609de87dd57c03d0dcde58.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## iterative method</span>

<span class="c1"># pick a lenient threshold just for illustration</span>
<span class="n">zscorethresh</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">dataZ</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="n">colorz</span> <span class="o">=</span> <span class="s1">&#39;brkm&#39;</span>
<span class="n">numiters</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># iteration counter</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    
    <span class="c1"># convert to z</span>
    <span class="n">datamean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">dataZ</span><span class="p">)</span>
    <span class="n">datastd</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">dataZ</span><span class="p">)</span>
    <span class="n">dataZ</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataZ</span><span class="o">-</span><span class="n">datamean</span><span class="p">)</span> <span class="o">/</span> <span class="n">datastd</span>
    
    <span class="c1"># find data values to remove</span>
    <span class="n">toremove</span> <span class="o">=</span> <span class="n">dataZ</span><span class="o">&gt;</span><span class="n">zscorethresh</span>
    
    <span class="c1"># break out of while loop if no points to remove</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">toregggmove</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">breakg</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># otherwise, mark the outliers in the plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">toremove</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">dataZ</span><span class="p">[</span><span class="n">toremove</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">x&#39;</span><span class="o">%</span><span class="k">colorz</span>[numiters],markersize=12)
        <span class="n">dataZ</span><span class="p">[</span><span class="n">toremove</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    
    <span class="c1"># replot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dataZ</span><span class="p">,</span><span class="s1">&#39;k^&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="n">colorz</span><span class="p">[</span><span class="n">numiters</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;iteration </span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">numiters</span>)
    <span class="n">numiters</span> <span class="o">=</span> <span class="n">numiters</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Z-score&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Data index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#### the data points to be removed</span>
<span class="n">removeFromOriginal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dataZ</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">removeFromOriginal</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a0e4d0d4b2a0cb8357843f83794267412c7e16a7dfd6ab753a3c928a264e4ce3.png" src="../../_images/a0e4d0d4b2a0cb8357843f83794267412c7e16a7dfd6ab753a3c928a264e4ce3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 0 23 34]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## modified Z for non-normal distributions</span>

<span class="c1"># compute modified z</span>
<span class="n">dataMed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">dataMAD</span> <span class="o">=</span> <span class="n">robust</span><span class="o">.</span><span class="n">mad</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">dataMz</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">.75</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">data</span><span class="o">-</span><span class="n">dataMed</span><span class="p">)</span> <span class="o">/</span> <span class="n">dataMAD</span>


<span class="c1"># plot the data</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;k^&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Data index&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Orig. scale&#39;</span><span class="p">)</span>

<span class="c1"># then plot the zscores</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dataMz</span><span class="p">,</span><span class="s1">&#39;k^&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">],[</span><span class="n">zscorethresh</span><span class="p">,</span><span class="n">zscorethresh</span><span class="p">],</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Data index&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Median dev. units (Mz)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/46e8a6f6f4b632f9d791c487b73f148dbc64334300e51763873814c12089654c.png" src="../../_images/46e8a6f6f4b632f9d791c487b73f148dbc64334300e51763873814c12089654c.png" />
</div>
</div>
</section>
<section id="data-trimming-to-remove-outliers">
<h2>Data trimming to remove outliers<a class="headerlink" href="#data-trimming-to-remove-outliers" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create some data</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">&lt;-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">&lt;-</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">]</span>  <span class="o">=</span>  <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>

<span class="c1"># also need the mean-centered data</span>
<span class="n">dataMC</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># and plot them (not it ;) )</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;k^&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Data index&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Data value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b204cd1258d49c32b7457b9936b33c293232d542d2bcc1f522f52f212c4e34d1.png" src="../../_images/b204cd1258d49c32b7457b9936b33c293232d542d2bcc1f522f52f212c4e34d1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## option 1: remove k% of the data</span>

<span class="c1"># percent of &quot;extreme&quot; data values to remove</span>
<span class="n">trimPct</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># in percent</span>

<span class="c1"># identify the cut-off (note the abs() )</span>
<span class="n">datacutoff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dataMC</span><span class="p">),</span><span class="mi">100</span><span class="o">-</span><span class="n">trimPct</span><span class="p">)</span>

<span class="c1"># find the exceedance data values</span>
<span class="n">data2cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dataMC</span><span class="p">)</span><span class="o">&gt;</span><span class="n">datacutoff</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># and mark those off</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data2cut</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">data2cut</span><span class="p">],</span><span class="s1">&#39;rx&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e1a526478c88ea6880ebba9edad998c6433cc864caf7956e2551331ccad706c0.png" src="../../_images/e1a526478c88ea6880ebba9edad998c6433cc864caf7956e2551331ccad706c0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## option 2: remove k most extreme values</span>

<span class="c1"># number of &quot;extreme&quot; data values to remove</span>
<span class="n">k2remove</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># in number</span>

<span class="c1"># find the exceedance data values</span>
<span class="n">datasortIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dataMC</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">data2cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">datasortIdx</span><span class="p">[:</span><span class="n">k2remove</span><span class="p">])</span>

<span class="c1"># and mark those off</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data2cut</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">data2cut</span><span class="p">],</span><span class="s1">&#39;go&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>

<span class="c1"># finally, add a legend</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;All data&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%g%%</span><span class="s1"> threshold&#39;</span><span class="o">%</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="n">trimPct</span><span class="p">),</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">-value threshold&#39;</span><span class="o">%</span><span class="k">k2remove</span>))
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e1d772152a4c90332e38aeff47557f73ae4b518389a4265be4508f5290df4eb1.png" src="../../_images/e1d772152a4c90332e38aeff47557f73ae4b518389a4265be4508f5290df4eb1.png" />
</div>
</div>
</section>
<section id="euclidean-distance-for-outlier-removal">
<h2>Euclidean distance for outlier removal<a class="headerlink" href="#euclidean-distance-for-outlier-removal" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create some data</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">40</span>

<span class="c1"># two-dimensional data</span>
<span class="n">d1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">))</span>
<span class="n">d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="mi">5</span><span class="p">))</span>
<span class="n">datamean</span> <span class="o">=</span> <span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">d1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span> <span class="p">]</span>


<span class="c1"># compute distance of each point to the mean</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">ds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">d1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">datamean</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">d2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">datamean</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
    

<span class="c1"># convert to z (don&#39;t need the original data)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ds</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>





<span class="c1"># plot the data</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">,</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Variable x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Variable y&#39;</span><span class="p">)</span>

<span class="c1"># plot the multivariate mean</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">datamean</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">datamean</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;kp&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="c1"># then plot those distances</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="p">[</span><span class="mf">.7</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mf">.3</span><span class="p">],</span><span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Data index&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Z distance&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Z distance&#39;)
</pre></div>
</div>
<img alt="../../_images/4e23afc4dec8da2097bbfc96fb7dd902b5ca7e887effb611affb96f811319bc7.png" src="../../_images/4e23afc4dec8da2097bbfc96fb7dd902b5ca7e887effb611affb96f811319bc7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now for the thresholding</span>

<span class="c1"># threshold in standard deviation units</span>
<span class="n">distanceThresh</span> <span class="o">=</span> <span class="mf">2.5</span>

<span class="c1"># find the offending points</span>
<span class="n">oidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds</span><span class="o">&gt;</span><span class="n">distanceThresh</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">oidx</span><span class="p">)</span>


<span class="c1"># and cross those out</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">oidx</span><span class="p">,</span><span class="n">ds</span><span class="p">[</span><span class="n">oidx</span><span class="p">],</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d1</span><span class="p">[</span><span class="n">oidx</span><span class="p">],</span><span class="n">d2</span><span class="p">[</span><span class="n">oidx</span><span class="p">],</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[29]
</pre></div>
</div>
<img alt="../../_images/c58f814be4c310d8494b1b6deff88c9a2c6e7783ada9316276d09a7f25d91acc.png" src="../../_images/c58f814be4c310d8494b1b6deff88c9a2c6e7783ada9316276d09a7f25d91acc.png" />
</div>
</div>
</section>
<section id="min-max-scaling">
<h2>Min-max scaling<a class="headerlink" href="#min-max-scaling" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create some data</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">*</span><span class="mi">234</span> <span class="o">+</span> <span class="mi">934</span>

<span class="c1"># get min and max</span>
<span class="n">dataMin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">dataMax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># now min-max scale</span>
<span class="n">dataS</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">-</span><span class="n">dataMin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">dataMax</span><span class="o">-</span><span class="n">dataMin</span><span class="p">)</span>



<span class="c1"># now plot</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;ks&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Original data scale&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Original data&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span><span class="n">dataS</span><span class="p">,</span><span class="s1">&#39;ks&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Unity-normed data scale&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Scaled data&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8879342e6bf44fb263fa6858f8d2b8172719e98ee832488465b104e304c33578.png" src="../../_images/8879342e6bf44fb263fa6858f8d2b8172719e98ee832488465b104e304c33578.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## show that scaling doesn&#39;t affect the relative values</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">dataS</span><span class="p">,</span><span class="s1">&#39;ks&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Scaled&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/05cccddba97aa0bef95aff49bc01f7fb42bdabf8434ae55630a6ea273593c261.png" src="../../_images/05cccddba97aa0bef95aff49bc01f7fb42bdabf8434ae55630a6ea273593c261.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## any abitrary data range</span>

<span class="c1"># step 1 is to [0,1] normalize as above</span>

<span class="c1"># step 2:</span>
<span class="n">newMin</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">newMax</span> <span class="o">=</span> <span class="mf">8.7</span>

<span class="n">dataSS</span> <span class="o">=</span> <span class="n">dataS</span><span class="o">*</span><span class="p">(</span><span class="n">newMax</span><span class="o">-</span><span class="n">newMin</span><span class="p">)</span> <span class="o">+</span> <span class="n">newMin</span>

<span class="c1"># test it!</span>
<span class="nb">print</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">dataSS</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">dataSS</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[4.0, 8.7]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="probability-theory">
<h1>Probability theory<a class="headerlink" href="#probability-theory" title="Permalink to this headline"></a></h1>
<section id="sampling-variability">
<h2>Sampling variability<a class="headerlink" href="#sampling-variability" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## a theoretical normal distribution</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10101</span><span class="p">)</span>
<span class="n">theoNormDist</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1"># (normalize to pdf)</span>
<span class="c1"># theoNormDist = theoNormDist*np.mean(np.diff(x))</span>

<span class="c1"># now for our experiment</span>
<span class="n">numSamples</span> <span class="o">=</span> <span class="mi">40</span>

<span class="c1"># initialize</span>
<span class="n">sampledata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numSamples</span><span class="p">)</span>

<span class="c1"># run the experiment!</span>
<span class="k">for</span> <span class="n">expi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSamples</span><span class="p">):</span>
    <span class="n">sampledata</span><span class="p">[</span><span class="n">expi</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span>


<span class="c1"># show the results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sampledata</span><span class="p">,</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">theoNormDist</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Data values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d0caadaaa795c7dd0af28ea69d590115150899ef8507ba8cd618b9a6819159ff.png" src="../../_images/d0caadaaa795c7dd0af28ea69d590115150899ef8507ba8cd618b9a6819159ff.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## show the mean of samples of a known distribution</span>

<span class="c1"># generate population data with known mean</span>
<span class="n">populationN</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="n">population</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">populationN</span><span class="p">)</span>
<span class="n">population</span>  <span class="o">=</span> <span class="n">population</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">population</span><span class="p">)</span> <span class="c1"># demean</span>


<span class="c1"># now we draw a random sample from that population</span>
<span class="n">samplesize</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># the random indices to select from the population</span>
<span class="n">sampleidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">populationN</span><span class="p">,</span><span class="n">samplesize</span><span class="p">)</span>
<span class="n">samplemean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">population</span><span class="p">[</span> <span class="n">sampleidx</span> <span class="p">])</span>

<span class="c1">### how does the sample mean compare to the population mean?</span>
<span class="nb">print</span><span class="p">(</span><span class="n">samplemean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.015928841030912758
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## repeat for different sample sizes</span>

<span class="n">samplesizes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">samplemeans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samplesizes</span><span class="p">))</span>

<span class="k">for</span> <span class="n">sampi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samplesizes</span><span class="p">)):</span>
    
    <span class="c1"># nearly the same code as above</span>
    <span class="n">sampleidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">populationN</span><span class="p">,</span><span class="n">samplesizes</span><span class="p">[</span><span class="n">sampi</span><span class="p">])</span>
    <span class="n">samplemeans</span><span class="p">[</span><span class="n">sampi</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">population</span><span class="p">[</span> <span class="n">sampleidx</span> <span class="p">])</span>


<span class="c1"># show the results!</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">samplesizes</span><span class="p">,</span><span class="n">samplemeans</span><span class="p">,</span><span class="s1">&#39;s-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">samplesizes</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">population</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">population</span><span class="p">)],</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;sample size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;mean value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Sample means&#39;</span><span class="p">,</span><span class="s1">&#39;Population mean&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/eb544b0ec65c7b1a09b88291a51b3324ab4c08625a18c4f3905a42537d462a13.png" src="../../_images/eb544b0ec65c7b1a09b88291a51b3324ab4c08625a18c4f3905a42537d462a13.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="compute-probability-mass-functions">
<h1>Compute probability mass functions<a class="headerlink" href="#compute-probability-mass-functions" title="Permalink to this headline"></a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## compute empirical probability function</span>

<span class="c1"># continous signal (technically discrete!)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10004</span>
<span class="n">datats1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)))</span>
<span class="n">datats2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)))</span>

<span class="c1"># let&#39;s see what they look like</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">datats1</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">datats2</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># discretize using histograms</span>
<span class="n">nbins</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">y</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">datats1</span><span class="p">,</span><span class="n">nbins</span><span class="p">)</span>
<span class="n">x1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="n">y</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">datats2</span><span class="p">,</span><span class="n">nbins</span><span class="p">)</span>
<span class="n">x2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;ts1&#39;</span><span class="p">,</span><span class="s1">&#39;ts2&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Data value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d7556a3b758fc3f1609329968a8f453bf3cd318cb957cd35e2001baf71dc83ee.png" src="../../_images/d7556a3b758fc3f1609329968a8f453bf3cd318cb957cd35e2001baf71dc83ee.png" />
<img alt="../../_images/e4c4bef6137ff8f4d8632fe2f39f776efa2eb2294fb9245c83335c56dcc49a19.png" src="../../_images/e4c4bef6137ff8f4d8632fe2f39f776efa2eb2294fb9245c83335c56dcc49a19.png" />
</div>
</div>
<section id="the-law-of-large-numbers">
<h2>The law of large numbers<a class="headerlink" href="#the-law-of-large-numbers" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## example with rolling a die</span>

<span class="c1"># die probabilities (weighted)</span>
<span class="n">f1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mi">8</span>
<span class="n">f2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mi">8</span>
<span class="n">f3</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">8</span>
<span class="n">f4</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">8</span>
<span class="n">f5</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">8</span>
<span class="n">f6</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">8</span>

<span class="c1"># confirm sum to 1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f1</span><span class="o">+</span><span class="n">f2</span><span class="o">+</span><span class="n">f3</span><span class="o">+</span><span class="n">f4</span><span class="o">+</span><span class="n">f5</span><span class="o">+</span><span class="n">f6</span><span class="p">)</span>

<span class="c1"># expected value</span>
<span class="n">expval</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">f1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">f2</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">f3</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">f4</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="n">f5</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">f6</span>

<span class="c1"># generate &quot;population&quot;</span>
<span class="n">population</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span> <span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">population</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">population</span><span class="p">,</span><span class="n">population</span><span class="p">))</span>

<span class="n">nPop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">population</span><span class="p">)</span>

<span class="c1"># draw sample of 8 rolls</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">population</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## experiment: draw larger and larger samples</span>

<span class="n">k</span> <span class="o">=</span> <span class="mi">5000</span>  <span class="c1"># maximum number of samples</span>
<span class="n">sampleAve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nPop</span><span class="p">)</span>
    <span class="n">sampleAve</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span> <span class="n">population</span><span class="p">[</span><span class="n">idx</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)]</span> <span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sampleAve</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">],[</span><span class="n">expval</span><span class="p">,</span><span class="n">expval</span><span class="p">],</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of samples&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">expval</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">expval</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Sample average&#39;</span><span class="p">,</span><span class="s1">&#39;expected value&#39;</span><span class="p">))</span>

<span class="c1"># mean of samples converges to population estimate quickly:</span>
<span class="nb">print</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sampleAve</span><span class="p">)</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sampleAve</span><span class="p">[:</span><span class="mi">9</span><span class="p">])</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.9998251177888515
2.8296737213403884
</pre></div>
</div>
<img alt="../../_images/de9a8ff86c7d42d11d22315c792bb69cbf0dbde868a4a5771dd8a02373c77c71.png" src="../../_images/de9a8ff86c7d42d11d22315c792bb69cbf0dbde868a4a5771dd8a02373c77c71.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Another example from a previous lecture (sampleVariability) (slightly adapted)</span>

<span class="c1"># generate population data with known mean</span>
<span class="n">populationN</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="n">population</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">populationN</span><span class="p">)</span>
<span class="n">population</span> <span class="o">=</span> <span class="n">population</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">population</span><span class="p">)</span>  <span class="c1"># demean</span>


<span class="c1"># get means of samples</span>
<span class="n">samplesize</span>   <span class="o">=</span> <span class="mi">30</span>
<span class="n">numberOfExps</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">samplemeans</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numberOfExps</span><span class="p">)</span>

<span class="k">for</span> <span class="n">expi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numberOfExps</span><span class="p">):</span>
    <span class="c1"># get a sample and compute its mean</span>
    <span class="n">sampleidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">populationN</span><span class="p">,</span><span class="n">samplesize</span><span class="p">)</span>
    <span class="n">samplemeans</span><span class="p">[</span><span class="n">expi</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">population</span><span class="p">[</span> <span class="n">sampleidx</span> <span class="p">])</span>


<span class="c1"># show the results!</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">samplemeans</span><span class="p">,</span><span class="s1">&#39;s-&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">numberOfExps</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">population</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">population</span><span class="p">)],</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Experiment number&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;mean value&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Sample means&#39;</span><span class="p">,</span><span class="s1">&#39;Population mean&#39;</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">samplemeans</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">numberOfExps</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="s1">&#39;s-&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">numberOfExps</span><span class="p">],[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">population</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">population</span><span class="p">)],</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Experiment number&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;mean value&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Sample means&#39;</span><span class="p">,</span><span class="s1">&#39;Population mean&#39;</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/430715b9f1af3072b1543a1d863eedcf6756ef569ae50602df8f9fb9b85d858b.png" src="../../_images/430715b9f1af3072b1543a1d863eedcf6756ef569ae50602df8f9fb9b85d858b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## some foreshadowing...</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samplemeans</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Sample mean value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c96f211139c6f431cc64f3169355359218710fe66884fff78cd2b629dd560078.png" src="../../_images/c96f211139c6f431cc64f3169355359218710fe66884fff78cd2b629dd560078.png" />
</div>
</div>
</section>
<section id="conditional-probability">
<h2>Conditional probability<a class="headerlink" href="#conditional-probability" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## generate two long-spike time series</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">spikeDur</span>  <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># a.u. but must be an even number</span>
<span class="n">spikeNumA</span> <span class="o">=</span> <span class="mf">.01</span> <span class="c1"># in proportion of total number of points</span>
<span class="n">spikeNumB</span> <span class="o">=</span> <span class="mf">.05</span> <span class="c1"># in proportion of total number of points</span>

<span class="c1"># initialize to zeros</span>
<span class="n">spike_tsA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">spike_tsB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>


<span class="c1">### populate time series A</span>
<span class="n">spiketimesA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">spikeNumA</span><span class="p">))</span>

<span class="c1"># flesh out spikes (loop per spike)</span>
<span class="k">for</span> <span class="n">spikei</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spiketimesA</span><span class="p">)):</span>
    
    <span class="c1"># find boundaries</span>
    <span class="n">bnd_pre</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">spiketimesA</span><span class="p">[</span><span class="n">spikei</span><span class="p">]</span><span class="o">-</span><span class="n">spikeDur</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">bnd_pst</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="nb">min</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">spiketimesA</span><span class="p">[</span><span class="n">spikei</span><span class="p">]</span><span class="o">+</span><span class="n">spikeDur</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
    
    <span class="c1"># fill in with ones</span>
    <span class="n">spike_tsA</span><span class="p">[</span><span class="n">bnd_pre</span><span class="p">:</span><span class="n">bnd_pst</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>


<span class="c1"># ### repeat for time series 2</span>
<span class="n">spiketimesB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">spikeNumB</span><span class="p">))</span>
<span class="c1"># spiketimesB[:len(spiketimesA)] = spiketimesA # induce strong conditional probability</span>

<span class="c1"># flesh out spikes (loop per spike)</span>
<span class="k">for</span> <span class="n">spikei</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spiketimesB</span><span class="p">)):</span>
    
    <span class="c1"># find boundaries</span>
    <span class="n">bnd_pre</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">spiketimesB</span><span class="p">[</span><span class="n">spikei</span><span class="p">]</span><span class="o">-</span><span class="n">spikeDur</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">bnd_pst</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="nb">min</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">spiketimesB</span><span class="p">[</span><span class="n">spikei</span><span class="p">]</span><span class="o">+</span><span class="n">spikeDur</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
    
    <span class="c1"># fill in with ones</span>
    <span class="n">spike_tsB</span><span class="p">[</span><span class="n">bnd_pre</span><span class="p">:</span><span class="n">bnd_pst</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## let&#39;s see what they look like</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">spike_tsA</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">spike_tsB</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">])</span>
<span class="c1"># plt.xlim([2000,2500])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/20eee85d20cb9cb15d1d8c1135ccd37811077aab47cf4f77f3765682d0f5ac73.png" src="../../_images/20eee85d20cb9cb15d1d8c1135ccd37811077aab47cf4f77f3765682d0f5ac73.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## compute their probabilities and intersection</span>

<span class="c1"># probabilities</span>
<span class="n">probA</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">spike_tsA</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">probB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spike_tsB</span><span class="p">)</span>

<span class="c1"># joint probability</span>
<span class="n">probAB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spike_tsA</span><span class="o">+</span><span class="n">spike_tsB</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">probA</span><span class="p">,</span><span class="n">probB</span><span class="p">,</span><span class="n">probAB</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0956 0.3871 0.0432
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## compute the conditional probabilities</span>

<span class="c1"># p(A|B)</span>
<span class="n">pAgivenB</span> <span class="o">=</span> <span class="n">probAB</span><span class="o">/</span><span class="n">probB</span>

<span class="c1"># p(B|A)</span>
<span class="n">pBgivenA</span> <span class="o">=</span> <span class="n">probAB</span><span class="o">/</span><span class="n">probA</span>

<span class="c1"># print a little report</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;P(A)   = </span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">probA</span>)
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;P(A|B) = </span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">pAgivenB</span>)
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;P(B)   = </span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">probB</span>)
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;P(B|A) = </span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">pBgivenA</span>)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P(A)   = 0.0956
P(A|B) = 0.111599
P(B)   = 0.3871
P(B|A) = 0.451883
</pre></div>
</div>
</div>
</div>
</section>
<section id="compute-probabilities">
<h2>Compute probabilities<a class="headerlink" href="#compute-probabilities" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## the basic formula</span>

<span class="c1"># counts of the different events</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span> <span class="p">])</span>

<span class="c1"># convert to probability (%)</span>
<span class="n">prob</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">c</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10. 20. 40. 30.]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## the example of drawing marbles from a jar</span>

<span class="c1"># colored marble counts</span>
<span class="n">blue</span>   <span class="o">=</span> <span class="mi">40</span>
<span class="n">yellow</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">orange</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">totalMarbs</span> <span class="o">=</span> <span class="n">blue</span> <span class="o">+</span> <span class="n">yellow</span> <span class="o">+</span> <span class="n">orange</span>

<span class="c1"># put them all in a jar</span>
<span class="n">jar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">blue</span><span class="p">),</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">yellow</span><span class="p">),</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">orange</span><span class="p">)))</span>

<span class="c1"># now we draw 500 marbles (with replacement)</span>
<span class="n">numDraws</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">drawColors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numDraws</span><span class="p">)</span>

<span class="k">for</span> <span class="n">drawi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numDraws</span><span class="p">):</span>
    
    <span class="c1"># generate a random integer to draw</span>
    <span class="n">randmarble</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">jar</span><span class="p">))</span>
    
    <span class="c1"># store the color of that marble</span>
    <span class="n">drawColors</span><span class="p">[</span><span class="n">drawi</span><span class="p">]</span> <span class="o">=</span> <span class="n">jar</span><span class="p">[</span><span class="n">randmarble</span><span class="p">]</span>

<span class="c1"># now we need to know the proportion of colors drawn</span>
<span class="n">propBlue</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">drawColors</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">numDraws</span>
<span class="n">propYell</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">drawColors</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">numDraws</span>
<span class="n">propOran</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">drawColors</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">numDraws</span>


<span class="c1"># plot those against the theoretical probability</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span> <span class="n">propBlue</span><span class="p">,</span> <span class="n">propYell</span><span class="p">,</span> <span class="n">propOran</span> <span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Proportion&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],[</span><span class="n">blue</span><span class="o">/</span><span class="n">totalMarbs</span><span class="p">,</span> <span class="n">blue</span><span class="o">/</span><span class="n">totalMarbs</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">],[</span><span class="n">yellow</span><span class="o">/</span><span class="n">totalMarbs</span><span class="p">,</span><span class="n">yellow</span><span class="o">/</span><span class="n">totalMarbs</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">],[</span><span class="n">orange</span><span class="o">/</span><span class="n">totalMarbs</span><span class="p">,</span><span class="n">orange</span><span class="o">/</span><span class="n">totalMarbs</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">labels</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Blue&#39;</span><span class="p">,</span><span class="s1">&#39;Yellow&#39;</span><span class="p">,</span><span class="s1">&#39;Orange&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Marble color&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Proportion/probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8c7d341896ddb23c99befc9b7a23eff3d843a88286fdc47a406a6ed52addd0b4.png" src="../../_images/8c7d341896ddb23c99befc9b7a23eff3d843a88286fdc47a406a6ed52addd0b4.png" />
</div>
</div>
</section>
<section id="central-limit-theorem-in-action">
<h2>Central limit theorem in action<a class="headerlink" href="#central-limit-theorem-in-action" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create data from a power-law distribution</span>

<span class="c1"># data</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="c1"># alternative data</span>
<span class="c1"># data = np.sin(np.linspace(0,10*np.pi,N))</span>

<span class="c1"># show the distribution</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/9f6173c1ed57e8af92fef6a4ad641d51ebc6053e3499d84cd7e4c7d53b91a592.png" src="../../_images/9f6173c1ed57e8af92fef6a4ad641d51ebc6053e3499d84cd7e4c7d53b91a592.png" />
<img alt="../../_images/41991722046a3f518a58b97c03fe7a335c0316fbc771e714555d99dc501b25c9.png" src="../../_images/41991722046a3f518a58b97c03fe7a335c0316fbc771e714555d99dc501b25c9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## repeated samples of the mean</span>

<span class="n">samplesize</span>   <span class="o">=</span> <span class="mi">30</span>
<span class="n">numberOfExps</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">samplemeans</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numberOfExps</span><span class="p">)</span>

<span class="k">for</span> <span class="n">expi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numberOfExps</span><span class="p">):</span>
    <span class="c1"># get a sample and compute its mean</span>
    <span class="n">sampleidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">samplesize</span><span class="p">)</span>
    <span class="n">samplemeans</span><span class="p">[</span><span class="n">expi</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span> <span class="n">sampleidx</span> <span class="p">])</span>
    

<span class="c1"># and show its distribution</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">samplemeans</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Mean estimate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e2f54488e89e156331a3b0b56c918acd3f7b836cfa2b904a221b6f58dc55cd12.png" src="../../_images/e2f54488e89e156331a3b0b56c918acd3f7b836cfa2b904a221b6f58dc55cd12.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## linear mixtures</span>

<span class="c1"># create two datasets with non-Gaussian distributions</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">10001</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Signal&#39;</span><span class="p">)</span>

<span class="n">y</span><span class="p">,</span><span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Distribution&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Signal&#39;</span><span class="p">)</span>

<span class="n">y</span><span class="p">,</span><span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Distribution&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">s</span><span class="o">+</span><span class="n">u</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Combined signal&#39;</span><span class="p">)</span>

<span class="n">y</span><span class="p">,</span><span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="n">u</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Combined distribution&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/6aee0e46cdd64f51e8dd944a2987db8b772ac9351993bf6ec9090d6a633a8a0f.png" src="../../_images/6aee0e46cdd64f51e8dd944a2987db8b772ac9351993bf6ec9090d6a633a8a0f.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="section-probability-theory">
<h1>SECTION: Probability theory<a class="headerlink" href="#section-probability-theory" title="Permalink to this headline"></a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="cdfs-and-pdfs">
<h1>cdf’s and pdf’s<a class="headerlink" href="#cdfs-and-pdfs" title="Permalink to this headline"></a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## example using log-normal distribution</span>

<span class="c1"># variable to evaluate the functions on</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1001</span><span class="p">)</span>

<span class="c1"># note the function call pattern...</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">lognorm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">p2</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mf">.1</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">lognorm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mf">.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># draw the pdfs</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">p1</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">p1</span><span class="p">))</span> <span class="c1"># question: why divide by sum here?</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">p1</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">p1</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span><span class="n">p2</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">p2</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;pdf(x)&#39;</span><span class="p">)</span>

<span class="c1"># draw the cdfs</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">c1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span><span class="n">c2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;cdf(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/908957038146b954d89dfa4b2a3031eea272857dd214d0ff0a830e71f27c71c1.png" src="../../_images/908957038146b954d89dfa4b2a3031eea272857dd214d0ff0a830e71f27c71c1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## computing the cdf from the pdf</span>

<span class="c1"># compute the cdf</span>
<span class="n">c1x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span> <span class="n">p1</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">c1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">c1x</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ced267eda48c9855e88952d8fa9d3923fd2ef9857820c0282cb9df9df3594abb.png" src="../../_images/ced267eda48c9855e88952d8fa9d3923fd2ef9857820c0282cb9df9df3594abb.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="signal-detection-theory">
<h1>Signal detection theory<a class="headerlink" href="#signal-detection-theory" title="Permalink to this headline"></a></h1>
<section id="roc-curves">
<h2>ROC curves<a class="headerlink" href="#roc-curves" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## first, re-create the dp and rb matrices from previous lectures</span>

<span class="n">x</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">.01</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">.01</span><span class="p">)</span>
<span class="n">dp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">x</span><span class="p">),(</span><span class="mi">99</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">x</span><span class="p">),(</span><span class="mi">99</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">rb</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">x</span><span class="p">),(</span><span class="mi">99</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">x</span><span class="p">),(</span><span class="mi">99</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="p">)</span><span class="o">/</span><span class="mi">2</span>

<span class="c1">## create the 2D bias spaces and plot their ROC curves</span>

<span class="n">rb2plot</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.3</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mf">.9</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">]</span> <span class="c1"># d&#39;/bias levels </span>
<span class="n">tol</span> <span class="o">=</span> <span class="mf">.01</span> <span class="c1"># tolerance for matching levels</span>
<span class="n">colorz</span> <span class="o">=</span> <span class="s1">&#39;rbmk&#39;</span>

<span class="c1"># setup the figure</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="c1"># show the 2D spaces</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;False alarm rate&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Hit rate&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;d&#39;&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;False alarm rate&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Hit rate&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Response bias&#39;</span><span class="p">)</span>



<span class="c1">### now draw the isocontours</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rb2plot</span><span class="p">)):</span>
    
    <span class="c1"># find d&#39; points</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">dp</span><span class="o">&gt;</span><span class="n">rb2plot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">tol</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dp</span><span class="o">&lt;</span><span class="n">rb2plot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">tol</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="s1">&#39;o-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colorz</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="c1"># find bias points</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">rb</span><span class="o">&gt;</span><span class="n">rb2plot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">tol</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rb</span><span class="o">&lt;</span><span class="n">rb2plot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">tol</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="s1">&#39;o-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colorz</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>


<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/3ce51e599d8abdf3c651bcfa898e7d068dbe3bbf72dba40b7186bb38fea77bc0.png" src="../../_images/3ce51e599d8abdf3c651bcfa898e7d068dbe3bbf72dba40b7186bb38fea77bc0.png" />
</div>
</div>
</section>
<section id="response-bias">
<h2>Response bias<a class="headerlink" href="#response-bias" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## example from the slides</span>

<span class="c1"># step 1</span>
<span class="n">hitP</span> <span class="o">=</span> <span class="mi">22</span><span class="o">/</span><span class="mi">30</span>
<span class="n">faP</span>  <span class="o">=</span>  <span class="mi">3</span><span class="o">/</span><span class="mi">30</span>

<span class="c1"># step 2</span>
<span class="n">hitZ</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">hitP</span><span class="p">)</span>
<span class="n">faZ</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">faP</span><span class="p">)</span>

<span class="c1"># step 3</span>
<span class="n">respBias</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">hitZ</span><span class="o">+</span><span class="n">faZ</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

<span class="nb">print</span><span class="p">(</span><span class="n">respBias</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.32931292116725636
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## 2D bias space</span>

<span class="c1"># response probabilities</span>
<span class="n">x</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">.01</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">.01</span><span class="p">)</span>

<span class="c1"># generate the space using tile expansion</span>
<span class="n">rb</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">x</span><span class="p">),(</span><span class="mi">99</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">x</span><span class="p">),(</span><span class="mi">99</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="p">)</span><span class="o">/</span><span class="mi">2</span>


<span class="c1"># show the 2D response bias space</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;False alarm rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Hit rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Response bias&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/04dab28ef8cd89c359271da07d51524e6e59a3c253a437cb270487c0a05f68a9.png" src="../../_images/04dab28ef8cd89c359271da07d51524e6e59a3c253a437cb270487c0a05f68a9.png" />
</div>
</div>
</section>
<section id="f-score">
<h2>F-score<a class="headerlink" href="#f-score" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## run experiment</span>

<span class="c1"># number of &#39;trials&#39; in the experiment</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1"># actual trials is 2N</span>

<span class="c1"># number of experiment repetitions</span>
<span class="n">numExps</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="c1"># initialize</span>
<span class="n">Fscores</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numExps</span><span class="p">)</span>
<span class="n">dPrimes</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numExps</span><span class="p">)</span>
<span class="n">specificity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numExps</span><span class="p">)</span>


<span class="c1">### run the experiment!</span>
<span class="k">for</span> <span class="n">expi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numExps</span><span class="p">):</span>
    
    <span class="c1"># generate data</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># hits</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">N</span><span class="o">-</span><span class="n">H</span>                     <span class="c1"># misses</span>
    <span class="n">CR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="c1"># correct rejections</span>
    <span class="n">FA</span> <span class="o">=</span> <span class="n">N</span><span class="o">-</span><span class="n">CR</span>                   <span class="c1"># false alarms</span>
    
    <span class="c1"># Fscore</span>
    <span class="n">Fscores</span><span class="p">[</span><span class="n">expi</span><span class="p">]</span> <span class="o">=</span> <span class="n">H</span> <span class="o">/</span> <span class="p">(</span><span class="n">H</span><span class="o">+</span><span class="p">(</span><span class="n">FA</span><span class="o">+</span><span class="n">M</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># specificity</span>
    <span class="n">specificity</span><span class="p">[</span><span class="n">expi</span><span class="p">]</span> <span class="o">=</span> <span class="n">CR</span><span class="o">/</span><span class="p">(</span><span class="n">CR</span><span class="o">+</span><span class="n">FA</span><span class="p">)</span>
    
    <span class="c1"># d&#39;</span>
    <span class="n">dPrimes</span><span class="p">[</span><span class="n">expi</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">H</span><span class="o">/</span><span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">FA</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
    
    
    <span class="c1"># not used here...</span>
    <span class="n">precision</span> <span class="o">=</span> <span class="n">H</span><span class="o">/</span><span class="p">(</span><span class="n">H</span><span class="o">+</span><span class="n">FA</span><span class="p">)</span>
    <span class="n">recall</span>    <span class="o">=</span> <span class="n">H</span><span class="o">/</span><span class="p">(</span><span class="n">H</span><span class="o">+</span><span class="n">M</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## let&#39;s see how they relate to each other!</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dPrimes</span><span class="p">,</span><span class="n">Fscores</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">specificity</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;d-prime&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;F-score&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation = </span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">np</span>.round(np.corrcoef(Fscores,dPrimes)[1,0],3))

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b217cc7e9dc88ac26dc303285e36d4b891e73ea67c8702c401fd4c7767468b76.png" src="../../_images/b217cc7e9dc88ac26dc303285e36d4b891e73ea67c8702c401fd4c7767468b76.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="d-prime">
<h1>d-prime<a class="headerlink" href="#d-prime" title="Permalink to this headline"></a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## example from the slides</span>

<span class="c1"># step 1</span>
<span class="n">hitP</span> <span class="o">=</span> <span class="mi">22</span><span class="o">/</span><span class="mi">30</span>
<span class="n">faP</span>  <span class="o">=</span>  <span class="mi">3</span><span class="o">/</span><span class="mi">30</span>

<span class="c1"># step 2</span>
<span class="n">hitZ</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">hitP</span><span class="p">)</span>
<span class="n">faZ</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">faP</span><span class="p">)</span>

<span class="c1"># step 3</span>
<span class="n">dPrime</span> <span class="o">=</span> <span class="n">hitZ</span><span class="o">-</span><span class="n">faZ</span>

<span class="nb">print</span><span class="p">(</span><span class="n">dPrime</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.9044772887546881
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## failure scenarios and their resolutions</span>

<span class="n">hitZ</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">0</span><span class="o">/</span><span class="mi">30</span><span class="p">)</span>
<span class="n">faZ</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">22</span><span class="o">/</span><span class="mi">30</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">hitZ</span><span class="o">-</span><span class="n">faZ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-inf
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## 2D d&#39; space</span>

<span class="c1"># response probabilities</span>
<span class="n">x</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">.01</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">.01</span><span class="p">)</span>

<span class="c1"># generate the space using tile expansion</span>
<span class="n">dp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">x</span><span class="p">),(</span><span class="mi">99</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">x</span><span class="p">),(</span><span class="mi">99</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>


<span class="c1"># show the 2D d&#39; space</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;False alarm rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Hit rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;d&#39;&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d48191a60a28712fba28cc4a12d48da61db6adcb4df98a23fcf9df67da939e6c.png" src="../../_images/d48191a60a28712fba28cc4a12d48da61db6adcb4df98a23fcf9df67da939e6c.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="regression">
<h1>Regression<a class="headerlink" href="#regression" title="Permalink to this headline"></a></h1>
<section id="simple-regression">
<h2>Simple regression<a class="headerlink" href="#simple-regression" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## example: effects of sleep on food spending</span>

<span class="n">sleepHours</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">dollars</span> <span class="o">=</span> <span class="p">[</span><span class="mi">47</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>

<span class="c1"># start by showing the data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sleepHours</span><span class="p">,</span><span class="n">dollars</span><span class="p">,</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Hours of sleep&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Fijian dollars&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/618532037064f312ab72652f2182ac4dd3766a2a7f1eff6516afd0fff3cb00fa.png" src="../../_images/618532037064f312ab72652f2182ac4dd3766a2a7f1eff6516afd0fff3cb00fa.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## &quot;manual&quot; regression via least-squares fitting</span>

<span class="c1"># create the design matrix</span>
<span class="n">desmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">sleepHours</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="nb">print</span><span class="p">(</span><span class="n">desmat</span><span class="p">)</span>

<span class="c1"># compute the beta parameters (regression coefficients)</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">desmat</span><span class="p">,</span><span class="n">dollars</span><span class="p">,</span><span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>

<span class="c1"># predicted data values</span>
<span class="n">yHat</span> <span class="o">=</span> <span class="n">desmat</span><span class="nd">@beta</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[1.  5. ]
 [1.  5.5]
 [1.  6. ]
 [1.  6. ]
 [1.  7. ]
 [1.  7. ]
 [1.  7.5]
 [1.  8. ]
 [1.  8.5]
 [1.  9. ]]
[62.84737679 -2.49602544]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## show the predicted results on top of the &quot;real&quot; data</span>

<span class="c1"># show previous data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sleepHours</span><span class="p">,</span><span class="n">dollars</span><span class="p">,</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># predicted results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sleepHours</span><span class="p">,</span><span class="n">yHat</span><span class="p">,</span><span class="s1">&#39;s-&#39;</span><span class="p">)</span>

<span class="c1"># show the residuals</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">sleepHours</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">sleepHours</span><span class="p">[</span><span class="n">i</span><span class="p">]],[</span><span class="n">dollars</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">yHat</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="s1">&#39;m--&#39;</span><span class="p">)</span>
    

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Data (y)&#39;</span><span class="p">,</span><span class="s1">&#39;Model ($\^</span><span class="si">{y}</span><span class="s1">$)&#39;</span><span class="p">,</span><span class="s1">&#39;Residuals&#39;</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Hours of sleep&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Fijian dollars&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/499807adc265da82d9cef74348f7613dddcc7f82a8ad6ef838bcac9b99d6bd06.png" src="../../_images/499807adc265da82d9cef74348f7613dddcc7f82a8ad6ef838bcac9b99d6bd06.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now with scipy</span>

<span class="n">slope</span><span class="p">,</span><span class="n">intercept</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">sleepHours</span><span class="p">,</span><span class="n">dollars</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">intercept</span><span class="p">,</span><span class="n">slope</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>62.84737678855326 -2.4960254372019075
[62.84737679 -2.49602544]
</pre></div>
</div>
</div>
</div>
</section>
<section id="polynomial-regression">
<h2>Polynomial regression<a class="headerlink" href="#polynomial-regression" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## generate the data</span>

<span class="n">n</span>  <span class="o">=</span> <span class="mi">30</span>
<span class="n">x</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>


<span class="c1"># plot the data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Quadratic&#39;</span><span class="p">,</span><span class="s1">&#39;Cubic&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/fbf0fc6b9caff226db4297794643bc69fe81b8cf442cb97e82f7af4cbc3a541d.png" src="../../_images/fbf0fc6b9caff226db4297794643bc69fe81b8cf442cb97e82f7af4cbc3a541d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now for a polynomial fit</span>

<span class="c1"># for y1</span>
<span class="n">pterms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">yHat1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">pterms</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># for y2</span>
<span class="n">pterms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">yHat2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">pterms</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># and all the plotting</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;y1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;y2&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yHat1</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;y1 fit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yHat2</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;y2 fit&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/00b308b4965f892141fe514cede0bdc83c58bad503511f5c91b7088567ac0ba5.png" src="../../_images/00b308b4965f892141fe514cede0bdc83c58bad503511f5c91b7088567ac0ba5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute R2</span>

<span class="c1"># compute R2 for several polynomial orders</span>
<span class="n">orders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>

<span class="c1"># output matrices</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">orders</span><span class="p">)))</span>
<span class="n">sse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">orders</span><span class="p">)))</span>

<span class="c1"># the loop!</span>
<span class="k">for</span> <span class="n">oi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">orders</span><span class="p">)):</span>
    
    <span class="c1"># fit the model with oi terms</span>
    <span class="n">pterms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">orders</span><span class="p">[</span><span class="n">oi</span><span class="p">])</span>
    <span class="n">yHat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">pterms</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
    
    <span class="c1"># compute R2</span>
    <span class="n">ss_eta</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">y1</span><span class="o">-</span><span class="n">yHat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># numerator</span>
    <span class="n">ss_tot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">y1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># denominator</span>
    <span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">oi</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ss_eta</span><span class="o">/</span><span class="n">ss_tot</span>  <span class="c1"># R^2</span>
    <span class="n">sse</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">oi</span><span class="p">]</span> <span class="o">=</span> <span class="n">ss_eta</span>  <span class="c1"># store just the SSe for model comparison later</span>
    
    
    <span class="c1">### repeat for y2</span>
    <span class="n">pterms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">orders</span><span class="p">[</span><span class="n">oi</span><span class="p">])</span>
    <span class="n">yHat</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">pterms</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ss_eta</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">y2</span><span class="o">-</span><span class="n">yHat</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ss_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">oi</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ss_eta</span><span class="o">/</span><span class="n">ss_tot</span>
    <span class="n">sse</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">oi</span><span class="p">]</span> <span class="o">=</span> <span class="n">ss_eta</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="c1"># plot the R2 results</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders</span><span class="p">,</span><span class="n">r2</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="s1">&#39;s-&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders</span><span class="p">,</span><span class="n">r2</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="s1">&#39;s-&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Model $R^2$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;y1&#39;</span><span class="p">,</span><span class="s1">&#39;y2&#39;</span><span class="p">))</span>



<span class="c1"># compute the Bayes Information Criterion</span>
<span class="n">bic</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sse</span><span class="p">)</span> <span class="o">+</span> <span class="n">orders</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders</span><span class="p">,</span><span class="n">bic</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="s1">&#39;s-&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orders</span><span class="p">,</span><span class="n">bic</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="s1">&#39;s-&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Polynomial model order&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Model BIC&#39;</span><span class="p">)</span>

<span class="c1"># optional zoom</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">90</span><span class="p">,</span><span class="mi">120</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a0fa992f0f3f7f22ccea10bcb5342bf72c47805336168b6cca1d3ec37b12f771.png" src="../../_images/a0fa992f0f3f7f22ccea10bcb5342bf72c47805336168b6cca1d3ec37b12f771.png" />
</div>
</div>
</section>
<section id="multiple-regression">
<h2>Multiple regression<a class="headerlink" href="#multiple-regression" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>

<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## example: effects of sleep and study hours on exam scores</span>
<span class="c1">### create the data</span>

<span class="n">exam_scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ei</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">exam_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">exam_scores</span><span class="p">,</span><span class="mi">60</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="n">ei</span><span class="p">))</span>

<span class="n">hours_studied</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ave_sleep_hrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## plot the data</span>

<span class="c1">### stratify by hours studied</span>

<span class="c1"># fewer than 4 hours studied</span>
<span class="n">plotidx</span> <span class="o">=</span> <span class="n">hours_studied</span><span class="o">&lt;</span><span class="mf">4.1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ave_sleep_hrs</span><span class="p">[</span><span class="n">plotidx</span><span class="p">],</span><span class="n">exam_scores</span><span class="p">[</span><span class="n">plotidx</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># 5-6 hours studied</span>
<span class="n">plotidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">hours_studied</span><span class="o">&gt;</span><span class="mf">4.9</span><span class="p">,</span> <span class="n">hours_studied</span><span class="o">&lt;</span><span class="mf">6.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ave_sleep_hrs</span><span class="p">[</span><span class="n">plotidx</span><span class="p">],</span><span class="n">exam_scores</span><span class="p">[</span><span class="n">plotidx</span><span class="p">],</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

<span class="c1"># more than 6 hours</span>
<span class="n">plotidx</span> <span class="o">=</span> <span class="n">hours_studied</span><span class="o">&gt;</span><span class="mi">6</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ave_sleep_hrs</span><span class="p">[</span><span class="n">plotidx</span><span class="p">],</span><span class="n">exam_scores</span><span class="p">[</span><span class="n">plotidx</span><span class="p">],</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Hours of sleep&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Exam score&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;&lt;4 hours studied&#39;</span><span class="p">,</span><span class="s1">&#39;5-6 hours studied&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;7 hours studied&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/41f638890f1fe4db9e6b6da7e837bbf213b5ebc7139a6a3e81eeb26088b9b266.png" src="../../_images/41f638890f1fe4db9e6b6da7e837bbf213b5ebc7139a6a3e81eeb26088b9b266.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## multiple regression </span>

<span class="c1"># build the design matrix</span>
<span class="n">desmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">30</span><span class="p">,)),</span><span class="n">ave_sleep_hrs</span><span class="p">,</span><span class="n">hours_studied</span><span class="p">,</span><span class="n">ave_sleep_hrs</span><span class="o">*</span><span class="n">hours_studied</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

<span class="n">multireg</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">endog</span><span class="o">=</span><span class="n">exam_scores</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">desmat</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">multireg</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>            <td>y</td>        <th>  R-squared:         </th> <td>   0.993</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.992</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   1182.</td>
</tr>
<tr>
  <th>Date:</th>             <td>Sat, 12 Nov 2022</td> <th>  Prob (F-statistic):</th> <td>6.74e-28</td>
</tr>
<tr>
  <th>Time:</th>                 <td>04:11:04</td>     <th>  Log-Likelihood:    </th> <td> -21.269</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>    30</td>      <th>  AIC:               </th> <td>   50.54</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>    26</td>      <th>  BIC:               </th> <td>   56.14</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     3</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
    <td></td>       <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th> <td>   82.4315</td> <td>    1.700</td> <td>   48.491</td> <td> 0.000</td> <td>   78.937</td> <td>   85.926</td>
</tr>
<tr>
  <th>x1</th>    <td>   -3.4511</td> <td>    0.215</td> <td>  -16.087</td> <td> 0.000</td> <td>   -3.892</td> <td>   -3.010</td>
</tr>
<tr>
  <th>x2</th>    <td>   -7.6663</td> <td>    0.321</td> <td>  -23.916</td> <td> 0.000</td> <td>   -8.325</td> <td>   -7.007</td>
</tr>
<tr>
  <th>x3</th>    <td>    1.1736</td> <td>    0.040</td> <td>   29.623</td> <td> 0.000</td> <td>    1.092</td> <td>    1.255</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>10.899</td> <th>  Durbin-Watson:     </th> <td>   1.069</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.004</td> <th>  Jarque-Bera (JB):  </th> <td>   3.273</td>
</tr>
<tr>
  <th>Skew:</th>          <td>-0.438</td> <th>  Prob(JB):          </th> <td>   0.195</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 1.640</td> <th>  Cond. No.          </th> <td>    821.</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># without the interaction term</span>

<span class="n">multireg</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">endog</span><span class="o">=</span><span class="n">exam_scores</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="n">desmat</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">multireg</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>            <td>y</td>        <th>  R-squared:         </th> <td>   0.747</td>
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.728</td>
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>   39.86</td>
</tr>
<tr>
  <th>Date:</th>             <td>Sat, 12 Nov 2022</td> <th>  Prob (F-statistic):</th> <td>8.76e-09</td>
</tr>
<tr>
  <th>Time:</th>                 <td>04:11:16</td>     <th>  Log-Likelihood:    </th> <td> -74.492</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>    30</td>      <th>  AIC:               </th> <td>   155.0</td>
</tr>
<tr>
  <th>Df Residuals:</th>          <td>    27</td>      <th>  BIC:               </th> <td>   159.2</td>
</tr>
<tr>
  <th>Df Model:</th>              <td>     2</td>      <th>                     </th>     <td> </td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>   
</tr>
</table>
<table class="simpletable">
<tr>
    <td></td>       <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>const</th> <td>   36.0556</td> <td>    3.832</td> <td>    9.409</td> <td> 0.000</td> <td>   28.193</td> <td>   43.918</td>
</tr>
<tr>
  <th>x1</th>    <td>    2.4167</td> <td>    0.477</td> <td>    5.071</td> <td> 0.000</td> <td>    1.439</td> <td>    3.395</td>
</tr>
<tr>
  <th>x2</th>    <td>    1.7222</td> <td>    0.278</td> <td>    6.203</td> <td> 0.000</td> <td>    1.153</td> <td>    2.292</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td> 0.189</td> <th>  Durbin-Watson:     </th> <td>   1.000</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.910</td> <th>  Jarque-Bera (JB):  </th> <td>   0.004</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 0.000</td> <th>  Prob(JB):          </th> <td>   0.998</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 2.943</td> <th>  Cond. No.          </th> <td>    66.6</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># inspect the correlations of the IVs</span>
<span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">desmat</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1.        , 0.19731231, 0.49270769],
       [0.19731231, 1.        , 0.94068915],
       [0.49270769, 0.94068915, 1.        ]])
</pre></div>
</div>
</div>
</div>
</section>
<section id="logistic-regression">
<h2>Logistic regression<a class="headerlink" href="#logistic-regression" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## generate the data</span>

<span class="n">exam_outcome</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
<span class="n">study_hours</span>  <span class="o">=</span> <span class="p">[</span><span class="mf">7.9</span><span class="p">,</span> <span class="mf">7.9</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">5.4</span><span class="p">,</span> <span class="mf">6.1</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">6.9</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">,</span> <span class="mf">4.7</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">7.7</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">,</span> <span class="mf">3.7</span><span class="p">]</span>
<span class="n">sleep_hours</span>  <span class="o">=</span> <span class="p">[</span><span class="mf">4.4</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">,</span> <span class="mf">4.6</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">,</span> <span class="mf">6.1</span><span class="p">,</span> <span class="mf">6.6</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">5.9</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">,</span> <span class="mf">7.8</span><span class="p">,</span> <span class="mf">6.1</span><span class="p">,</span> <span class="mf">5.4</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">,</span> <span class="mf">8.2</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">,</span> <span class="mf">5.9</span><span class="p">,</span> <span class="mf">7.9</span><span class="p">]</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exam_outcome</span><span class="p">)</span>

<span class="c1"># and plot</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">exam_outcome</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mf">.05</span><span class="p">,</span> <span class="n">exam_outcome</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">.05</span><span class="p">],[</span><span class="n">study_hours</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">sleep_hours</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">.7</span><span class="p">,</span><span class="mf">.7</span><span class="p">,</span><span class="mf">.7</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exam_outcome</span><span class="o">-</span><span class="mf">.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">study_hours</span><span class="p">,</span><span class="s1">&#39;ks&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mf">.8</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Study&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exam_outcome</span><span class="o">+</span><span class="mf">.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">sleep_hours</span><span class="p">,</span><span class="s1">&#39;ks&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="p">[</span><span class="mf">.39</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sleep&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">labels</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Fail&#39;</span><span class="p">,</span><span class="s1">&#39;Pass&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Hours sleep or study&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/401d34c157b44e01fdcbb3ebca1395158a71dc3b923df40dc2298657289c4370.png" src="../../_images/401d34c157b44e01fdcbb3ebca1395158a71dc3b923df40dc2298657289c4370.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now for the logistic regression</span>

<span class="c1"># create a model</span>
<span class="n">logregmodel</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">)</span><span class="c1">#&#39;newton-cg&#39;)#</span>

<span class="c1"># create the design matrix</span>
<span class="n">desmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">study_hours</span><span class="p">,</span><span class="n">sleep_hours</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

<span class="n">logregmodel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">desmat</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">exam_outcome</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">logregmodel</span><span class="o">.</span><span class="n">intercept_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">logregmodel</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-0.96510192]
[[-0.19445677  0.3361749 ]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute predictions and accuracy</span>

<span class="n">predvals</span> <span class="o">=</span> <span class="n">logregmodel</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">desmat</span><span class="p">)</span> <span class="c1"># class labels</span>
<span class="n">predvalsP</span> <span class="o">=</span> <span class="n">logregmodel</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">desmat</span><span class="p">)</span> <span class="c1"># probability values</span>

<span class="nb">print</span><span class="p">(</span><span class="n">predvals</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">exam_outcome</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">predvalsP</span><span class="p">)</span>

<span class="n">logregmodel</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">desmat</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">exam_outcome</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0 0 1 0 0 1 0 0 1 0 1 1 0 0 1 1 0 1 1 1]
[0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1]
[[0.7353894  0.2646106 ]
 [0.67987577 0.32012423]
 [0.26664125 0.73335875]
 [0.61509116 0.38490884]
 [0.5750111  0.4249889 ]
 [0.44756611 0.55243389]
 [0.52201059 0.47798941]
 [0.59150979 0.40849021]
 [0.343246   0.656754  ]
 [0.5209375  0.4790625 ]
 [0.27820281 0.72179719]
 [0.36617566 0.63382434]
 [0.50084824 0.49915176]
 [0.51592069 0.48407931]
 [0.1482976  0.8517024 ]
 [0.19740089 0.80259911]
 [0.51048841 0.48951159]
 [0.45229843 0.54770157]
 [0.49335028 0.50664972]
 [0.27464343 0.72535657]]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plotting</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">predvalsP</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ks&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">19</span><span class="p">],[</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">],</span><span class="s1">&#39;b--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">9.5</span><span class="p">,</span><span class="mf">9.5</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;b--&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Individual&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;p(pass)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">19.5</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/01c6af614ffbf6655454142cc00610eacf27a52107ac2aae9aba12915bd3ca4b.png" src="../../_images/01c6af614ffbf6655454142cc00610eacf27a52107ac2aae9aba12915bd3ca4b.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="clustering-and-dimension-reduction">
<h1>Clustering and dimension-reduction<a class="headerlink" href="#clustering-and-dimension-reduction" title="Permalink to this headline"></a></h1>
<section id="pca">
<h2>PCA<a class="headerlink" href="#pca" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Create the data</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1"># data</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="mf">.4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="p">])</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># rotation matrix</span>
<span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>
<span class="n">R1</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)]</span> <span class="p">]</span>

<span class="c1"># rotate data</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="nd">@np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">R1</span><span class="p">)</span>

<span class="n">axlim</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.1</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">())),</span> <span class="mf">1.1</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))]</span> <span class="c1"># axis limits</span>

<span class="c1"># and plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$X_1$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$X_2$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;square&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Data space&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a8b0c0dace4db44c8435dc9f832981f48d0595ee3fb09496b266e28bc63d7f4d.png" src="../../_images/a8b0c0dace4db44c8435dc9f832981f48d0595ee3fb09496b266e28bc63d7f4d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now for PCA</span>

<span class="c1"># PCA using scikitlearn&#39;s function</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># get the PC scores</span>
<span class="n">pcscores</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>


<span class="c1"># and plot</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;square&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">axlim</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">axlim</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$X_1$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$X_2$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Data space&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pcscores</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">pcscores</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;square&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">axlim</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">axlim</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$PC_1$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$PC_2$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PC space&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/30e19d33882d172c5491cef6a2036f30e52041d5314b16327422762b8b2acb96.png" src="../../_images/30e19d33882d172c5491cef6a2036f30e52041d5314b16327422762b8b2acb96.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## for dimension reduction</span>

<span class="n">spikes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;spikes.csv&#39;</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>


<span class="c1"># let&#39;s see it!</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spikes</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Average of all spikes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">spikes</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time points&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Individual spikes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/68ca11b246c0aa9d9ce95f74cfd3d03f7c23fd3a667eef5354d5c45431b4d553.png" src="../../_images/68ca11b246c0aa9d9ce95f74cfd3d03f7c23fd3a667eef5354d5c45431b4d553.png" />
<img alt="../../_images/42d49a1e9815b2af87a7ad6115eeb3ca84d2b0ccd881eee67c3e6461e9253f20.png" src="../../_images/42d49a1e9815b2af87a7ad6115eeb3ca84d2b0ccd881eee67c3e6461e9253f20.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## pca</span>

<span class="c1"># PCA using scikitlearn&#39;s function</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">spikes</span><span class="p">)</span>

<span class="c1"># get the PC scores and the eigenspectrum</span>
<span class="n">pcscores</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">spikes</span><span class="p">)</span>
<span class="n">explVar</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_</span>
<span class="n">explVar</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">explVar</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">explVar</span><span class="p">)</span> <span class="c1"># convert to %total</span>
<span class="n">coeffs</span>  <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">components_</span>


<span class="c1"># show the scree plot (a.k.a. eigenspectrum)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">explVar</span><span class="p">,</span><span class="s1">&#39;kp-&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Component number&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Percent variance explained&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">explVar</span><span class="p">),</span><span class="s1">&#39;kp-&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Component number&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative percent variance explained&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># now show the PC weights for the top two components</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">coeffs</span><span class="p">[</span><span class="mi">1</span><span class="p">,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Comp 1&#39;</span><span class="p">,</span><span class="s1">&#39;Comp 2&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PC weights (coefficients)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a017d9afceac558e4055f8ac5e2301cd23da16d546c8c2ca887887a349853d52.png" src="../../_images/a017d9afceac558e4055f8ac5e2301cd23da16d546c8c2ca887887a349853d52.png" />
<img alt="../../_images/a7894908143b2059db3dfb8f850e3dfee2d0b7a61bfa4d9167fcd16902b3f980.png" src="../../_images/a7894908143b2059db3dfb8f850e3dfee2d0b7a61bfa4d9167fcd16902b3f980.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## finally, show the PC scores</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pcscores</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">pcscores</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;k.&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;PC_1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PC_2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PC space&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/88795e68b1e170d00f9771ea05026c14002d27a9bb214427cb97696bcfd87385.png" src="../../_images/88795e68b1e170d00f9771ea05026c14002d27a9bb214427cb97696bcfd87385.png" />
</div>
</div>
</section>
<section id="k-nearest-neighbor">
<h2>K-nearest neighbor<a class="headerlink" href="#k-nearest-neighbor" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Create data</span>

<span class="n">nPerClust</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># XY centroid locations</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">[</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span>

<span class="c1"># generate data</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">[</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span> <span class="p">,</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span> <span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span> <span class="p">,</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span> <span class="p">]</span>

<span class="c1"># concatanate into a list</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
<span class="n">grouplabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)))</span>

<span class="c1"># group color assignment</span>
<span class="n">groupcolors</span> <span class="o">=</span> <span class="s1">&#39;br&#39;</span>

<span class="c1"># show the data</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">grouplabels</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">grouplabels</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ks&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="n">groupcolors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">grouplabels</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">grouplabels</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ks&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="n">groupcolors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c70b228ce5afa84c73adadf66ae8cc1b2c9f49100aacfc8f034d8589320238e7.png" src="../../_images/c70b228ce5afa84c73adadf66ae8cc1b2c9f49100aacfc8f034d8589320238e7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## compute distance matrix</span>

<span class="c1"># initialize</span>
<span class="n">distmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nPerClust</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="n">nPerClust</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># loop over elements</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nPerClust</span><span class="o">*</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nPerClust</span><span class="o">*</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">distmat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">distmat</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/96d667ea4e8b5c2c699167ec9c74b4e56443195f12b6f9ee9d09826a69a0b823.png" src="../../_images/96d667ea4e8b5c2c699167ec9c74b4e56443195f12b6f9ee9d09826a69a0b823.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create the new data point</span>

<span class="c1"># random new point</span>
<span class="n">newpoint</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>

<span class="c1"># and plot it</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">newpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">newpoint</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">MarkerFaceColor</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create the new data point</span>

<span class="c1"># random new point</span>
<span class="n">newpoint</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>

<span class="c1"># and plot it</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">newpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">newpoint</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">fig</span>
<span class="c1">#plt.show()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/70d2b7194ad3d0f2295a7412d30544fa449196e9d0bacda3a09fea4b964d87fd.png" src="../../_images/70d2b7194ad3d0f2295a7412d30544fa449196e9d0bacda3a09fea4b964d87fd.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute distance vector</span>
<span class="n">distvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPerClust</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nPerClust</span><span class="o">*</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">distvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">newpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">newpoint</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
    

<span class="c1"># show the distances</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distvec</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Data element index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Distance to new point&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0660dc5072893fcae2538a40e081af083e38a1536c4324b4883ef8e8673403a9.png" src="../../_images/0660dc5072893fcae2538a40e081af083e38a1536c4324b4883ef8e8673403a9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now for the labeling</span>

<span class="c1"># k parameter</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># sort the distances</span>
<span class="n">sortidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">distvec</span><span class="p">)</span>

<span class="c1"># find the group assignment of the nearest neighbors</span>
<span class="nb">print</span><span class="p">(</span><span class="n">grouplabels</span><span class="p">[</span><span class="n">sortidx</span><span class="p">[:</span><span class="n">k</span><span class="p">]])</span>
<span class="n">whichgroup</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">grouplabels</span><span class="p">[</span><span class="n">sortidx</span><span class="p">[:</span><span class="n">k</span><span class="p">]])</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New data belong to group &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">whichgroup</span><span class="p">))</span>

<span class="c1"># and re-plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">newpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">newpoint</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">newpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">newpoint</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="n">groupcolors</span><span class="p">[</span><span class="n">whichgroup</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">sortidx</span><span class="p">[:</span><span class="n">k</span><span class="p">],</span><span class="mi">0</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">sortidx</span><span class="p">[:</span><span class="n">k</span><span class="p">],</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">fillstyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0. 1. 1.]
New data belong to group 1
</pre></div>
</div>
<img alt="../../_images/47f0793dd22af956804b883fff3a8008f0a7277b398b37fb2abe8a41960752a0.png" src="../../_images/47f0793dd22af956804b883fff3a8008f0a7277b398b37fb2abe8a41960752a0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now using Python functions</span>
<span class="n">knn</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">)</span>
<span class="n">knn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">grouplabels</span><span class="p">)</span>

<span class="n">whichgroupP</span> <span class="o">=</span> <span class="n">knn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">newpoint</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="c1">#mode, _ = stats.mode(_y[neigh_ind, k], axis=1)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New data belong to group &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">whichgroupP</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>New data belong to group 0.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/m0/mambaforge/lib/python3.10/site-packages/sklearn/neighbors/_classification.py:228: FutureWarning: Unlike other reduction functions (e.g. `skew`, `kurtosis`), the default behavior of `mode` typically preserves the axis it acts along. In SciPy 1.11.0, this behavior will change: the default value of `keepdims` will become False, the `axis` over which the statistic is taken will be eliminated, and the value None will no longer be accepted. Set `keepdims` to True or False to avoid this warning.
  mode, _ = stats.mode(_y[neigh_ind, k], axis=1)
</pre></div>
</div>
</div>
</div>
</section>
<section id="k-means-clustering">
<h2>K-means clustering<a class="headerlink" href="#k-means-clustering" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pylab</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Create data</span>

<span class="n">nPerClust</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># blur around centroid (std units)</span>
<span class="n">blur</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># XY centroid locations</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">[</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="p">]</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="p">]</span>

<span class="c1"># generate data</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">[</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">blur</span> <span class="p">,</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">blur</span> <span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">blur</span> <span class="p">,</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">blur</span> <span class="p">]</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">[</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">blur</span> <span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">blur</span> <span class="p">]</span>

<span class="c1"># concatanate into a list</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>

<span class="c1"># show the data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;How k-means sees the data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/9ac6a2bdfe64b43c360f72c82de10d0bffdcd0cd8eeed0647034203571fb6206.png" src="../../_images/9ac6a2bdfe64b43c360f72c82de10d0bffdcd0cd8eeed0647034203571fb6206.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## k-means clustering</span>

<span class="n">k</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># how many clusters?</span>
<span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="n">kmeans</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># group labels</span>
<span class="n">groupidx</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># centroids</span>
<span class="n">cents</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span>

<span class="c1"># draw lines from each data point to the centroids of each cluster</span>
<span class="n">lineColors</span> <span class="o">=</span> <span class="s1">&#39;rgbgmrkbgm&#39;</span><span class="p">;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">cents</span><span class="p">[</span><span class="n">groupidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span> <span class="p">],[</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">cents</span><span class="p">[</span><span class="n">groupidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">]</span> <span class="p">],</span><span class="n">lineColors</span><span class="p">[</span><span class="n">groupidx</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>

<span class="c1"># and now plot the centroid locations</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cents</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">cents</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">)</span>

<span class="c1"># finally, the &quot;ground-truth&quot; centers</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;mp&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;mp&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;mp&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/90d489824620a6a540db031eaca4ce1db44ab0a8bddc750b1236aab0a41b4520.png" src="../../_images/90d489824620a6a540db031eaca4ce1db44ab0a8bddc750b1236aab0a41b4520.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## determining the appropriate number of clusters (qualitative)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    
    <span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">groupidx</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">cents</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span>
    
    <span class="c1"># draw lines from each data point to the centroids of each cluster</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">cents</span><span class="p">[</span><span class="n">groupidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span> <span class="p">],[</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">cents</span><span class="p">[</span><span class="n">groupidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">]</span> <span class="p">],</span><span class="n">lineColors</span><span class="p">[</span><span class="n">groupidx</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
    
    <span class="c1"># and now plot the centroid locations</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cents</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">cents</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> clusters&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/debdf32fdaac6ee1371cbff2d5fa4367904891de6a5b80fb9223e14267309358.png" src="../../_images/debdf32fdaac6ee1371cbff2d5fa4367904891de6a5b80fb9223e14267309358.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## number of clusters (quantative)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">silhouette_samples</span><span class="p">,</span> <span class="n">silhouette_score</span>

<span class="n">ssds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">sils</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="o">/</span><span class="mi">0</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
    <span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">ssds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">kmeans</span><span class="o">.</span><span class="n">inertia_</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">k</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">silhouette_samples</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">kmeans</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="n">sils</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span> <span class="n">s</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span><span class="n">ssds</span><span class="p">,</span><span class="s1">&#39;k^-&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;The elbow test&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span><span class="n">sils</span><span class="p">,</span><span class="s1">&#39;k^-&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;The silhouette test&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of clusters&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/93/6sy7vf8142969b_8w873sxcc0000gn/T/ipykernel_19313/4079972229.py:6: RuntimeWarning: invalid value encountered in divide
  sils = np.zeros(7)/0
</pre></div>
</div>
<img alt="../../_images/bc8071abfcf03e56fb19dc409e0e2b8c8c8c1c3297f4c55a8d312ab1eb5afca0.png" src="../../_images/bc8071abfcf03e56fb19dc409e0e2b8c8c8c1c3297f4c55a8d312ab1eb5afca0.png" />
<img alt="../../_images/1f7ac734a8e96ce2fc977ac41cb4a545a096e08fd34a2c3dfd8685390c518797.png" src="../../_images/1f7ac734a8e96ce2fc977ac41cb4a545a096e08fd34a2c3dfd8685390c518797.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Try again in 3D</span>

<span class="n">nPerClust</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># blur around centroid (std units)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># XY centroid locations</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">[</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span> <span class="p">]</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">2</span> <span class="p">]</span>

<span class="c1"># generate data</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">[</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="p">,</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="p">,</span> <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="p">,</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="p">,</span> <span class="n">B</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="p">]</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">[</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">n</span> <span class="p">]</span>

<span class="c1"># concatanate into a list</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>

<span class="c1"># show the data</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">Axes3D</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;How k-means sees the data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/93/6sy7vf8142969b_8w873sxcc0000gn/T/ipykernel_19313/2150109989.py:22: MatplotlibDeprecationWarning: Axes3D(fig) adding itself to the figure is deprecated since 3.4. Pass the keyword argument auto_add_to_figure=False and use fig.add_axes(ax) to suppress this warning. The default value of auto_add_to_figure will change to False in mpl3.5 and True values will no longer work in 3.6.  This is consistent with other Axes classes.
  ax = Axes3D(plt.figure())
</pre></div>
</div>
<img alt="../../_images/03431892762b3a232aefc2d7360f462b65810659b520b4ae3894da054327c044.png" src="../../_images/03431892762b3a232aefc2d7360f462b65810659b520b4ae3894da054327c044.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># how many clusters?</span>
<span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="n">kmeans</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># group labels</span>
<span class="n">groupidx</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># centroids</span>
<span class="n">cents</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span>

<span class="c1"># draw lines from each data point to the centroids of each cluster</span>
<span class="n">lineColors</span> <span class="o">=</span> <span class="s1">&#39;rgbgmrkbgm&#39;</span><span class="p">;</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">Axes3D</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">())</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">cents</span><span class="p">[</span><span class="n">groupidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span> <span class="p">],[</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">cents</span><span class="p">[</span><span class="n">groupidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">]</span> <span class="p">],[</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">cents</span><span class="p">[</span><span class="n">groupidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">2</span><span class="p">]</span> <span class="p">],</span><span class="n">lineColors</span><span class="p">[</span><span class="n">groupidx</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>

<span class="c1"># and now plot the centroid locations</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cents</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">cents</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">cents</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/93/6sy7vf8142969b_8w873sxcc0000gn/T/ipykernel_19313/3071357782.py:11: MatplotlibDeprecationWarning: Axes3D(fig) adding itself to the figure is deprecated since 3.4. Pass the keyword argument auto_add_to_figure=False and use fig.add_axes(ax) to suppress this warning. The default value of auto_add_to_figure will change to False in mpl3.5 and True values will no longer work in 3.6.  This is consistent with other Axes classes.
  ax = Axes3D(plt.figure())
</pre></div>
</div>
<img alt="../../_images/80651e87a8d1e6dd3a8c39df23b45511d63b18269b41ab48b00684273f469490.png" src="../../_images/80651e87a8d1e6dd3a8c39df23b45511d63b18269b41ab48b00684273f469490.png" />
</div>
</div>
</section>
<section id="ica">
<h2>ICA<a class="headerlink" href="#ica" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">FastICA</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Create the data</span>

<span class="c1">#number of data points</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c1">#a non-Gaussian distribution</span>
<span class="n">dist1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

<span class="c1"># another non-Gaussian distribution</span>
<span class="n">dist2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span>


<span class="c1"># setup the figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">constrained_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_gridspec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>


<span class="c1"># individual distributions</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">dist1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Distribution 1&#39;</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">dist2</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Distribution 2&#39;</span><span class="p">)</span>

<span class="c1"># and their summed histogram</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,:])</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">dist1</span><span class="o">+</span><span class="n">dist2</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Distributions 1+2&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0b6e1a14da5f30361df7e16531119d986887abd0166d99b62fea87703bb206eb.png" src="../../_images/0b6e1a14da5f30361df7e16531119d986887abd0166d99b62fea87703bb206eb.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## ICA</span>

<span class="c1"># two non-Gaussian distributions</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="mf">.4</span><span class="o">*</span><span class="n">dist1</span><span class="o">+</span><span class="mf">.3</span><span class="o">*</span><span class="n">dist2</span><span class="p">,</span> <span class="mf">.8</span><span class="o">*</span><span class="n">dist1</span><span class="o">-</span><span class="mf">.7</span><span class="o">*</span><span class="n">dist2</span><span class="p">))</span>

<span class="c1"># ICA and scores</span>
<span class="n">fastica</span> <span class="o">=</span> <span class="n">FastICA</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">.0000001</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">fastica</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">iscores</span> <span class="o">=</span> <span class="n">b</span><span class="nd">@data</span>


<span class="c1"># plot distributions</span>

<span class="c1"># IC 1</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">iscores</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;IC 1&#39;</span><span class="p">)</span>

<span class="c1"># IC 2</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">iscores</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;IC 2&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/294097d4103dc688431c84c3f3658458fad7b502313c6bef3c3edb1911f2192a.png" src="../../_images/294097d4103dc688431c84c3f3658458fad7b502313c6bef3c3edb1911f2192a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## look at the data in data space and IC space</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Data space&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">iscores</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">iscores</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;IC space&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0ce11ff6fa55feeb126eda82cd563fd856ffaa6d9258a304b16eb04427dad2e3.png" src="../../_images/0ce11ff6fa55feeb126eda82cd563fd856ffaa6d9258a304b16eb04427dad2e3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## show that the original data match the ICs</span>

<span class="c1"># now plot data as a function of ICs</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dist1</span><span class="p">,</span><span class="n">iscores</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Original signal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;IC1 scores&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dist2</span><span class="p">,</span><span class="n">iscores</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Original signal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;IC2 scores&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/05acb204f2a131ed0c20a650823101275046cae4ef8e51dd25a80638ddb9d4c1.png" src="../../_images/05acb204f2a131ed0c20a650823101275046cae4ef8e51dd25a80638ddb9d4c1.png" />
</div>
</div>
</section>
<section id="dbscan">
<h2>dbscan<a class="headerlink" href="#dbscan" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">DBSCAN</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Create data</span>

<span class="n">nPerClust</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c1"># blur around centroid (std units)</span>
<span class="n">blur</span> <span class="o">=</span> <span class="mf">.5</span>

<span class="c1"># XY centroid locations</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">[</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">]</span>
<span class="n">B</span> <span class="o">=</span> <span class="p">[</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="p">]</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">[</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="p">]</span>

<span class="c1"># generate data</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">[</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">blur</span> <span class="p">,</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">blur</span> <span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">blur</span> <span class="p">,</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">blur</span> <span class="p">]</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">[</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">blur</span> <span class="p">,</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nPerClust</span><span class="p">)</span><span class="o">*</span><span class="n">blur</span> <span class="p">]</span>

<span class="c1"># concatanate into a list</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>

<span class="c1"># show the data</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;How we see the data&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;square&#39;</span><span class="p">)</span>


<span class="c1">### distance matrix</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)):</span>
        <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;How dbscan sees the data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/db8cc611ccdd7dedd7a11053fc5524665e9fd427e9c720d5d5b089b31800840d.png" src="../../_images/db8cc611ccdd7dedd7a11053fc5524665e9fd427e9c720d5d5b089b31800840d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## dbscan</span>

<span class="n">clustmodel</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mf">.6</span><span class="p">,</span><span class="n">min_samples</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">groupidx</span> <span class="o">=</span> <span class="n">clustmodel</span><span class="o">.</span><span class="n">labels_</span>

<span class="c1"># number of clusters</span>
<span class="n">nclust</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">groupidx</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="c1"># +1 for indexing</span>

<span class="c1"># compute cluster centers</span>
<span class="n">cents</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nclust</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ci</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nclust</span><span class="p">):</span>
    <span class="n">cents</span><span class="p">[</span><span class="n">ci</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">groupidx</span><span class="o">==</span><span class="n">ci</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cents</span><span class="p">[</span><span class="n">ci</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">groupidx</span><span class="o">==</span><span class="n">ci</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cents</span><span class="p">)</span>

<span class="c1"># draw lines from each data point to the centroids of each cluster</span>
<span class="n">lineColors</span> <span class="o">=</span> <span class="s1">&#39;rkbgmrkbgmrkbgmrkbgmrkbgmrkbgmrkbgmrkbgmrkbgmrkbgmrkbgmrkbgm&#39;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">groupidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;k+&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">cents</span><span class="p">[</span><span class="n">groupidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span> <span class="p">],[</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">cents</span><span class="p">[</span><span class="n">groupidx</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">]</span> <span class="p">],</span><span class="n">lineColors</span><span class="p">[</span><span class="n">groupidx</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        

<span class="c1"># now draw the raw data in different colors</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nclust</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">groupidx</span><span class="o">==</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">groupidx</span><span class="o">==</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="n">lineColors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="c1"># and now plot the centroid locations</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cents</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">cents</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Result of dbscan clustering (k=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nclust</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>

<span class="c1"># finally, the &quot;ground-truth&quot; centers</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;kp&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;kp&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;kp&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[ 1.0453578   0.90278191]
 [-3.00904547  0.97478806]
 [ 3.0272797   3.09177565]]
</pre></div>
</div>
<img alt="../../_images/b1b0a36ffb38060df30c09bc22b3c437977bd89a5624829ce7640647cd4aac42.png" src="../../_images/b1b0a36ffb38060df30c09bc22b3c437977bd89a5624829ce7640647cd4aac42.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## testing the parameter space</span>

<span class="c1"># parameter ranges</span>
<span class="n">epsilons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">.1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
<span class="n">minpoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">31</span><span class="p">)</span>

<span class="c1"># initialize results matrix</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">epsilons</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">minpoints</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ei</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">epsilons</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">minpoints</span><span class="p">)):</span>
        <span class="n">clustmodel</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">epsilons</span><span class="p">[</span><span class="n">ei</span><span class="p">],</span><span class="n">min_samples</span><span class="o">=</span><span class="n">minpoints</span><span class="p">[</span><span class="n">di</span><span class="p">])</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">groupidx</span> <span class="o">=</span> <span class="n">clustmodel</span><span class="o">.</span><span class="n">labels_</span>
        <span class="n">results</span><span class="p">[</span><span class="n">ei</span><span class="p">,</span><span class="n">di</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">groupidx</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="n">ei</span><span class="p">,</span><span class="n">di</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">groupidx</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span>



<span class="c1"># for colormap discretization</span>
<span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="n">cm</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">aa</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">results</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                  <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">minpoints</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">minpoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">epsilons</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">epsilons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
                  <span class="n">aspect</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Minimum points&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Epsilon&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Number of groups&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">aa</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">results</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">],</span><span class="n">vmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span>
                  <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">minpoints</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">minpoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">epsilons</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">epsilons</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
                  <span class="n">aspect</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Minimum points&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Epsilon&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Number of &quot;noise&quot; points&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/659305505c24d40c460895ff1bcabaa51fe27b5c4cd3df6360ecad61d3fc230c.png" src="../../_images/659305505c24d40c460895ff1bcabaa51fe27b5c4cd3df6360ecad61d3fc230c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## determining the appropriate parameters</span>

<span class="c1"># NOTE: The thesis I linked in the video is no longer available. </span>
<span class="c1">#    There are several methods to determine an appropriate epsilon</span>
<span class="c1">#    parameter, depending on the nature of the data and level of</span>
<span class="c1">#    sophistication required. I hope the references below are helpful; you</span>
<span class="c1">#    can also google around to find more tips for picking parameters.</span>
<span class="c1"># </span>
<span class="c1"># https://towardsdatascience.com/machine-learning-clustering-dbscan-determine-the-optimal-value-for-epsilon-eps-python-example-3100091cfbc</span>
<span class="c1"># https://core.ac.uk/download/pdf/219373759.pdf</span>
<span class="c1"># https://www.biorxiv.org/content/10.1101/2020.07.09.195784v2.full.pdf</span>
 

<span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
    <span class="c1"># compute distance</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
    
    <span class="c1"># distance to 3rd closest point</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">D</span><span class="p">),</span><span class="s1">&#39;s-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0f82a9ee72d5f42e5e44d991866d9f51a9e504b1860fa49634c83613f3ab0f0c.png" src="../../_images/0f82a9ee72d5f42e5e44d991866d9f51a9e504b1860fa49634c83613f3ab0f0c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Try again with nonlinear clusters</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>

<span class="c1"># create the two circles</span>
<span class="n">data1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="mi">15</span>
<span class="n">data2</span> <span class="o">=</span> <span class="mf">.3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="mi">15</span>

<span class="c1"># put them together into one dataset</span>
<span class="n">circdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data1</span><span class="p">,</span><span class="n">data2</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">circdata</span><span class="p">))</span>

<span class="c1"># plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">circdata</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">circdata</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;square&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2000, 2)
</pre></div>
</div>
<img alt="../../_images/0a7963969cd1962e7015775ebfc5ba1e9f0f4c15cfb1de2e1029a1ab4b529e5a.png" src="../../_images/0a7963969cd1962e7015775ebfc5ba1e9f0f4c15cfb1de2e1029a1ab4b529e5a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## dbscan</span>

<span class="n">clustmodel</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mf">.2</span><span class="p">,</span><span class="n">min_samples</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">circdata</span><span class="p">)</span>
<span class="n">groupidx</span> <span class="o">=</span> <span class="n">clustmodel</span><span class="o">.</span><span class="n">labels_</span>

<span class="n">nclust</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">groupidx</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="c1"># +1 for indexing</span>

<span class="c1"># now draw the raw data in different colors</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nclust</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">circdata</span><span class="p">[</span><span class="n">groupidx</span><span class="o">==</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">circdata</span><span class="p">[</span><span class="n">groupidx</span><span class="o">==</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">lineColors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

<span class="c1"># and plot unassigned data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">circdata</span><span class="p">[</span><span class="n">groupidx</span><span class="o">==-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">circdata</span><span class="p">[</span><span class="n">groupidx</span><span class="o">==-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;k+&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;square&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Result of dbscan clustering (k=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nclust</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8a08091890a95815e3d847bb90802de986c27af25f2eecce5b22abb96ac7c61c.png" src="../../_images/8a08091890a95815e3d847bb90802de986c27af25f2eecce5b22abb96ac7c61c.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="correlation">
<h1>Correlation<a class="headerlink" href="#correlation" title="Permalink to this headline"></a></h1>
<section id="the-subgroups-correlation-paradox">
<h2>The subgroups correlation paradox<a class="headerlink" href="#the-subgroups-correlation-paradox" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initializations</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># sample points per group</span>
<span class="n">offsets</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="c1"># mean offsets</span>

<span class="n">allx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="n">ally</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

<span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;rbk&#39;</span> <span class="c1"># dot colors</span>

<span class="c1"># generate and plot data</span>
<span class="k">for</span> <span class="n">datai</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    
    <span class="c1"># generate data</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">offsets</span><span class="p">[</span><span class="n">datai</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">offsets</span><span class="p">[</span><span class="n">datai</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    
    <span class="c1"># subgroup correlation</span>
    <span class="n">r</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    
    <span class="c1"># plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="n">datai</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;r=</span><span class="si">{</span><span class="n">r</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, p=</span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="c1"># gather the data into one array</span>
    <span class="n">allx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">allx</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ally</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ally</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    


<span class="c1"># % now correlate the groups</span>
<span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">allx</span><span class="p">,</span><span class="n">ally</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;r=</span><span class="si">{</span><span class="n">r</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, p=</span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/59510c3178d5ea11f1149ef6b14f096ce8b22c729884cb34973d6f32721f8b14.png" src="../../_images/59510c3178d5ea11f1149ef6b14f096ce8b22c729884cb34973d6f32721f8b14.png" />
</div>
</div>
</section>
<section id="spearman-correlation-and-fisher-z">
<h2>Spearman correlation and Fisher-Z<a class="headerlink" href="#spearman-correlation-and-fisher-z" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="c1">## Anscobe&#39;s quartet</span>

<span class="n">anscombe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
     <span class="c1"># series 1     series 2      series 3       series 4</span>
    <span class="p">[</span><span class="mi">10</span><span class="p">,</span>  <span class="mf">8.04</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>  <span class="mf">9.14</span><span class="p">,</span>    <span class="mi">10</span><span class="p">,</span>  <span class="mf">7.46</span><span class="p">,</span>      <span class="mi">8</span><span class="p">,</span>  <span class="mf">6.58</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="mi">8</span><span class="p">,</span>  <span class="mf">6.95</span><span class="p">,</span>     <span class="mi">8</span><span class="p">,</span>  <span class="mf">8.14</span><span class="p">,</span>     <span class="mi">8</span><span class="p">,</span>  <span class="mf">6.77</span><span class="p">,</span>      <span class="mi">8</span><span class="p">,</span>  <span class="mf">5.76</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span><span class="mi">13</span><span class="p">,</span>  <span class="mf">7.58</span><span class="p">,</span>    <span class="mi">13</span><span class="p">,</span>  <span class="mf">8.76</span><span class="p">,</span>    <span class="mi">13</span><span class="p">,</span> <span class="mf">12.74</span><span class="p">,</span>      <span class="mi">8</span><span class="p">,</span>  <span class="mf">7.71</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="mi">9</span><span class="p">,</span>  <span class="mf">8.81</span><span class="p">,</span>     <span class="mi">9</span><span class="p">,</span>  <span class="mf">8.77</span><span class="p">,</span>     <span class="mi">9</span><span class="p">,</span>  <span class="mf">7.11</span><span class="p">,</span>      <span class="mi">8</span><span class="p">,</span>  <span class="mf">8.84</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span><span class="mi">11</span><span class="p">,</span>  <span class="mf">8.33</span><span class="p">,</span>    <span class="mi">11</span><span class="p">,</span>  <span class="mf">9.26</span><span class="p">,</span>    <span class="mi">11</span><span class="p">,</span>  <span class="mf">7.81</span><span class="p">,</span>      <span class="mi">8</span><span class="p">,</span>  <span class="mf">8.47</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span><span class="mi">14</span><span class="p">,</span>  <span class="mf">9.96</span><span class="p">,</span>    <span class="mi">14</span><span class="p">,</span>  <span class="mf">8.10</span><span class="p">,</span>    <span class="mi">14</span><span class="p">,</span>  <span class="mf">8.84</span><span class="p">,</span>      <span class="mi">8</span><span class="p">,</span>  <span class="mf">7.04</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="mi">6</span><span class="p">,</span>  <span class="mf">7.24</span><span class="p">,</span>     <span class="mi">6</span><span class="p">,</span>  <span class="mf">6.13</span><span class="p">,</span>     <span class="mi">6</span><span class="p">,</span>  <span class="mf">6.08</span><span class="p">,</span>      <span class="mi">8</span><span class="p">,</span>  <span class="mf">5.25</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="mi">4</span><span class="p">,</span>  <span class="mf">4.26</span><span class="p">,</span>     <span class="mi">4</span><span class="p">,</span>  <span class="mf">3.10</span><span class="p">,</span>     <span class="mi">4</span><span class="p">,</span>  <span class="mf">5.39</span><span class="p">,</span>      <span class="mi">8</span><span class="p">,</span>  <span class="mf">5.56</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mf">10.84</span><span class="p">,</span>    <span class="mi">12</span><span class="p">,</span>  <span class="mf">9.13</span><span class="p">,</span>    <span class="mi">12</span><span class="p">,</span>  <span class="mf">8.15</span><span class="p">,</span>      <span class="mi">8</span><span class="p">,</span>  <span class="mf">7.91</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="mi">7</span><span class="p">,</span>  <span class="mf">4.82</span><span class="p">,</span>     <span class="mi">7</span><span class="p">,</span>  <span class="mf">7.26</span><span class="p">,</span>     <span class="mi">7</span><span class="p">,</span>  <span class="mf">6.42</span><span class="p">,</span>      <span class="mi">8</span><span class="p">,</span>  <span class="mf">6.89</span><span class="p">,</span> <span class="p">],</span>
    <span class="p">[</span> <span class="mi">5</span><span class="p">,</span>  <span class="mf">5.68</span><span class="p">,</span>     <span class="mi">5</span><span class="p">,</span>  <span class="mf">4.74</span><span class="p">,</span>     <span class="mi">5</span><span class="p">,</span>  <span class="mf">5.73</span><span class="p">,</span>     <span class="mi">19</span><span class="p">,</span> <span class="mf">12.50</span><span class="p">,</span> <span class="p">]</span>
    <span class="p">])</span>


<span class="c1"># plot and compute correlations</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">anscombe</span><span class="p">[:,</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span><span class="n">anscombe</span><span class="p">[:,</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">corr_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">anscombe</span><span class="p">[:,</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span><span class="n">anscombe</span><span class="p">[:,</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">corr_s</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">anscombe</span><span class="p">[:,</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">],</span><span class="n">anscombe</span><span class="p">[:,</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;r_p = </span><span class="si">%g</span><span class="s1">, r_s = </span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">corr_p</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">corr_s</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ca8f826a37a8009cc4d62b9170f7eac26c478ad5aca67cc58289724c1963cdf2.png" src="../../_images/ca8f826a37a8009cc4d62b9170f7eac26c478ad5aca67cc58289724c1963cdf2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Fisher-Z transform</span>


<span class="c1"># simulate correlation coefficients</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">r</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

<span class="c1"># Fisher-Z</span>
<span class="n">fz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>



<span class="c1"># overlay the Fisher-Z</span>
<span class="n">y</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">fz</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># raw correlations</span>
<span class="n">y</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;r / f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Fisher-Z&#39;</span><span class="p">,</span><span class="s1">&#39;Raw r&#39;</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7f8e1b9e54914c9b52de8f651276d4fc216a2817300e2a54db6824abd120ad93.png" src="../../_images/7f8e1b9e54914c9b52de8f651276d4fc216a2817300e2a54db6824abd120ad93.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">fz</span><span class="p">),</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Correlation&#39;</span><span class="p">,</span><span class="s1">&#39;Fisher-Z&#39;</span><span class="p">))</span>

<span class="c1"># zoom in</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">.8</span><span class="p">,</span><span class="mf">.8</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7417f36de3a429ea447b076eb5ec46afb155a75256952ff688273a05a3102c50.png" src="../../_images/7417f36de3a429ea447b076eb5ec46afb155a75256952ff688273a05a3102c50.png" />
</div>
</div>
</section>
<section id="partial-correlations">
<h2>Partial correlations<a class="headerlink" href="#partial-correlations" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># I&#39;m using pingouin for partial correlations.</span>
<span class="c1"># You might need to install it, e.g., using the line below.</span>
<span class="c1"># This needs to be run only once per install.</span>
<span class="c1"># conda install -c conda-forge pingouin</span>
<span class="kn">import</span> <span class="nn">pingouin</span> <span class="k">as</span> <span class="nn">pg</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/m0/mambaforge/lib/python3.10/site-packages/outdated/utils.py:14: OutdatedPackageWarning: The package outdated is out of date. Your version is 0.2.1, the latest is 0.2.2.
Set the environment variable OUTDATED_IGNORE=1 to disable these warnings.
  return warn(
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## the example from the video</span>

<span class="c1"># raw correlations</span>
<span class="n">rmg</span> <span class="o">=</span> <span class="mf">.7</span>
<span class="n">rsg</span> <span class="o">=</span> <span class="mf">.8</span>
<span class="n">rms</span> <span class="o">=</span> <span class="mf">.9</span>

<span class="c1"># partial correlations</span>
<span class="n">rho_mg_s</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmg</span> <span class="o">-</span> <span class="n">rsg</span><span class="o">*</span><span class="n">rms</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">rsg</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">rms</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
<span class="n">rho_sg_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">rsg</span> <span class="o">-</span> <span class="n">rmg</span><span class="o">*</span><span class="n">rms</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">rmg</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">rms</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">rho_mg_s</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rho_sg_m</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.07647191129018778
0.5461186812727504
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now for datasets</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">76</span>

<span class="c1"># correlated datasets</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

<span class="c1"># let&#39;s convert these data to a pandas frame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x1</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x2</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;x3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x3</span>

<span class="c1"># compute the &quot;raw&quot; correlation matrix</span>
<span class="n">cormatR</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cormatR</span><span class="p">)</span>

<span class="c1"># print out one value</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cormatR</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># partial correlation</span>
<span class="n">pc</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">partial_corr</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x3&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;x2&#39;</span><span class="p">,</span><span class="n">covar</span><span class="o">=</span><span class="s1">&#39;x1&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          x1        x2        x3
x1  1.000000  0.935740  0.941297
x2  0.935740  1.000000  0.890838
x3  0.941297  0.890838  1.000000
 
0.9357395927939934
 
          n         r          CI95%     p-val
pearson  76  0.084235  [-0.15, 0.31]  0.472434
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## visualize the matrices</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="c1"># raw correlations</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cormatR</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="c1"># add text </span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">cormatR</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="mi">2</span><span class="p">),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

        
        
<span class="c1"># partial correlations</span>
<span class="n">partialCorMat</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pcorr</span><span class="p">()</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">partialCorMat</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">partialCorMat</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="mi">2</span><span class="p">),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ec7e4d72475596d9123272bd85b1e08bcee0418c5b521e1800c3ff3991970c41.png" src="../../_images/ec7e4d72475596d9123272bd85b1e08bcee0418c5b521e1800c3ff3991970c41.png" />
</div>
</div>
</section>
<section id="kendall-correlation">
<h2>Kendall correlation<a class="headerlink" href="#kendall-correlation" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## generate some data!</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">40</span>

<span class="c1"># movie ratings</span>
<span class="n">docuRatings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">high</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>

<span class="c1"># education level (1-4, correlated with docuRatings)</span>
<span class="n">eduLevel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span> <span class="p">(</span><span class="n">docuRatings</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">high</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span> <span class="p">)</span><span class="o">/</span><span class="mi">9</span> <span class="o">*</span> <span class="mi">4</span> <span class="p">)</span>

<span class="c1"># compute the correlations</span>
<span class="n">cr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">kendalltau</span><span class="p">(</span><span class="n">eduLevel</span><span class="p">,</span><span class="n">docuRatings</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">eduLevel</span><span class="p">,</span><span class="n">docuRatings</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">eduLevel</span><span class="p">,</span><span class="n">docuRatings</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># round for convenience</span>
<span class="n">cr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>


<span class="c1"># plot the data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eduLevel</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="mi">30</span><span class="p">,</span><span class="n">docuRatings</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="mi">30</span><span class="p">,</span><span class="s1">&#39;ks&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">.25</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Education level&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Documentary ratings&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;$r_k$ = </span><span class="si">%g</span><span class="s1">, $r_p$=</span><span class="si">%g</span><span class="s1">, $r_s$=</span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">cr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">cr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">cr</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8a21012915494f77bb0e003ce3b5650be4835e286b64912399f53d9043808070.png" src="../../_images/8a21012915494f77bb0e003ce3b5650be4835e286b64912399f53d9043808070.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## correlation estimation errors under H0</span>

<span class="n">numExprs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">nValues</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">nCategories</span> <span class="o">=</span> <span class="mi">6</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numExprs</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numExprs</span><span class="p">):</span>
    
    <span class="c1"># create data</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">high</span><span class="o">=</span><span class="n">nCategories</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">nValues</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">high</span><span class="o">=</span><span class="n">nCategories</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">nValues</span><span class="p">)</span>
    
    <span class="c1"># store correlations</span>
    <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">stats</span><span class="o">.</span><span class="n">kendalltau</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
               <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
               <span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## show the graphs</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),(</span><span class="s1">&#39;Kendall&#39;</span><span class="p">,</span><span class="s1">&#39;Pearson&#39;</span><span class="p">,</span><span class="s1">&#39;Spearman&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Squared correlation error&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Noise correlation ($r^2$) distributions&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="p">[:</span><span class="mi">100</span><span class="p">,:],</span><span class="s1">&#39;s-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Experiment number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Correlation value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">T</span><span class="p">),</span><span class="n">vmin</span><span class="o">=</span><span class="mf">.9</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),[</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation matrix&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8574c77a393f0728d6c4660f7d5a138cb9936cad01a98bfa765412e37a7f7301.png" src="../../_images/8574c77a393f0728d6c4660f7d5a138cb9936cad01a98bfa765412e37a7f7301.png" />
<img alt="../../_images/d2b52b5e304605d9b0e553e322cd1162eea95c61c4140bd0c456a93446d4e07e.png" src="../../_images/d2b52b5e304605d9b0e553e322cd1162eea95c61c4140bd0c456a93446d4e07e.png" />
<img alt="../../_images/9a1b960699cecb953b970c959afa0f4c5037abaa5bec5d2d13b55e9215b31ad1.png" src="../../_images/9a1b960699cecb953b970c959afa0f4c5037abaa5bec5d2d13b55e9215b31ad1.png" />
</div>
</div>
</section>
<section id="simulate-data-with-specified-correlation">
<h2>Simulate data with specified correlation<a class="headerlink" href="#simulate-data-with-specified-correlation" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## simulate data</span>

<span class="c1"># data simulation parameters</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># number of samples</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">.6</span>   <span class="c1"># desired correlation coefficient</span>

<span class="c1"># start with random numbers</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

<span class="c1"># impose the correlation on y</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">r</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># plot the data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;kp&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Variable X&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Variable Y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f7c4cd225c44b09aa1ec24dfadeb52c0336409d51794fd9b363ccfd2f741fc97.png" src="../../_images/f7c4cd225c44b09aa1ec24dfadeb52c0336409d51794fd9b363ccfd2f741fc97.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## compute the empirical correlation</span>

<span class="n">empR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Desired r=</span><span class="si">%g</span><span class="s1">, empirical r=</span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">empR</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Desired r=0.6, empirical r=0.699157
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Test the errors as a function of N</span>

<span class="c1"># range of sample sizes</span>
<span class="n">Ns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">123</span><span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># theoretical correlation coefficient (fixed)</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">.6</span>

<span class="c1"># initialize</span>
<span class="n">corrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Ns</span><span class="p">))</span>

<span class="c1"># run the experiment!</span>
<span class="k">for</span> <span class="n">ni</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Ns</span><span class="p">)):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">Ns</span><span class="p">[</span><span class="n">ni</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">r</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">Ns</span><span class="p">[</span><span class="n">ni</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">corrs</span><span class="p">[</span><span class="n">ni</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
    

<span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">Ns</span><span class="p">,</span><span class="n">corrs</span><span class="p">,</span><span class="s1">&#39;ko-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Sample size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Squared divergence&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/85a5eec01e97ba3b58c6b3fc73a86917180f7e8cf2ca2590006e3e9d61c52b3f.png" src="../../_images/85a5eec01e97ba3b58c6b3fc73a86917180f7e8cf2ca2590006e3e9d61c52b3f.png" />
</div>
</div>
</section>
<section id="cosine-similarity">
<h2>Cosine similarity<a class="headerlink" href="#cosine-similarity" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">spatial</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># range of requested correlation coefficients</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># sample size</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">500</span>


<span class="c1"># initialize output matrix</span>
<span class="n">corrs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">rs</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>


<span class="c1"># loop over a range of r values</span>
<span class="k">for</span> <span class="n">ri</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rs</span><span class="p">)):</span>
    
    <span class="c1"># generate data</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">rs</span><span class="p">[</span><span class="n">ri</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">rs</span><span class="p">[</span><span class="n">ri</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># optional mean-off-centering</span>
    <span class="c1">#x = x+10</span>
    <span class="c1">#y = y+10</span>
    
    
    <span class="c1"># compute correlation</span>
    <span class="n">corrs</span><span class="p">[</span><span class="n">ri</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># compute cosine similarity</span>
    <span class="n">cs_num</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>
    <span class="n">cs_den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">))</span>
    <span class="n">corrs</span><span class="p">[</span><span class="n">ri</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cs_num</span> <span class="o">/</span> <span class="n">cs_den</span>
    
    <span class="c1"># using built-in distance function</span>
    <span class="c1">#corrs[ri,1] = 1-spatial.distance.cosine(x,y)</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## visualize the results</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span><span class="n">corrs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;s-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Correlation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span><span class="n">corrs</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;s-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cosine sim.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Requested correlation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Empirical correlation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;square&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">corrs</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">corrs</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ks&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;square&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Correlation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cosine similarity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2214b2a8498b955fe80374fec8cfd19ee5676b19d1a758eea708d4a292c26cc0.png" src="../../_images/2214b2a8498b955fe80374fec8cfd19ee5676b19d1a758eea708d4a292c26cc0.png" />
<img alt="../../_images/5eb02743aa1e250a2406b035d75a823cebefc3b4fe8f6d67e2adee18d9c6c304.png" src="../../_images/5eb02743aa1e250a2406b035d75a823cebefc3b4fe8f6d67e2adee18d9c6c304.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># their empirical correlation</span>
<span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">corrs</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1.        , 0.99999602],
       [0.99999602, 1.        ]])
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="correlation-matrix">
<h1>Correlation matrix<a class="headerlink" href="#correlation-matrix" title="Permalink to this headline"></a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.matlib</span> <span class="k">as</span> <span class="nn">matlib</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## simulate data</span>

<span class="c1"># simulation parameters</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># time points</span>
<span class="n">M</span> <span class="o">=</span>   <span class="mi">20</span>  <span class="c1"># channels</span>

<span class="c1"># time vector (radian units)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>

<span class="c1"># relationship across channels (imposing covariance)</span>
<span class="n">chanrel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">M</span><span class="p">))</span>

<span class="c1"># create the data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
<span class="k">for</span> <span class="n">mi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="n">mi</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">chanrel</span><span class="p">[</span><span class="n">mi</span><span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
    

<span class="c1"># two ways of visualizing the multichannel data</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (a.u.)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Channel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">M</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (a.u.)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Channel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/cb045b07c36f73553f1ee98b131ce324178d0df4f720b6ff2943bacf52712715.png" src="../../_images/cb045b07c36f73553f1ee98b131ce324178d0df4f720b6ff2943bacf52712715.png" />
<img alt="../../_images/d279e41d62afa72251da2e434ac35a1314195934cce66e0fbeff56b888c38c33.png" src="../../_images/d279e41d62afa72251da2e434ac35a1314195934cce66e0fbeff56b888c38c33.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now compute the covariance matrix</span>

<span class="c1"># note the size of the output!</span>
<span class="n">dataCovMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dataCovMat</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mf">.5</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Data covariance matrix&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;??&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;??&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d0c701be85997841573ebd4cb3d5edb8d742cf958557997f3f16ea4308677b5d.png" src="../../_images/d0c701be85997841573ebd4cb3d5edb8d742cf958557997f3f16ea4308677b5d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## and now the correlation matrix</span>

<span class="c1"># note the size of the output!</span>
<span class="n">dataCorrMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dataCorrMat</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mf">.5</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Data correlation matrix&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;??&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;??&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/844c24b758be337632f01ae70748a143d308520a9f1b1d85fa6c5fbfb0236769.png" src="../../_images/844c24b758be337632f01ae70748a143d308520a9f1b1d85fa6c5fbfb0236769.png" />
</div>
</div>
<section id="correlation-coefficient">
<h2>Correlation coefficient<a class="headerlink" href="#correlation-coefficient" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## simulate data</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">66</span>

<span class="c1"># generate correlated data</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

<span class="c1"># plot the data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;kp&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Variable X&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Variable Y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c43c3173b7eabc65c854f91d72a4552f3db4fa377f225e4e46f5b98b7fb90314.png" src="../../_images/c43c3173b7eabc65c854f91d72a4552f3db4fa377f225e4e46f5b98b7fb90314.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## compute covariance</span>

<span class="c1"># precompute the means</span>
<span class="n">meanX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">meanY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c1">### the loop method</span>
<span class="n">covar1</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">covar1</span> <span class="o">=</span> <span class="n">covar1</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">meanX</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">meanY</span><span class="p">)</span>
    

<span class="c1"># and now for the normalization</span>
<span class="n">covar1</span> <span class="o">=</span> <span class="n">covar1</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">### the linear algebra method</span>
<span class="n">xCent</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="n">meanX</span>
<span class="n">yCent</span> <span class="o">=</span> <span class="n">y</span><span class="o">-</span><span class="n">meanY</span>
<span class="n">covar2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xCent</span><span class="p">,</span><span class="n">yCent</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">### the Python method</span>
<span class="n">covar3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">covar1</span><span class="p">,</span><span class="n">covar2</span><span class="p">,</span><span class="n">covar3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6257765926196556 0.6257765926196555 [[0.72450778 0.62577659]
 [0.62577659 1.44477906]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now for correlation</span>

<span class="c1">### the long method</span>
<span class="n">corr_num</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">meanX</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">meanY</span><span class="p">)</span> <span class="p">)</span>
<span class="n">corr_den</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">meanX</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">((</span><span class="n">y</span><span class="o">-</span><span class="n">meanY</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">corr1</span> <span class="o">=</span> <span class="n">corr_num</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">corr_den</span><span class="p">)</span>


<span class="c1">### the Python method</span>
<span class="n">corr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">corr1</span><span class="p">,</span><span class="n">corr2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6116416748742647 [[1.         0.61164167]
 [0.61164167 1.        ]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## correlation as normalized covariance</span>

<span class="n">xn</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">yn</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="n">corr3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xn</span><span class="p">,</span><span class="n">yn</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">corr3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.616328652802379
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## 2D t-value space based on r and n</span>

<span class="c1"># define parameters</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">248</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">73</span><span class="p">)</span> <span class="p">)</span>

<span class="c1"># initialize t-value matrix</span>
<span class="n">tmatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
<span class="n">pmatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">ri</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">ni</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)):</span>
        
        <span class="c1"># the t-value, split into num/den</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">ri</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">ni</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">den</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">r</span><span class="p">[</span><span class="n">ri</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
        
        <span class="n">tmatrix</span><span class="p">[</span><span class="n">ri</span><span class="p">,</span><span class="n">ni</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="o">/</span><span class="n">den</span>
        <span class="n">pmatrix</span><span class="p">[</span><span class="n">ri</span><span class="p">,</span><span class="n">ni</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">num</span><span class="o">/</span><span class="n">den</span><span class="p">),</span><span class="n">n</span><span class="p">[</span><span class="n">ni</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

        
        
<span class="c1"># Soooo curious to see it!</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tmatrix</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">n</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">pmatrix</span><span class="o">&lt;</span><span class="mf">.05</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">n</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Sample size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Correlation coefficient&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;T-values from different r-n combos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># question: Why the warning message?</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/93/6sy7vf8142969b_8w873sxcc0000gn/T/ipykernel_19313/2667870172.py:18: RuntimeWarning: divide by zero encountered in double_scalars
  tmatrix[ri,ni] = num/den
/var/folders/93/6sy7vf8142969b_8w873sxcc0000gn/T/ipykernel_19313/2667870172.py:19: RuntimeWarning: divide by zero encountered in double_scalars
  pmatrix[ri,ni] = 1-stats.t.cdf(abs(num/den),n[ni]-2)
</pre></div>
</div>
<img alt="../../_images/63b588eaf018726ac833d1866fed50b14fc15cbc48136a2b005f24472d4b6d32.png" src="../../_images/63b588eaf018726ac833d1866fed50b14fc15cbc48136a2b005f24472d4b6d32.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># final note on statistical significance</span>

<span class="n">r</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6116416748742646 4.878520544773139e-08
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="the-t-test-family">
<h1>The t-test family<a class="headerlink" href="#the-t-test-family" title="Permalink to this headline"></a></h1>
<section id="two-samples-t-test">
<h2>Two-samples t-test<a class="headerlink" href="#two-samples-t-test" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## generate the data</span>

<span class="c1"># parameters</span>
<span class="n">n1</span> <span class="o">=</span> <span class="mi">30</span>   <span class="c1"># samples in dataset 1</span>
<span class="n">n2</span> <span class="o">=</span> <span class="mi">40</span>   <span class="c1"># ...and 2</span>
<span class="n">mu1</span> <span class="o">=</span> <span class="mi">1</span>   <span class="c1"># population mean in dataset 1</span>
<span class="n">mu2</span> <span class="o">=</span> <span class="mf">1.2</span> <span class="c1"># population mean in dataset 2</span>


<span class="c1"># generate the data</span>
<span class="n">data1</span> <span class="o">=</span> <span class="n">mu1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
<span class="n">data2</span> <span class="o">=</span> <span class="n">mu2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>

<span class="c1"># show their histograms</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="s1">&#39;fd&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">.5</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="s1">&#39;fd&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">.5</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data 2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Data value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/50965b5bdc7a2198c1f93bdf406a04258e37229b03cf8380f47f339cb60ceae7.png" src="../../_images/50965b5bdc7a2198c1f93bdf406a04258e37229b03cf8380f47f339cb60ceae7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now for the t-test</span>

<span class="n">t</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="n">data2</span><span class="p">,</span><span class="n">equal_var</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">n1</span><span class="o">+</span><span class="n">n2</span><span class="o">-</span><span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;t(</span><span class="si">%g</span><span class="s1">) = </span><span class="si">%g</span><span class="s1">, p=</span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t(68) = 1.68558, p=0.0964602
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## a 2D space of t values</span>

<span class="c1"># ranges for t-value parameters</span>
<span class="n">meandiffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">80</span><span class="p">)</span>
<span class="n">pooledvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">.5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># group sample size</span>
<span class="n">n1</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">n2</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># initialize output matrix</span>
<span class="n">allTvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">meandiffs</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">pooledvar</span><span class="p">)))</span>

<span class="c1"># loop over the parameters...</span>
<span class="k">for</span> <span class="n">meani</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">meandiffs</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">vari</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pooledvar</span><span class="p">)):</span>
        
        <span class="c1"># t-value denominator</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="n">s</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span> <span class="p">(</span><span class="n">n1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pooledvar</span><span class="p">[</span><span class="n">vari</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">n2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">pooledvar</span><span class="p">[</span><span class="n">vari</span><span class="p">])</span> <span class="o">/</span> <span class="n">df</span><span class="p">)</span>
        <span class="n">t_den</span> <span class="o">=</span> <span class="n">s</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">n1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">n2</span><span class="p">)</span>
        
        <span class="c1"># t-value in the matrix</span>
        <span class="n">allTvals</span><span class="p">[</span><span class="n">meani</span><span class="p">,</span><span class="n">vari</span><span class="p">]</span> <span class="o">=</span> <span class="n">meandiffs</span><span class="p">[</span><span class="n">meani</span><span class="p">]</span> <span class="o">/</span> <span class="n">t_den</span>

        
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">allTvals</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">4</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">pooledvar</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pooledvar</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">meandiffs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">meandiffs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Variance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mean differences&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;t-values as a function of difference and variance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/fb2d4fa882760e3e30682e9938b135340368430abe7e09d3d7b8437775b85e73.png" src="../../_images/fb2d4fa882760e3e30682e9938b135340368430abe7e09d3d7b8437775b85e73.png" />
</div>
</div>
</section>
<section id="signed-rank-test-wilcoxon-signed-rank-for-one-sample-or-paired-samples">
<h2>Signed-rank test (Wilcoxon signed-rank for one-sample or paired samples)<a class="headerlink" href="#signed-rank-test-wilcoxon-signed-rank-for-one-sample-or-paired-samples" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## generate the data</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">30</span>

<span class="n">data1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">data2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="s1">&#39;kr&#39;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">data1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data2</span><span class="p">[</span><span class="n">i</span><span class="p">]],[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span><span class="n">colors</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">data1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="n">data2</span><span class="p">[</span><span class="n">i</span><span class="p">])])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="s1">&#39;ks&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;data1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;data2&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Data index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Data value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/772f12ec3fe16ce1af2aa339c966146471eec365efe992e284bd11f78fd8fca7.png" src="../../_images/772f12ec3fe16ce1af2aa339c966146471eec365efe992e284bd11f78fd8fca7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now for the test</span>

<span class="n">t</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">wilcoxon</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="n">data2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Wilcoxon z=</span><span class="si">%g</span><span class="s1">, p=</span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Wilcoxon z=90.5, p=0.13196
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/m0/mambaforge/lib/python3.10/site-packages/scipy/stats/_morestats.py:3337: UserWarning: Exact p-value calculation does not work if there are zeros. Switching to normal approximation.
  warnings.warn(&quot;Exact p-value calculation does not work if there are &quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now for the 2D space</span>

<span class="c1"># parameter ranges</span>
<span class="n">Ns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">51</span><span class="p">)</span>
<span class="n">lambdas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>

<span class="c1"># initialize output matrix</span>
<span class="n">pvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Ns</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">lambdas</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">ni</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Ns</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lambdas</span><span class="p">)):</span>
        
        <span class="c1"># generate some data</span>
        <span class="n">data1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">lambdas</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Ns</span><span class="p">[</span><span class="n">ni</span><span class="p">])</span>
        <span class="n">data2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">lambdas</span><span class="p">[</span><span class="n">li</span><span class="p">],</span><span class="n">Ns</span><span class="p">[</span><span class="n">ni</span><span class="p">])</span>
        
        <span class="c1"># compute the statistic</span>
        <span class="n">t</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">wilcoxon</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="n">data2</span><span class="p">)</span>
        
        <span class="c1"># store the results</span>
        <span class="n">pvals</span><span class="p">[</span><span class="n">ni</span><span class="p">,</span><span class="n">li</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        

<span class="c1"># optional p-value thresholding</span>
<span class="n">pvalthresh</span> <span class="o">=</span> <span class="mf">.01</span>
<span class="n">pvals</span><span class="p">[</span> <span class="n">pvals</span><span class="o">&lt;-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pvalthresh</span><span class="p">)</span> <span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>


<span class="c1"># now show in a heatmap!</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">lambdas</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">lambdas</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">Ns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Ns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;lambda difference&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sample size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Signed-rank test results: -log(p)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/m0/mambaforge/lib/python3.10/site-packages/scipy/stats/_morestats.py:3351: UserWarning: Sample size too small for normal approximation.
  warnings.warn(&quot;Sample size too small for normal approximation.&quot;)
</pre></div>
</div>
<img alt="../../_images/99d4886728e7a4badf7f55c1db0cad333d4a1e70aa041c17e95b2a4d49c16380.png" src="../../_images/99d4886728e7a4badf7f55c1db0cad333d4a1e70aa041c17e95b2a4d49c16380.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## simulate two distributions</span>

<span class="c1"># number of trials</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># dataset &quot;A&quot;</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">r</span><span class="p">[</span><span class="n">r</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">[</span><span class="n">r</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">])</span>
<span class="n">dataA</span> <span class="o">=</span> <span class="mi">26</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="mi">10</span>

<span class="c1"># get histogram values for later comparison</span>
<span class="n">yA</span><span class="p">,</span><span class="n">xA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">dataA</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">xA</span> <span class="o">=</span> <span class="p">(</span><span class="n">xA</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">xA</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mi">2</span>

<span class="c1"># dataset &quot;B&quot;</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">r</span><span class="p">[</span><span class="n">r</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">[</span><span class="n">r</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">])</span>
<span class="n">dataB</span> <span class="o">=</span> <span class="mi">30</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="mi">10</span>

<span class="c1">#get histogram values for later comparison</span>
<span class="n">yB</span><span class="p">,</span><span class="n">xB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">dataB</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">xB</span> <span class="o">=</span> <span class="p">(</span><span class="n">xB</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">xB</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mi">2</span>


<span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">xA</span><span class="p">,</span><span class="n">yA</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span><span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&quot;A&quot;&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">xB</span><span class="p">,</span><span class="n">yB</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span><span class="n">basefmt</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&quot;B&quot;&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2c74c2a1faea4e5ce12143682db11e85be7088880b5901cadd228927ddc8bbb1.png" src="../../_images/2c74c2a1faea4e5ce12143682db11e85be7088880b5901cadd228927ddc8bbb1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## mix trials together</span>

<span class="c1"># concatenate trials</span>
<span class="n">alldata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dataA</span><span class="p">,</span><span class="n">dataB</span><span class="p">))</span>

<span class="c1"># condition labels</span>
<span class="n">conds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## generate one null hypothesis scenario</span>

<span class="c1"># random permutation</span>
<span class="n">fakeconds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># shuffled condition labels</span>
<span class="n">fakeconds</span><span class="p">[</span><span class="n">fakeconds</span><span class="o">&lt;</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">fakeconds</span><span class="p">[</span><span class="n">fakeconds</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>


<span class="c1"># these two means should be different.</span>
<span class="nb">print</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">alldata</span><span class="p">[</span><span class="n">conds</span><span class="o">==</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">alldata</span><span class="p">[</span><span class="n">conds</span><span class="o">==</span><span class="mi">2</span><span class="p">])])</span>

<span class="c1"># should these two be different?</span>
<span class="nb">print</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">alldata</span><span class="p">[</span><span class="n">fakeconds</span><span class="o">==</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">alldata</span><span class="p">[</span><span class="n">fakeconds</span><span class="o">==</span><span class="mi">2</span><span class="p">])])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[26.99172496859479, 30.414276307303535]
[27.776803088383332, 29.62919818751498]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## and now a distribution of null hypothesis values</span>

<span class="n">nPerms</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">permdiffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nPerms</span><span class="p">)</span>

<span class="k">for</span> <span class="n">permi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nPerms</span><span class="p">):</span>
    <span class="n">fconds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fconds</span><span class="p">[</span><span class="n">fconds</span><span class="o">&lt;</span><span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">fconds</span><span class="p">[</span><span class="n">fconds</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">permdiffs</span><span class="p">[</span><span class="n">permi</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">alldata</span><span class="p">[</span><span class="n">fconds</span><span class="o">==</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">alldata</span><span class="p">[</span><span class="n">fconds</span><span class="o">==</span><span class="mi">1</span><span class="p">])</span>


<span class="c1"># plot the distribution of H0 values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">permdiffs</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># and plot the observed value on top</span>
<span class="n">obsval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">alldata</span><span class="p">[</span><span class="n">conds</span><span class="o">==</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">alldata</span><span class="p">[</span><span class="n">conds</span><span class="o">==</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">obsval</span><span class="p">,</span> <span class="n">obsval</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b2de8f1862971e6c83b0f6cb115f3d3be156920dc7375de8e10db95c807bcc63.png" src="../../_images/b2de8f1862971e6c83b0f6cb115f3d3be156920dc7375de8e10db95c807bcc63.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## two methods of evaluating statistical significance</span>

<span class="c1"># Z-value</span>
<span class="n">zVal</span> <span class="o">=</span> <span class="p">(</span> <span class="n">obsval</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">permdiffs</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">permdiffs</span><span class="p">,</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">zVal</span><span class="p">))</span>

<span class="c1"># p-value count</span>
<span class="n">pCount</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">permdiffs</span><span class="o">&gt;</span><span class="n">obsval</span><span class="p">)</span><span class="o">/</span><span class="n">nPerms</span>

<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">pCount</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.001881380778979147 0.002
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## generate the data</span>

<span class="c1"># parameters</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># sample size</span>
<span class="n">popMu</span> <span class="o">=</span> <span class="mf">.5</span> <span class="c1"># true population mean</span>
<span class="n">data</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="n">popMu</span>

<span class="c1"># let&#39;s see what the data look(s) like</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;ko-&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Data index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Data value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">### question: Should there be lines in this plot?</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2d243f1fbe39b777d07cfcbc45dc89cef81ca9325521a47555e57c5fdf5625b6.png" src="../../_images/2d243f1fbe39b777d07cfcbc45dc89cef81ca9325521a47555e57c5fdf5625b6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## &quot;manual&quot; t-test</span>

<span class="c1"># the null-hypothesis value</span>
<span class="n">H0val</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># compute the t-value</span>
<span class="n">t_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">H0val</span>
<span class="n">t_den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">tval</span> <span class="o">=</span> <span class="n">t_num</span> <span class="o">/</span> <span class="n">t_den</span>

<span class="c1"># degrees of freedom</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span>

<span class="c1"># p-value</span>
<span class="n">pval</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">tval</span><span class="p">),</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># show the H0 parameter distribution and observed t-value</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1001</span><span class="p">)</span>
<span class="n">tdist</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">df</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">tdist</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">tval</span><span class="p">,</span><span class="n">tval</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">tdist</span><span class="p">)],</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;H_0 distribution&#39;</span><span class="p">,</span><span class="s1">&#39;Observed t-value&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t-value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;pdf(t)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;t(</span><span class="si">%g</span><span class="s1">) = </span><span class="si">%g</span><span class="s1">, p=</span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">tval</span><span class="p">,</span><span class="n">pval</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ad11b7bc4dce63d711ba6b481b0d022e62b68b8328bbc147de9cea4618d0c884.png" src="../../_images/ad11b7bc4dce63d711ba6b481b0d022e62b68b8328bbc147de9cea4618d0c884.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now using the Python function</span>

<span class="n">t</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">H0val</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<span class="c1"># do these values match our manually computed values?</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.1751124591053705 0.04245445617211263
</pre></div>
</div>
</div>
</div>
</section>
<section id="mann-whitney-u-test">
<h2>Mann-Whitney U test<a class="headerlink" href="#mann-whitney-u-test" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="generate-the-data">
<h2>generate the data<a class="headerlink" href="#generate-the-data" title="Permalink to this headline"></a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="the-data-note-the-different-sample-sizes">
<h1>the data (note the different sample sizes)<a class="headerlink" href="#the-data-note-the-different-sample-sizes" title="Permalink to this headline"></a></h1>
<p>N1 = 30
N2 = 35</p>
<p>data1 = np.random.poisson(2,N1)
data2 = np.random.poisson(1,N2)</p>
<p>plt.plot(1+np.random.randn(N1)/10,data1,‘ks’,markerfacecolor=‘w’)
plt.plot(2+np.random.randn(N2)/10,data2,‘ro’,markerfacecolor=‘w’)</p>
<p>plt.xlim([0,3])
plt.xticks([1,2],labels=(‘data1’,‘data2’))
plt.xlabel(‘Data group’)
plt.ylabel(‘Data value’)
plt.show()</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now for the test</span>

<span class="n">U</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span><span class="n">data2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>716.0 0.00917104372948411
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="confidence-intervals">
<h1>Confidence intervals<a class="headerlink" href="#confidence-intervals" title="Permalink to this headline"></a></h1>
<section id="bootstrapping-confidence-intervals">
<h2>Bootstrapping confidence intervals<a class="headerlink" href="#bootstrapping-confidence-intervals" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Polygon</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## simulate data</span>

<span class="n">popN</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e7</span><span class="p">)</span>  <span class="c1"># lots and LOTS of data!!</span>

<span class="c1"># the data (note: non-normal!)</span>
<span class="n">population</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">popN</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>

<span class="c1"># we can calculate the exact population mean</span>
<span class="n">popMean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">population</span><span class="p">)</span>

<span class="c1"># let&#39;s see it</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="c1"># only plot every 1000th sample</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">population</span><span class="p">[::</span><span class="mi">1000</span><span class="p">],</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Data index&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Data value&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">population</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="s1">&#39;fd&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Data value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/4e23f7361b457cbb570d551b415906e7fbd2a128eb13e4ea81633e324ed8605b.png" src="../../_images/4e23f7361b457cbb570d551b415906e7fbd2a128eb13e4ea81633e324ed8605b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## draw a random sample</span>

<span class="c1"># parameters</span>
<span class="n">samplesize</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">confidence</span> <span class="o">=</span> <span class="mi">95</span> <span class="c1"># in percent</span>

<span class="c1"># compute sample mean</span>
<span class="n">randSamples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">popN</span><span class="p">,</span><span class="n">samplesize</span><span class="p">)</span>
<span class="n">sampledata</span>  <span class="o">=</span> <span class="n">population</span><span class="p">[</span><span class="n">randSamples</span><span class="p">]</span>
<span class="n">samplemean</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">population</span><span class="p">[</span><span class="n">randSamples</span><span class="p">])</span>
<span class="n">samplestd</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">population</span><span class="p">[</span><span class="n">randSamples</span><span class="p">])</span> <span class="c1"># used later for analytic solution</span>



<span class="c1">### now for bootstrapping</span>
<span class="n">numBoots</span>  <span class="o">=</span> <span class="mi">1000</span>
<span class="n">bootmeans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numBoots</span><span class="p">)</span>

<span class="c1"># resample with replacement</span>
<span class="k">for</span> <span class="n">booti</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numBoots</span><span class="p">):</span>
    <span class="n">bootmeans</span><span class="p">[</span><span class="n">booti</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">sampledata</span><span class="p">,</span><span class="n">samplesize</span><span class="p">)</span> <span class="p">)</span>
    

<span class="c1"># find confidence intervals</span>
<span class="n">confint</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># initialize</span>
<span class="n">confint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">bootmeans</span><span class="p">,(</span><span class="mi">100</span><span class="o">-</span><span class="n">confidence</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">confint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">bootmeans</span><span class="p">,</span><span class="mi">100</span><span class="o">-</span><span class="p">(</span><span class="mi">100</span><span class="o">-</span><span class="n">confidence</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## graph everything</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># start with histogram of resampled means</span>
<span class="n">y</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">bootmeans</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mi">2</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="p">[</span><span class="n">confint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">],[</span><span class="n">confint</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">],[</span><span class="n">confint</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">],[</span><span class="n">confint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">]</span> <span class="p">])</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="c1"># now add the lines</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">popMean</span><span class="p">,</span><span class="n">popMean</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span><span class="s1">&#39;k:&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">samplemean</span><span class="p">,</span><span class="n">samplemean</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span><span class="s1">&#39;r--&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">popMean</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="n">popMean</span><span class="o">+</span><span class="mi">30</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Data values&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;True mean&#39;</span><span class="p">,</span><span class="s1">&#39;Sample mean&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%g%%</span><span class="s1"> CI region&#39;</span><span class="o">%</span><span class="k">confidence</span>,&#39;Empirical dist.&#39;))
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d37522b6d5cb12f2f9b0532d02cb4d41974e742f3feda92d4576d9b59f8ef711.png" src="../../_images/d37522b6d5cb12f2f9b0532d02cb4d41974e742f3feda92d4576d9b59f8ef711.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## compare against the analytic confidence interval</span>

<span class="c1"># compute confidence intervals</span>
<span class="n">citmp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">confidence</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="n">confint2</span> <span class="o">=</span> <span class="n">samplemean</span> <span class="o">+</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">([</span><span class="n">citmp</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">citmp</span><span class="p">],</span><span class="n">samplesize</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">samplestd</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">samplesize</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Empirical: </span><span class="si">%g</span><span class="s1"> - </span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">confint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">confint</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Analytic:  </span><span class="si">%g</span><span class="s1"> - </span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">confint2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">confint2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Empirical: 10.17 - 23.5141
Analytic:  9.68393 - 23.2634
</pre></div>
</div>
</div>
</div>
</section>
<section id="compute-confidence-intervals-by-formula">
<h2>Compute confidence intervals by formula<a class="headerlink" href="#compute-confidence-intervals-by-formula" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Polygon</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## simulate data</span>

<span class="n">popN</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e7</span><span class="p">)</span>  <span class="c1"># lots and LOTS of data!!</span>

<span class="c1"># the data (note: non-normal!)</span>
<span class="n">population</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">popN</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>

<span class="c1"># we can calculate the exact population mean</span>
<span class="n">popMean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">population</span><span class="p">)</span>

<span class="c1"># let&#39;s see it</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="c1"># only plot every 1000th sample</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">population</span><span class="p">[::</span><span class="mi">1000</span><span class="p">],</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Data index&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Data value&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">population</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="s1">&#39;fd&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Data value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/49f4290932459ef361f0863a3fdfe42d17f580ed302593528d3cad8056ef595c.png" src="../../_images/49f4290932459ef361f0863a3fdfe42d17f580ed302593528d3cad8056ef595c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## draw a random sample</span>

<span class="c1"># parameters</span>
<span class="n">samplesize</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">confidence</span> <span class="o">=</span> <span class="mi">95</span> <span class="c1"># in percent</span>

<span class="c1"># compute sample mean</span>
<span class="n">randSamples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">popN</span><span class="p">,</span><span class="n">samplesize</span><span class="p">)</span>
<span class="n">samplemean</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">population</span><span class="p">[</span><span class="n">randSamples</span><span class="p">])</span>
<span class="n">samplestd</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">population</span><span class="p">[</span><span class="n">randSamples</span><span class="p">],</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># compute confidence intervals</span>
<span class="n">citmp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">confidence</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="n">confint</span> <span class="o">=</span> <span class="n">samplemean</span> <span class="o">+</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">([</span><span class="n">citmp</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">citmp</span><span class="p">],</span><span class="n">samplesize</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">samplestd</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">samplesize</span><span class="p">)</span>

<span class="c1"># graph everything</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="p">[</span><span class="n">confint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">],[</span><span class="n">confint</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">],[</span><span class="n">confint</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">],[</span><span class="n">confint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">]</span> <span class="p">])</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="c1"># now add the lines</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">popMean</span><span class="p">,</span><span class="n">popMean</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span><span class="s1">&#39;k:&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">samplemean</span><span class="p">,</span><span class="n">samplemean</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span><span class="s1">&#39;r--&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">popMean</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="n">popMean</span><span class="o">+</span><span class="mi">30</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Data values&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;True mean&#39;</span><span class="p">,</span><span class="s1">&#39;Sample mean&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%g%%</span><span class="s1"> CI region&#39;</span><span class="o">%</span><span class="k">confidence</span>))
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e12a2b190fd0fdaa111e0b89516dd0a8aa680b1d4aeb38133fa1c6df19e0882c.png" src="../../_images/e12a2b190fd0fdaa111e0b89516dd0a8aa680b1d4aeb38133fa1c6df19e0882c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## repeat for large number of samples</span>

<span class="c1"># parameters</span>
<span class="n">samplesize</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">confidence</span> <span class="o">=</span> <span class="mi">95</span>  <span class="c1"># in percent</span>
<span class="n">numExperiments</span> <span class="o">=</span> <span class="mi">5000</span>

<span class="n">withinCI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">numExperiments</span><span class="p">)</span>


<span class="c1"># part of the CI computation can be done outside the loop</span>
<span class="n">citmp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">confidence</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="n">CI_T</span>  <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">([</span><span class="n">citmp</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">citmp</span><span class="p">],</span><span class="n">samplesize</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sqrtN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">samplesize</span><span class="p">)</span>

<span class="k">for</span> <span class="n">expi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numExperiments</span><span class="p">):</span>
    
    <span class="c1"># compute sample mean and CI as above</span>
    <span class="n">randSamples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">popN</span><span class="p">,</span><span class="n">samplesize</span><span class="p">)</span>
    <span class="n">samplemean</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">population</span><span class="p">[</span><span class="n">randSamples</span><span class="p">])</span>
    <span class="n">samplestd</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">population</span><span class="p">[</span><span class="n">randSamples</span><span class="p">],</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">confint</span>     <span class="o">=</span> <span class="n">samplemean</span> <span class="o">+</span> <span class="n">CI_T</span> <span class="o">*</span> <span class="n">samplestd</span><span class="o">/</span><span class="n">sqrtN</span>
    
    <span class="c1"># determine whether the True mean is inside this CI</span>
    <span class="k">if</span> <span class="n">popMean</span><span class="o">&gt;</span><span class="n">confint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">popMean</span><span class="o">&lt;</span><span class="n">confint</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">withinCI</span><span class="p">[</span><span class="n">expi</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g%%</span><span class="s1"> of sample C.I.&#39;&#39;s contained the true population mean.&#39;</span><span class="o">%</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">withinCI</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>92.54% of sample C.I.s contained the true population mean.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="anova">
<h1>ANOVA<a class="headerlink" href="#anova" title="Permalink to this headline"></a></h1>
<section id="two-way-mixed-effects-anova">
<h2>Two-way mixed-effects ANOVA<a class="headerlink" href="#two-way-mixed-effects-anova" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pingouin</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## the data and group labels</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;TwoWayMixedANOVA_data.csv&quot;</span><span class="p">),</span><span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

<span class="n">timepoint</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">45</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">45</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">45</span>
<span class="n">groups</span>    <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">15</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">15</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">15</span>
<span class="n">s</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">45</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>

<span class="c1"># # convert to pandas</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">),</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;TheData&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;TimePoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timepoint</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_rows&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;display.max_columns&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TheData</th>
      <th>Group</th>
      <th>TimePoint</th>
      <th>Subject</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>13.0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>15.0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>13.0</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>16.0</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>17.0</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>18.0</td>
      <td>1</td>
      <td>1</td>
      <td>5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>16.0</td>
      <td>1</td>
      <td>1</td>
      <td>6</td>
    </tr>
    <tr>
      <th>7</th>
      <td>16.0</td>
      <td>1</td>
      <td>1</td>
      <td>7</td>
    </tr>
    <tr>
      <th>8</th>
      <td>18.0</td>
      <td>1</td>
      <td>1</td>
      <td>8</td>
    </tr>
    <tr>
      <th>9</th>
      <td>17.0</td>
      <td>1</td>
      <td>1</td>
      <td>9</td>
    </tr>
    <tr>
      <th>10</th>
      <td>17.0</td>
      <td>1</td>
      <td>1</td>
      <td>10</td>
    </tr>
    <tr>
      <th>11</th>
      <td>19.0</td>
      <td>1</td>
      <td>1</td>
      <td>11</td>
    </tr>
    <tr>
      <th>12</th>
      <td>18.0</td>
      <td>1</td>
      <td>1</td>
      <td>12</td>
    </tr>
    <tr>
      <th>13</th>
      <td>19.0</td>
      <td>1</td>
      <td>1</td>
      <td>13</td>
    </tr>
    <tr>
      <th>14</th>
      <td>22.0</td>
      <td>1</td>
      <td>1</td>
      <td>14</td>
    </tr>
    <tr>
      <th>15</th>
      <td>14.0</td>
      <td>2</td>
      <td>1</td>
      <td>15</td>
    </tr>
    <tr>
      <th>16</th>
      <td>16.0</td>
      <td>2</td>
      <td>1</td>
      <td>16</td>
    </tr>
    <tr>
      <th>17</th>
      <td>15.0</td>
      <td>2</td>
      <td>1</td>
      <td>17</td>
    </tr>
    <tr>
      <th>18</th>
      <td>16.0</td>
      <td>2</td>
      <td>1</td>
      <td>18</td>
    </tr>
    <tr>
      <th>19</th>
      <td>16.0</td>
      <td>2</td>
      <td>1</td>
      <td>19</td>
    </tr>
    <tr>
      <th>20</th>
      <td>16.0</td>
      <td>2</td>
      <td>1</td>
      <td>20</td>
    </tr>
    <tr>
      <th>21</th>
      <td>16.0</td>
      <td>2</td>
      <td>1</td>
      <td>21</td>
    </tr>
    <tr>
      <th>22</th>
      <td>17.0</td>
      <td>2</td>
      <td>1</td>
      <td>22</td>
    </tr>
    <tr>
      <th>23</th>
      <td>17.0</td>
      <td>2</td>
      <td>1</td>
      <td>23</td>
    </tr>
    <tr>
      <th>24</th>
      <td>16.0</td>
      <td>2</td>
      <td>1</td>
      <td>24</td>
    </tr>
    <tr>
      <th>25</th>
      <td>18.0</td>
      <td>2</td>
      <td>1</td>
      <td>25</td>
    </tr>
    <tr>
      <th>26</th>
      <td>18.0</td>
      <td>2</td>
      <td>1</td>
      <td>26</td>
    </tr>
    <tr>
      <th>27</th>
      <td>18.0</td>
      <td>2</td>
      <td>1</td>
      <td>27</td>
    </tr>
    <tr>
      <th>28</th>
      <td>18.0</td>
      <td>2</td>
      <td>1</td>
      <td>28</td>
    </tr>
    <tr>
      <th>29</th>
      <td>19.0</td>
      <td>2</td>
      <td>1</td>
      <td>29</td>
    </tr>
    <tr>
      <th>30</th>
      <td>16.0</td>
      <td>3</td>
      <td>1</td>
      <td>30</td>
    </tr>
    <tr>
      <th>31</th>
      <td>15.0</td>
      <td>3</td>
      <td>1</td>
      <td>31</td>
    </tr>
    <tr>
      <th>32</th>
      <td>16.0</td>
      <td>3</td>
      <td>1</td>
      <td>32</td>
    </tr>
    <tr>
      <th>33</th>
      <td>16.0</td>
      <td>3</td>
      <td>1</td>
      <td>33</td>
    </tr>
    <tr>
      <th>34</th>
      <td>17.0</td>
      <td>3</td>
      <td>1</td>
      <td>34</td>
    </tr>
    <tr>
      <th>35</th>
      <td>16.0</td>
      <td>3</td>
      <td>1</td>
      <td>35</td>
    </tr>
    <tr>
      <th>36</th>
      <td>18.0</td>
      <td>3</td>
      <td>1</td>
      <td>36</td>
    </tr>
    <tr>
      <th>37</th>
      <td>18.0</td>
      <td>3</td>
      <td>1</td>
      <td>37</td>
    </tr>
    <tr>
      <th>38</th>
      <td>19.0</td>
      <td>3</td>
      <td>1</td>
      <td>38</td>
    </tr>
    <tr>
      <th>39</th>
      <td>18.0</td>
      <td>3</td>
      <td>1</td>
      <td>39</td>
    </tr>
    <tr>
      <th>40</th>
      <td>18.0</td>
      <td>3</td>
      <td>1</td>
      <td>40</td>
    </tr>
    <tr>
      <th>41</th>
      <td>18.0</td>
      <td>3</td>
      <td>1</td>
      <td>41</td>
    </tr>
    <tr>
      <th>42</th>
      <td>18.0</td>
      <td>3</td>
      <td>1</td>
      <td>42</td>
    </tr>
    <tr>
      <th>43</th>
      <td>19.0</td>
      <td>3</td>
      <td>1</td>
      <td>43</td>
    </tr>
    <tr>
      <th>44</th>
      <td>18.0</td>
      <td>3</td>
      <td>1</td>
      <td>44</td>
    </tr>
    <tr>
      <th>45</th>
      <td>14.0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>46</th>
      <td>13.0</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>47</th>
      <td>14.0</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>48</th>
      <td>15.0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>49</th>
      <td>16.0</td>
      <td>1</td>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <th>50</th>
      <td>18.0</td>
      <td>1</td>
      <td>2</td>
      <td>5</td>
    </tr>
    <tr>
      <th>51</th>
      <td>15.0</td>
      <td>1</td>
      <td>2</td>
      <td>6</td>
    </tr>
    <tr>
      <th>52</th>
      <td>16.0</td>
      <td>1</td>
      <td>2</td>
      <td>7</td>
    </tr>
    <tr>
      <th>53</th>
      <td>18.0</td>
      <td>1</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <th>54</th>
      <td>17.0</td>
      <td>1</td>
      <td>2</td>
      <td>9</td>
    </tr>
    <tr>
      <th>55</th>
      <td>18.0</td>
      <td>1</td>
      <td>2</td>
      <td>10</td>
    </tr>
    <tr>
      <th>56</th>
      <td>16.0</td>
      <td>1</td>
      <td>2</td>
      <td>11</td>
    </tr>
    <tr>
      <th>57</th>
      <td>18.0</td>
      <td>1</td>
      <td>2</td>
      <td>12</td>
    </tr>
    <tr>
      <th>58</th>
      <td>19.0</td>
      <td>1</td>
      <td>2</td>
      <td>13</td>
    </tr>
    <tr>
      <th>59</th>
      <td>20.0</td>
      <td>1</td>
      <td>2</td>
      <td>14</td>
    </tr>
    <tr>
      <th>60</th>
      <td>14.0</td>
      <td>2</td>
      <td>2</td>
      <td>15</td>
    </tr>
    <tr>
      <th>61</th>
      <td>18.0</td>
      <td>2</td>
      <td>2</td>
      <td>16</td>
    </tr>
    <tr>
      <th>62</th>
      <td>14.0</td>
      <td>2</td>
      <td>2</td>
      <td>17</td>
    </tr>
    <tr>
      <th>63</th>
      <td>15.0</td>
      <td>2</td>
      <td>2</td>
      <td>18</td>
    </tr>
    <tr>
      <th>64</th>
      <td>15.0</td>
      <td>2</td>
      <td>2</td>
      <td>19</td>
    </tr>
    <tr>
      <th>65</th>
      <td>16.0</td>
      <td>2</td>
      <td>2</td>
      <td>20</td>
    </tr>
    <tr>
      <th>66</th>
      <td>17.0</td>
      <td>2</td>
      <td>2</td>
      <td>21</td>
    </tr>
    <tr>
      <th>67</th>
      <td>18.0</td>
      <td>2</td>
      <td>2</td>
      <td>22</td>
    </tr>
    <tr>
      <th>68</th>
      <td>18.0</td>
      <td>2</td>
      <td>2</td>
      <td>23</td>
    </tr>
    <tr>
      <th>69</th>
      <td>16.0</td>
      <td>2</td>
      <td>2</td>
      <td>24</td>
    </tr>
    <tr>
      <th>70</th>
      <td>18.0</td>
      <td>2</td>
      <td>2</td>
      <td>25</td>
    </tr>
    <tr>
      <th>71</th>
      <td>20.0</td>
      <td>2</td>
      <td>2</td>
      <td>26</td>
    </tr>
    <tr>
      <th>72</th>
      <td>19.0</td>
      <td>2</td>
      <td>2</td>
      <td>27</td>
    </tr>
    <tr>
      <th>73</th>
      <td>19.0</td>
      <td>2</td>
      <td>2</td>
      <td>28</td>
    </tr>
    <tr>
      <th>74</th>
      <td>17.0</td>
      <td>2</td>
      <td>2</td>
      <td>29</td>
    </tr>
    <tr>
      <th>75</th>
      <td>14.0</td>
      <td>3</td>
      <td>2</td>
      <td>30</td>
    </tr>
    <tr>
      <th>76</th>
      <td>15.0</td>
      <td>3</td>
      <td>2</td>
      <td>31</td>
    </tr>
    <tr>
      <th>77</th>
      <td>14.0</td>
      <td>3</td>
      <td>2</td>
      <td>32</td>
    </tr>
    <tr>
      <th>78</th>
      <td>14.0</td>
      <td>3</td>
      <td>2</td>
      <td>33</td>
    </tr>
    <tr>
      <th>79</th>
      <td>14.0</td>
      <td>3</td>
      <td>2</td>
      <td>34</td>
    </tr>
    <tr>
      <th>80</th>
      <td>16.0</td>
      <td>3</td>
      <td>2</td>
      <td>35</td>
    </tr>
    <tr>
      <th>81</th>
      <td>15.0</td>
      <td>3</td>
      <td>2</td>
      <td>36</td>
    </tr>
    <tr>
      <th>82</th>
      <td>16.0</td>
      <td>3</td>
      <td>2</td>
      <td>37</td>
    </tr>
    <tr>
      <th>83</th>
      <td>16.0</td>
      <td>3</td>
      <td>2</td>
      <td>38</td>
    </tr>
    <tr>
      <th>84</th>
      <td>13.0</td>
      <td>3</td>
      <td>2</td>
      <td>39</td>
    </tr>
    <tr>
      <th>85</th>
      <td>17.0</td>
      <td>3</td>
      <td>2</td>
      <td>40</td>
    </tr>
    <tr>
      <th>86</th>
      <td>16.0</td>
      <td>3</td>
      <td>2</td>
      <td>41</td>
    </tr>
    <tr>
      <th>87</th>
      <td>16.0</td>
      <td>3</td>
      <td>2</td>
      <td>42</td>
    </tr>
    <tr>
      <th>88</th>
      <td>15.0</td>
      <td>3</td>
      <td>2</td>
      <td>43</td>
    </tr>
    <tr>
      <th>89</th>
      <td>17.0</td>
      <td>3</td>
      <td>2</td>
      <td>44</td>
    </tr>
    <tr>
      <th>90</th>
      <td>12.0</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>91</th>
      <td>15.0</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
    </tr>
    <tr>
      <th>92</th>
      <td>15.0</td>
      <td>1</td>
      <td>3</td>
      <td>2</td>
    </tr>
    <tr>
      <th>93</th>
      <td>13.0</td>
      <td>1</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>94</th>
      <td>16.0</td>
      <td>1</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>95</th>
      <td>18.0</td>
      <td>1</td>
      <td>3</td>
      <td>5</td>
    </tr>
    <tr>
      <th>96</th>
      <td>17.0</td>
      <td>1</td>
      <td>3</td>
      <td>6</td>
    </tr>
    <tr>
      <th>97</th>
      <td>18.0</td>
      <td>1</td>
      <td>3</td>
      <td>7</td>
    </tr>
    <tr>
      <th>98</th>
      <td>17.0</td>
      <td>1</td>
      <td>3</td>
      <td>8</td>
    </tr>
    <tr>
      <th>99</th>
      <td>18.0</td>
      <td>1</td>
      <td>3</td>
      <td>9</td>
    </tr>
    <tr>
      <th>100</th>
      <td>16.0</td>
      <td>1</td>
      <td>3</td>
      <td>10</td>
    </tr>
    <tr>
      <th>101</th>
      <td>19.0</td>
      <td>1</td>
      <td>3</td>
      <td>11</td>
    </tr>
    <tr>
      <th>102</th>
      <td>21.0</td>
      <td>1</td>
      <td>3</td>
      <td>12</td>
    </tr>
    <tr>
      <th>103</th>
      <td>17.0</td>
      <td>1</td>
      <td>3</td>
      <td>13</td>
    </tr>
    <tr>
      <th>104</th>
      <td>19.0</td>
      <td>1</td>
      <td>3</td>
      <td>14</td>
    </tr>
    <tr>
      <th>105</th>
      <td>12.0</td>
      <td>2</td>
      <td>3</td>
      <td>15</td>
    </tr>
    <tr>
      <th>106</th>
      <td>13.0</td>
      <td>2</td>
      <td>3</td>
      <td>16</td>
    </tr>
    <tr>
      <th>107</th>
      <td>13.0</td>
      <td>2</td>
      <td>3</td>
      <td>17</td>
    </tr>
    <tr>
      <th>108</th>
      <td>14.0</td>
      <td>2</td>
      <td>3</td>
      <td>18</td>
    </tr>
    <tr>
      <th>109</th>
      <td>13.0</td>
      <td>2</td>
      <td>3</td>
      <td>19</td>
    </tr>
    <tr>
      <th>110</th>
      <td>14.0</td>
      <td>2</td>
      <td>3</td>
      <td>20</td>
    </tr>
    <tr>
      <th>111</th>
      <td>16.0</td>
      <td>2</td>
      <td>3</td>
      <td>21</td>
    </tr>
    <tr>
      <th>112</th>
      <td>17.0</td>
      <td>2</td>
      <td>3</td>
      <td>22</td>
    </tr>
    <tr>
      <th>113</th>
      <td>15.0</td>
      <td>2</td>
      <td>3</td>
      <td>23</td>
    </tr>
    <tr>
      <th>114</th>
      <td>15.0</td>
      <td>2</td>
      <td>3</td>
      <td>24</td>
    </tr>
    <tr>
      <th>115</th>
      <td>16.0</td>
      <td>2</td>
      <td>3</td>
      <td>25</td>
    </tr>
    <tr>
      <th>116</th>
      <td>16.0</td>
      <td>2</td>
      <td>3</td>
      <td>26</td>
    </tr>
    <tr>
      <th>117</th>
      <td>17.0</td>
      <td>2</td>
      <td>3</td>
      <td>27</td>
    </tr>
    <tr>
      <th>118</th>
      <td>19.0</td>
      <td>2</td>
      <td>3</td>
      <td>28</td>
    </tr>
    <tr>
      <th>119</th>
      <td>19.0</td>
      <td>2</td>
      <td>3</td>
      <td>29</td>
    </tr>
    <tr>
      <th>120</th>
      <td>12.0</td>
      <td>3</td>
      <td>3</td>
      <td>30</td>
    </tr>
    <tr>
      <th>121</th>
      <td>12.0</td>
      <td>3</td>
      <td>3</td>
      <td>31</td>
    </tr>
    <tr>
      <th>122</th>
      <td>12.0</td>
      <td>3</td>
      <td>3</td>
      <td>32</td>
    </tr>
    <tr>
      <th>123</th>
      <td>12.0</td>
      <td>3</td>
      <td>3</td>
      <td>33</td>
    </tr>
    <tr>
      <th>124</th>
      <td>12.0</td>
      <td>3</td>
      <td>3</td>
      <td>34</td>
    </tr>
    <tr>
      <th>125</th>
      <td>14.0</td>
      <td>3</td>
      <td>3</td>
      <td>35</td>
    </tr>
    <tr>
      <th>126</th>
      <td>12.0</td>
      <td>3</td>
      <td>3</td>
      <td>36</td>
    </tr>
    <tr>
      <th>127</th>
      <td>15.0</td>
      <td>3</td>
      <td>3</td>
      <td>37</td>
    </tr>
    <tr>
      <th>128</th>
      <td>12.0</td>
      <td>3</td>
      <td>3</td>
      <td>38</td>
    </tr>
    <tr>
      <th>129</th>
      <td>14.0</td>
      <td>3</td>
      <td>3</td>
      <td>39</td>
    </tr>
    <tr>
      <th>130</th>
      <td>16.0</td>
      <td>3</td>
      <td>3</td>
      <td>40</td>
    </tr>
    <tr>
      <th>131</th>
      <td>14.0</td>
      <td>3</td>
      <td>3</td>
      <td>41</td>
    </tr>
    <tr>
      <th>132</th>
      <td>15.0</td>
      <td>3</td>
      <td>3</td>
      <td>42</td>
    </tr>
    <tr>
      <th>133</th>
      <td>15.0</td>
      <td>3</td>
      <td>3</td>
      <td>43</td>
    </tr>
    <tr>
      <th>134</th>
      <td>18.0</td>
      <td>3</td>
      <td>3</td>
      <td>44</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pg</span><span class="o">.</span><span class="n">mixed_anova</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">dv</span><span class="o">=</span><span class="s1">&#39;TheData&#39;</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="s1">&#39;Group&#39;</span><span class="p">,</span><span class="n">within</span><span class="o">=</span><span class="s1">&#39;TimePoint&#39;</span><span class="p">,</span><span class="n">subject</span><span class="o">=</span><span class="s1">&#39;Subject&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/m0/mambaforge/lib/python3.10/site-packages/pingouin/parametric.py:551: FutureWarning: Not prepending group keys to the result index of transform-like apply. In the future, the group keys will be included in the index, regardless of whether the applied function returns a like-indexed object.
To preserve the previous behavior, use

	&gt;&gt;&gt; .groupby(..., group_keys=False)

To adopt the future behavior and silence this warning, use 

	&gt;&gt;&gt; .groupby(..., group_keys=True)
  ss_resall = grp_with.apply(lambda x: (x - x.mean()) ** 2).sum()
/Users/m0/mambaforge/lib/python3.10/site-packages/pingouin/parametric.py:992: FutureWarning: Not prepending group keys to the result index of transform-like apply. In the future, the group keys will be included in the index, regardless of whether the applied function returns a like-indexed object.
To preserve the previous behavior, use

	&gt;&gt;&gt; .groupby(..., group_keys=False)

To adopt the future behavior and silence this warning, use 

	&gt;&gt;&gt; .groupby(..., group_keys=True)
  sserror = grp.apply(lambda x: (x - x.mean()) ** 2).sum()
/Users/m0/mambaforge/lib/python3.10/site-packages/pingouin/parametric.py:1512: FutureWarning: Not prepending group keys to the result index of transform-like apply. In the future, the group keys will be included in the index, regardless of whether the applied function returns a like-indexed object.
To preserve the previous behavior, use

	&gt;&gt;&gt; .groupby(..., group_keys=False)

To adopt the future behavior and silence this warning, use 

	&gt;&gt;&gt; .groupby(..., group_keys=True)
  ss_resall = grp.apply(lambda x: (x - x.mean()) ** 2).sum()
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>SS</th>
      <th>DF1</th>
      <th>DF2</th>
      <th>MS</th>
      <th>F</th>
      <th>p-unc</th>
      <th>np2</th>
      <th>eps</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Group</td>
      <td>40.311111</td>
      <td>2</td>
      <td>42</td>
      <td>20.155556</td>
      <td>2.446942</td>
      <td>9.880857e-02</td>
      <td>0.104361</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>TimePoint</td>
      <td>69.644444</td>
      <td>2</td>
      <td>84</td>
      <td>34.822222</td>
      <td>31.147184</td>
      <td>7.588754e-11</td>
      <td>0.425815</td>
      <td>0.901879</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Interaction</td>
      <td>57.777778</td>
      <td>4</td>
      <td>84</td>
      <td>14.444444</td>
      <td>12.920019</td>
      <td>3.051011e-08</td>
      <td>0.380897</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Group&quot;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s2">&quot;TheData&quot;</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;TimePoint&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;TimePoint&#39;, ylabel=&#39;TheData&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/1529f41766b3da7e8dac5009adb3ed517596157ffad406d4051d66f6cb258018.png" src="../../_images/1529f41766b3da7e8dac5009adb3ed517596157ffad406d4051d66f6cb258018.png" />
</div>
</div>
</section>
<section id="one-way-anova-independent-samples">
<h2>One-way ANOVA (independent samples)<a class="headerlink" href="#one-way-anova-independent-samples" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pingouin</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## data parameters</span>

<span class="c1"># group means</span>
<span class="n">mean1</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">mean2</span> <span class="o">=</span> <span class="mf">3.8</span>
<span class="n">mean3</span> <span class="o">=</span> <span class="mi">7</span>

<span class="c1"># samples per group</span>
<span class="n">N1</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">N2</span> <span class="o">=</span> <span class="mi">35</span>
<span class="n">N3</span> <span class="o">=</span> <span class="mi">29</span>

<span class="c1"># standard deviation (assume common across groups)</span>
<span class="n">stdev</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now to simulate the data</span>
<span class="n">data1</span> <span class="o">=</span> <span class="n">mean1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N1</span><span class="p">)</span><span class="o">*</span><span class="n">stdev</span>
<span class="n">data2</span> <span class="o">=</span> <span class="n">mean2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N2</span><span class="p">)</span><span class="o">*</span><span class="n">stdev</span>
<span class="n">data3</span> <span class="o">=</span> <span class="n">mean3</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N3</span><span class="p">)</span><span class="o">*</span><span class="n">stdev</span>

<span class="n">datacolumn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data1</span><span class="p">,</span><span class="n">data2</span><span class="p">,</span><span class="n">data3</span><span class="p">))</span>

<span class="c1"># group labels</span>
<span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">N1</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">N2</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">N3</span>

<span class="c1"># convert to a pandas dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;TheData&#39;</span><span class="p">:</span><span class="n">datacolumn</span><span class="p">,</span><span class="s1">&#39;Group&#39;</span><span class="p">:</span><span class="n">groups</span><span class="p">})</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TheData</th>
      <th>Group</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.357440</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7.100397</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.425424</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.353867</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.604897</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.390415</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.975372</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>3.977573</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>6.244134</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>5.953420</td>
      <td>1</td>
    </tr>
    <tr>
      <th>10</th>
      <td>5.675084</td>
      <td>1</td>
    </tr>
    <tr>
      <th>11</th>
      <td>3.422265</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2.349251</td>
      <td>1</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2.628883</td>
      <td>1</td>
    </tr>
    <tr>
      <th>14</th>
      <td>4.185079</td>
      <td>1</td>
    </tr>
    <tr>
      <th>15</th>
      <td>6.098725</td>
      <td>1</td>
    </tr>
    <tr>
      <th>16</th>
      <td>4.675199</td>
      <td>1</td>
    </tr>
    <tr>
      <th>17</th>
      <td>1.846513</td>
      <td>1</td>
    </tr>
    <tr>
      <th>18</th>
      <td>4.348315</td>
      <td>1</td>
    </tr>
    <tr>
      <th>19</th>
      <td>5.213359</td>
      <td>1</td>
    </tr>
    <tr>
      <th>20</th>
      <td>-0.086907</td>
      <td>1</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2.040357</td>
      <td>1</td>
    </tr>
    <tr>
      <th>22</th>
      <td>4.283878</td>
      <td>1</td>
    </tr>
    <tr>
      <th>23</th>
      <td>6.889701</td>
      <td>1</td>
    </tr>
    <tr>
      <th>24</th>
      <td>6.373141</td>
      <td>1</td>
    </tr>
    <tr>
      <th>25</th>
      <td>5.735406</td>
      <td>1</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2.825358</td>
      <td>1</td>
    </tr>
    <tr>
      <th>27</th>
      <td>0.890215</td>
      <td>1</td>
    </tr>
    <tr>
      <th>28</th>
      <td>1.369725</td>
      <td>1</td>
    </tr>
    <tr>
      <th>29</th>
      <td>5.091216</td>
      <td>1</td>
    </tr>
    <tr>
      <th>30</th>
      <td>5.471313</td>
      <td>2</td>
    </tr>
    <tr>
      <th>31</th>
      <td>4.668969</td>
      <td>2</td>
    </tr>
    <tr>
      <th>32</th>
      <td>1.821582</td>
      <td>2</td>
    </tr>
    <tr>
      <th>33</th>
      <td>4.830874</td>
      <td>2</td>
    </tr>
    <tr>
      <th>34</th>
      <td>2.421718</td>
      <td>2</td>
    </tr>
    <tr>
      <th>35</th>
      <td>3.926700</td>
      <td>2</td>
    </tr>
    <tr>
      <th>36</th>
      <td>3.077205</td>
      <td>2</td>
    </tr>
    <tr>
      <th>37</th>
      <td>5.143946</td>
      <td>2</td>
    </tr>
    <tr>
      <th>38</th>
      <td>4.726154</td>
      <td>2</td>
    </tr>
    <tr>
      <th>39</th>
      <td>3.568684</td>
      <td>2</td>
    </tr>
    <tr>
      <th>40</th>
      <td>3.427870</td>
      <td>2</td>
    </tr>
    <tr>
      <th>41</th>
      <td>6.311202</td>
      <td>2</td>
    </tr>
    <tr>
      <th>42</th>
      <td>-0.406957</td>
      <td>2</td>
    </tr>
    <tr>
      <th>43</th>
      <td>5.846701</td>
      <td>2</td>
    </tr>
    <tr>
      <th>44</th>
      <td>3.183306</td>
      <td>2</td>
    </tr>
    <tr>
      <th>45</th>
      <td>6.064624</td>
      <td>2</td>
    </tr>
    <tr>
      <th>46</th>
      <td>5.881613</td>
      <td>2</td>
    </tr>
    <tr>
      <th>47</th>
      <td>4.871783</td>
      <td>2</td>
    </tr>
    <tr>
      <th>48</th>
      <td>1.568381</td>
      <td>2</td>
    </tr>
    <tr>
      <th>49</th>
      <td>5.125496</td>
      <td>2</td>
    </tr>
    <tr>
      <th>50</th>
      <td>4.174780</td>
      <td>2</td>
    </tr>
    <tr>
      <th>51</th>
      <td>3.801576</td>
      <td>2</td>
    </tr>
    <tr>
      <th>52</th>
      <td>5.896150</td>
      <td>2</td>
    </tr>
    <tr>
      <th>53</th>
      <td>1.926485</td>
      <td>2</td>
    </tr>
    <tr>
      <th>54</th>
      <td>0.884877</td>
      <td>2</td>
    </tr>
    <tr>
      <th>55</th>
      <td>2.464888</td>
      <td>2</td>
    </tr>
    <tr>
      <th>56</th>
      <td>4.420401</td>
      <td>2</td>
    </tr>
    <tr>
      <th>57</th>
      <td>3.946482</td>
      <td>2</td>
    </tr>
    <tr>
      <th>58</th>
      <td>7.275763</td>
      <td>2</td>
    </tr>
    <tr>
      <th>59</th>
      <td>3.959256</td>
      <td>2</td>
    </tr>
    <tr>
      <th>60</th>
      <td>4.523587</td>
      <td>2</td>
    </tr>
    <tr>
      <th>61</th>
      <td>3.803208</td>
      <td>2</td>
    </tr>
    <tr>
      <th>62</th>
      <td>3.060539</td>
      <td>2</td>
    </tr>
    <tr>
      <th>63</th>
      <td>0.999188</td>
      <td>2</td>
    </tr>
    <tr>
      <th>64</th>
      <td>3.532376</td>
      <td>2</td>
    </tr>
    <tr>
      <th>65</th>
      <td>6.242136</td>
      <td>3</td>
    </tr>
    <tr>
      <th>66</th>
      <td>7.171268</td>
      <td>3</td>
    </tr>
    <tr>
      <th>67</th>
      <td>9.698636</td>
      <td>3</td>
    </tr>
    <tr>
      <th>68</th>
      <td>5.584994</td>
      <td>3</td>
    </tr>
    <tr>
      <th>69</th>
      <td>6.193135</td>
      <td>3</td>
    </tr>
    <tr>
      <th>70</th>
      <td>6.306697</td>
      <td>3</td>
    </tr>
    <tr>
      <th>71</th>
      <td>8.230834</td>
      <td>3</td>
    </tr>
    <tr>
      <th>72</th>
      <td>7.093876</td>
      <td>3</td>
    </tr>
    <tr>
      <th>73</th>
      <td>10.298217</td>
      <td>3</td>
    </tr>
    <tr>
      <th>74</th>
      <td>6.255980</td>
      <td>3</td>
    </tr>
    <tr>
      <th>75</th>
      <td>7.206291</td>
      <td>3</td>
    </tr>
    <tr>
      <th>76</th>
      <td>9.257601</td>
      <td>3</td>
    </tr>
    <tr>
      <th>77</th>
      <td>6.195341</td>
      <td>3</td>
    </tr>
    <tr>
      <th>78</th>
      <td>7.597700</td>
      <td>3</td>
    </tr>
    <tr>
      <th>79</th>
      <td>9.833417</td>
      <td>3</td>
    </tr>
    <tr>
      <th>80</th>
      <td>6.140380</td>
      <td>3</td>
    </tr>
    <tr>
      <th>81</th>
      <td>7.256789</td>
      <td>3</td>
    </tr>
    <tr>
      <th>82</th>
      <td>6.221186</td>
      <td>3</td>
    </tr>
    <tr>
      <th>83</th>
      <td>9.744935</td>
      <td>3</td>
    </tr>
    <tr>
      <th>84</th>
      <td>6.034035</td>
      <td>3</td>
    </tr>
    <tr>
      <th>85</th>
      <td>10.275559</td>
      <td>3</td>
    </tr>
    <tr>
      <th>86</th>
      <td>8.678175</td>
      <td>3</td>
    </tr>
    <tr>
      <th>87</th>
      <td>3.521140</td>
      <td>3</td>
    </tr>
    <tr>
      <th>88</th>
      <td>10.988062</td>
      <td>3</td>
    </tr>
    <tr>
      <th>89</th>
      <td>4.471224</td>
      <td>3</td>
    </tr>
    <tr>
      <th>90</th>
      <td>8.562367</td>
      <td>3</td>
    </tr>
    <tr>
      <th>91</th>
      <td>7.391583</td>
      <td>3</td>
    </tr>
    <tr>
      <th>92</th>
      <td>5.816557</td>
      <td>3</td>
    </tr>
    <tr>
      <th>93</th>
      <td>5.659723</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pg</span><span class="o">.</span><span class="n">anova</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">dv</span><span class="o">=</span><span class="s1">&#39;TheData&#39;</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="s1">&#39;Group&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/m0/mambaforge/lib/python3.10/site-packages/pingouin/parametric.py:992: FutureWarning: Not prepending group keys to the result index of transform-like apply. In the future, the group keys will be included in the index, regardless of whether the applied function returns a like-indexed object.
To preserve the previous behavior, use

	&gt;&gt;&gt; .groupby(..., group_keys=False)

To adopt the future behavior and silence this warning, use 

	&gt;&gt;&gt; .groupby(..., group_keys=True)
  sserror = grp.apply(lambda x: (x - x.mean()) ** 2).sum()
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>ddof1</th>
      <th>ddof2</th>
      <th>F</th>
      <th>p-unc</th>
      <th>np2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Group</td>
      <td>2</td>
      <td>91</td>
      <td>35.742067</td>
      <td>3.503359e-12</td>
      <td>0.439945</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pg</span><span class="o">.</span><span class="n">pairwise_tukey</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">dv</span><span class="o">=</span><span class="s1">&#39;TheData&#39;</span><span class="p">,</span><span class="n">between</span><span class="o">=</span><span class="s1">&#39;Group&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/m0/mambaforge/lib/python3.10/site-packages/pingouin/parametric.py:992: FutureWarning: Not prepending group keys to the result index of transform-like apply. In the future, the group keys will be included in the index, regardless of whether the applied function returns a like-indexed object.
To preserve the previous behavior, use

	&gt;&gt;&gt; .groupby(..., group_keys=False)

To adopt the future behavior and silence this warning, use 

	&gt;&gt;&gt; .groupby(..., group_keys=True)
  sserror = grp.apply(lambda x: (x - x.mean()) ** 2).sum()
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>mean(A)</th>
      <th>mean(B)</th>
      <th>diff</th>
      <th>se</th>
      <th>T</th>
      <th>p-tukey</th>
      <th>hedges</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2</td>
      <td>3.941257</td>
      <td>3.891449</td>
      <td>0.049808</td>
      <td>0.456311</td>
      <td>0.109153</td>
      <td>9.934534e-01</td>
      <td>0.026833</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>3</td>
      <td>3.941257</td>
      <td>7.376822</td>
      <td>-3.435565</td>
      <td>0.477601</td>
      <td>-7.193386</td>
      <td>5.179581e-10</td>
      <td>-1.848511</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>3</td>
      <td>3.891449</td>
      <td>7.376822</td>
      <td>-3.485373</td>
      <td>0.460527</td>
      <td>-7.568222</td>
      <td>8.911893e-11</td>
      <td>-1.877343</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="s1">&#39;TheData&#39;</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Group&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8f589e92f5682291bb124298382cf2fbc5d78abcbebd863d0546e5a0c2a13dc6.png" src="../../_images/8f589e92f5682291bb124298382cf2fbc5d78abcbebd863d0546e5a0c2a13dc6.png" />
</div>
</div>
</section>
<section id="one-way-repeated-measures-anova">
<h2>One-way repeated-measures ANOVA<a class="headerlink" href="#one-way-repeated-measures-anova" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pingouin</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## data parameters</span>

<span class="c1"># group means</span>
<span class="n">mean1</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">mean2</span> <span class="o">=</span> <span class="mf">3.8</span>
<span class="n">mean3</span> <span class="o">=</span> <span class="mi">7</span>

<span class="c1"># samples (same across group)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># standard deviation (assume common across groups)</span>
<span class="n">stdev</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## now to simulate the data</span>
<span class="n">data1</span> <span class="o">=</span> <span class="n">mean1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">stdev</span>
<span class="n">data2</span> <span class="o">=</span> <span class="n">mean2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">stdev</span>
<span class="n">data3</span> <span class="o">=</span> <span class="n">mean3</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">stdev</span>

<span class="n">datamat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">data1</span><span class="p">,</span><span class="n">data2</span><span class="p">,</span><span class="n">data3</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># convert to a pandas dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">datamat</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;d1&#39;</span><span class="p">,</span><span class="s1">&#39;d2&#39;</span><span class="p">,</span><span class="s1">&#39;d3&#39;</span><span class="p">])</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>d1</th>
      <th>d2</th>
      <th>d3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.264243</td>
      <td>3.200581</td>
      <td>4.319807</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.407396</td>
      <td>7.784265</td>
      <td>8.430917</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.748442</td>
      <td>2.506896</td>
      <td>3.868972</td>
    </tr>
    <tr>
      <th>3</th>
      <td>7.383694</td>
      <td>2.881485</td>
      <td>6.610015</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.221515</td>
      <td>1.478067</td>
      <td>5.001926</td>
    </tr>
    <tr>
      <th>5</th>
      <td>4.511674</td>
      <td>1.640860</td>
      <td>8.033924</td>
    </tr>
    <tr>
      <th>6</th>
      <td>5.044719</td>
      <td>3.325908</td>
      <td>9.678592</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2.559422</td>
      <td>2.847129</td>
      <td>9.430419</td>
    </tr>
    <tr>
      <th>8</th>
      <td>5.055601</td>
      <td>6.085003</td>
      <td>5.204134</td>
    </tr>
    <tr>
      <th>9</th>
      <td>6.394655</td>
      <td>2.527906</td>
      <td>4.292298</td>
    </tr>
    <tr>
      <th>10</th>
      <td>5.212028</td>
      <td>6.577083</td>
      <td>6.685016</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1.807088</td>
      <td>3.202187</td>
      <td>9.888140</td>
    </tr>
    <tr>
      <th>12</th>
      <td>4.476797</td>
      <td>1.407345</td>
      <td>8.059465</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2.782321</td>
      <td>5.170330</td>
      <td>6.133473</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2.655199</td>
      <td>2.979892</td>
      <td>7.345224</td>
    </tr>
    <tr>
      <th>15</th>
      <td>4.504333</td>
      <td>2.900776</td>
      <td>10.947560</td>
    </tr>
    <tr>
      <th>16</th>
      <td>6.432797</td>
      <td>6.285680</td>
      <td>9.127964</td>
    </tr>
    <tr>
      <th>17</th>
      <td>1.655897</td>
      <td>4.692490</td>
      <td>8.960832</td>
    </tr>
    <tr>
      <th>18</th>
      <td>4.034530</td>
      <td>5.152680</td>
      <td>2.093933</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.886669</td>
      <td>3.023426</td>
      <td>11.981517</td>
    </tr>
    <tr>
      <th>20</th>
      <td>-1.084892</td>
      <td>6.769933</td>
      <td>9.199676</td>
    </tr>
    <tr>
      <th>21</th>
      <td>8.637743</td>
      <td>2.279107</td>
      <td>9.117436</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2.415259</td>
      <td>3.451603</td>
      <td>5.172682</td>
    </tr>
    <tr>
      <th>23</th>
      <td>5.794163</td>
      <td>1.330776</td>
      <td>9.343865</td>
    </tr>
    <tr>
      <th>24</th>
      <td>7.212682</td>
      <td>5.031065</td>
      <td>8.164018</td>
    </tr>
    <tr>
      <th>25</th>
      <td>6.244079</td>
      <td>4.121807</td>
      <td>8.403015</td>
    </tr>
    <tr>
      <th>26</th>
      <td>3.906948</td>
      <td>9.114955</td>
      <td>7.040656</td>
    </tr>
    <tr>
      <th>27</th>
      <td>3.297408</td>
      <td>5.942123</td>
      <td>3.952896</td>
    </tr>
    <tr>
      <th>28</th>
      <td>9.543312</td>
      <td>3.352080</td>
      <td>4.976150</td>
    </tr>
    <tr>
      <th>29</th>
      <td>4.069218</td>
      <td>3.851672</td>
      <td>7.726297</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pg</span><span class="o">.</span><span class="n">rm_anova</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">detailed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/m0/mambaforge/lib/python3.10/site-packages/pingouin/parametric.py:551: FutureWarning: Not prepending group keys to the result index of transform-like apply. In the future, the group keys will be included in the index, regardless of whether the applied function returns a like-indexed object.
To preserve the previous behavior, use

	&gt;&gt;&gt; .groupby(..., group_keys=False)

To adopt the future behavior and silence this warning, use 

	&gt;&gt;&gt; .groupby(..., group_keys=True)
  ss_resall = grp_with.apply(lambda x: (x - x.mean()) ** 2).sum()
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>SS</th>
      <th>DF</th>
      <th>MS</th>
      <th>F</th>
      <th>p-unc</th>
      <th>ng2</th>
      <th>eps</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Within</td>
      <td>203.947838</td>
      <td>2</td>
      <td>101.973919</td>
      <td>18.67657</td>
      <td>5.478945e-07</td>
      <td>0.316596</td>
      <td>0.989966</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Error</td>
      <td>316.679529</td>
      <td>58</td>
      <td>5.459992</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">boxplot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b91359bf124101e1da1a712772e8b2251a4a62120edbbe25cf6a4274e928da0d.png" src="../../_images/b91359bf124101e1da1a712772e8b2251a4a62120edbbe25cf6a4274e928da0d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## example from SPSS website</span>

<span class="c1"># https://www.spss-tutorials.com/repeated-measures-anova/</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">])</span>

<span class="n">pg</span><span class="o">.</span><span class="n">rm_anova</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">detailed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/m0/mambaforge/lib/python3.10/site-packages/pingouin/parametric.py:551: FutureWarning: Not prepending group keys to the result index of transform-like apply. In the future, the group keys will be included in the index, regardless of whether the applied function returns a like-indexed object.
To preserve the previous behavior, use

	&gt;&gt;&gt; .groupby(..., group_keys=False)

To adopt the future behavior and silence this warning, use 

	&gt;&gt;&gt; .groupby(..., group_keys=True)
  ss_resall = grp_with.apply(lambda x: (x - x.mean()) ** 2).sum()
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>SS</th>
      <th>DF</th>
      <th>MS</th>
      <th>F</th>
      <th>p-unc</th>
      <th>ng2</th>
      <th>eps</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Within</td>
      <td>18.2</td>
      <td>3</td>
      <td>6.066667</td>
      <td>3.615894</td>
      <td>0.025787</td>
      <td>0.130372</td>
      <td>0.697356</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Error</td>
      <td>45.3</td>
      <td>27</td>
      <td>1.677778</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="a-real-world-data-journey">
<h1>A real-world data journey<a class="headerlink" href="#a-real-world-data-journey" title="Permalink to this headline"></a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># data urls</span>

<span class="n">marriage_url</span> <span class="o">=</span> <span class="s1">&#39;https://www.cdc.gov/nchs/data/dvs/state-marriage-rates-90-95-99-19.xlsx&#39;</span>
<span class="n">divorce_url</span>  <span class="o">=</span> <span class="s1">&#39;https://www.cdc.gov/nchs/data/dvs/state-divorce-rates-90-95-99-19.xlsx&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">marriage_url</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>2019</th>
      <th>2018</th>
      <th>2017</th>
      <th>2016</th>
      <th>2015</th>
      <th>2014</th>
      <th>2013</th>
      <th>2012</th>
      <th>2011</th>
      <th>2010</th>
      <th>2009</th>
      <th>2008</th>
      <th>2007</th>
      <th>2006</th>
      <th>2005</th>
      <th>2004</th>
      <th>2003</th>
      <th>2002</th>
      <th>2001</th>
      <th>2000</th>
      <th>1999</th>
      <th>1995</th>
      <th>1990</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>6.697687</td>
      <td>6.760408</td>
      <td>7.047340</td>
      <td>7.147821</td>
      <td>7.351544</td>
      <td>7.806776</td>
      <td>7.817785</td>
      <td>8.2</td>
      <td>8.4</td>
      <td>8.2</td>
      <td>8.3</td>
      <td>8.6</td>
      <td>8.9</td>
      <td>9.2</td>
      <td>9.2</td>
      <td>9.4</td>
      <td>9.6</td>
      <td>9.9</td>
      <td>9.4</td>
      <td>10.1</td>
      <td>10.8</td>
      <td>9.8</td>
      <td>10.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alaska</td>
      <td>6.512245</td>
      <td>6.683952</td>
      <td>6.914078</td>
      <td>7.103441</td>
      <td>7.407588</td>
      <td>7.508836</td>
      <td>7.293928</td>
      <td>7.2</td>
      <td>7.8</td>
      <td>8.0</td>
      <td>7.8</td>
      <td>8.4</td>
      <td>8.5</td>
      <td>8.2</td>
      <td>8.2</td>
      <td>8.5</td>
      <td>8.1</td>
      <td>8.3</td>
      <td>8.1</td>
      <td>8.9</td>
      <td>8.6</td>
      <td>9.0</td>
      <td>10.2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arizona</td>
      <td>5.302995</td>
      <td>5.534434</td>
      <td>5.834867</td>
      <td>5.930541</td>
      <td>5.922469</td>
      <td>5.780449</td>
      <td>5.401091</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>5.6</td>
      <td>6.0</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.5</td>
      <td>6.7</td>
      <td>7.6</td>
      <td>7.5</td>
      <td>8.2</td>
      <td>8.8</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arkansas</td>
      <td>8.377284</td>
      <td>8.863156</td>
      <td>9.456845</td>
      <td>9.860962</td>
      <td>10.040279</td>
      <td>10.112026</td>
      <td>9.751052</td>
      <td>10.9</td>
      <td>10.4</td>
      <td>10.8</td>
      <td>10.7</td>
      <td>10.6</td>
      <td>12.0</td>
      <td>12.4</td>
      <td>12.9</td>
      <td>13.4</td>
      <td>13.4</td>
      <td>14.3</td>
      <td>14.3</td>
      <td>15.4</td>
      <td>14.8</td>
      <td>14.4</td>
      <td>15.3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>California 1</td>
      <td>5.723191</td>
      <td>6.035132</td>
      <td>6.278250</td>
      <td>6.463590</td>
      <td>6.184957</td>
      <td>6.441492</td>
      <td>6.460467</td>
      <td>6.0</td>
      <td>5.8</td>
      <td>5.8</td>
      <td>5.8</td>
      <td>6.7</td>
      <td>6.2</td>
      <td>6.3</td>
      <td>6.4</td>
      <td>6.4</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>6.5</td>
      <td>5.8</td>
      <td>6.4</td>
      <td>6.3</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Colorado</td>
      <td>7.273297</td>
      <td>7.585728</td>
      <td>7.333845</td>
      <td>7.425443</td>
      <td>6.791807</td>
      <td>7.061603</td>
      <td>6.452664</td>
      <td>6.8</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.4</td>
      <td>7.1</td>
      <td>7.2</td>
      <td>7.6</td>
      <td>7.4</td>
      <td>7.8</td>
      <td>8</td>
      <td>8.2</td>
      <td>8.3</td>
      <td>8.2</td>
      <td>9.0</td>
      <td>9.8</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Connecticut</td>
      <td>5.048401</td>
      <td>5.278133</td>
      <td>5.553784</td>
      <td>5.617858</td>
      <td>5.292009</td>
      <td>5.368845</td>
      <td>5.021023</td>
      <td>5.2</td>
      <td>5.5</td>
      <td>5.6</td>
      <td>5.9</td>
      <td>5.4</td>
      <td>5.5</td>
      <td>5.5</td>
      <td>5.8</td>
      <td>5.8</td>
      <td>5.5</td>
      <td>5.7</td>
      <td>5.4</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>6.6</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Delaware</td>
      <td>4.951919</td>
      <td>5.237957</td>
      <td>5.528417</td>
      <td>5.613062</td>
      <td>5.712872</td>
      <td>6.022783</td>
      <td>6.571976</td>
      <td>5.8</td>
      <td>5.2</td>
      <td>5.2</td>
      <td>5.4</td>
      <td>5.5</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>5.9</td>
      <td>6.1</td>
      <td>6</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.7</td>
      <td>7.3</td>
      <td>8.4</td>
    </tr>
    <tr>
      <th>9</th>
      <td>District of Columbia</td>
      <td>7.773302</td>
      <td>7.835377</td>
      <td>8.239526</td>
      <td>8.149214</td>
      <td>8.220425</td>
      <td>11.821343</td>
      <td>10.791261</td>
      <td>8.4</td>
      <td>8.7</td>
      <td>7.6</td>
      <td>4.7</td>
      <td>4.1</td>
      <td>4.2</td>
      <td>4</td>
      <td>4.1</td>
      <td>5.2</td>
      <td>5.1</td>
      <td>5.1</td>
      <td>6.2</td>
      <td>4.9</td>
      <td>6.6</td>
      <td>6.1</td>
      <td>8.2</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Florida</td>
      <td>7.070065</td>
      <td>7.332063</td>
      <td>7.806895</td>
      <td>8.125967</td>
      <td>8.234362</td>
      <td>7.301404</td>
      <td>7.009614</td>
      <td>7.2</td>
      <td>7.4</td>
      <td>7.3</td>
      <td>7.5</td>
      <td>8.0</td>
      <td>8.5</td>
      <td>8.6</td>
      <td>8.9</td>
      <td>9.0</td>
      <td>9</td>
      <td>9.4</td>
      <td>9.3</td>
      <td>8.9</td>
      <td>8.7</td>
      <td>9.9</td>
      <td>10.9</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Georgia</td>
      <td>6.038471</td>
      <td>6.391479</td>
      <td>6.870975</td>
      <td>6.753976</td>
      <td>6.200379</td>
      <td>---</td>
      <td>---</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>7.3</td>
      <td>6.6</td>
      <td>6.0</td>
      <td>6.8</td>
      <td>7.3</td>
      <td>7.0</td>
      <td>7.9</td>
      <td>7</td>
      <td>6.5</td>
      <td>6.1</td>
      <td>6.8</td>
      <td>7.8</td>
      <td>8.4</td>
      <td>10.3</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Hawaii</td>
      <td>14.172891</td>
      <td>15.263736</td>
      <td>15.346702</td>
      <td>15.555557</td>
      <td>15.940173</td>
      <td>17.702656</td>
      <td>16.294245</td>
      <td>17.5</td>
      <td>17.6</td>
      <td>17.6</td>
      <td>17.2</td>
      <td>19.1</td>
      <td>20.8</td>
      <td>21.9</td>
      <td>22.6</td>
      <td>22.6</td>
      <td>22</td>
      <td>20.8</td>
      <td>19.6</td>
      <td>20.6</td>
      <td>18.9</td>
      <td>15.7</td>
      <td>16.4</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Idaho</td>
      <td>7.389770</td>
      <td>7.810362</td>
      <td>7.796997</td>
      <td>8.077759</td>
      <td>8.151402</td>
      <td>8.366045</td>
      <td>8.17859</td>
      <td>8.2</td>
      <td>8.6</td>
      <td>8.8</td>
      <td>8.9</td>
      <td>9.5</td>
      <td>10.0</td>
      <td>10.1</td>
      <td>10.5</td>
      <td>10.8</td>
      <td>10.9</td>
      <td>11</td>
      <td>11.2</td>
      <td>10.8</td>
      <td>12.1</td>
      <td>13.1</td>
      <td>13.9</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Illinois</td>
      <td>5.162794</td>
      <td>5.478499</td>
      <td>5.982023</td>
      <td>5.800000</td>
      <td>5.880873</td>
      <td>6.169054</td>
      <td>5.394059</td>
      <td>5.8</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>5.9</td>
      <td>6.2</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>7.2</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>8.8</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Indiana</td>
      <td>6.176270</td>
      <td>6.554662</td>
      <td>6.854694</td>
      <td>6.935419</td>
      <td>6.856525</td>
      <td>7.08004</td>
      <td>6.607464</td>
      <td>6.7</td>
      <td>6.8</td>
      <td>6.3</td>
      <td>7.9</td>
      <td>8.0</td>
      <td>7.0</td>
      <td>7</td>
      <td>6.9</td>
      <td>7.8</td>
      <td>7.1</td>
      <td>7.9</td>
      <td>7.9</td>
      <td>7.9</td>
      <td>8.1</td>
      <td>8.6</td>
      <td>9.6</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Iowa</td>
      <td>5.403684</td>
      <td>5.737696</td>
      <td>6.176028</td>
      <td>6.149566</td>
      <td>6.255004</td>
      <td>6.863899</td>
      <td>7.390914</td>
      <td>6.8</td>
      <td>6.7</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7</td>
      <td>7.1</td>
      <td>6.9</td>
      <td>7.9</td>
      <td>7.7</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Kansas</td>
      <td>5.341683</td>
      <td>5.366984</td>
      <td>5.970225</td>
      <td>6.210941</td>
      <td>5.936515</td>
      <td>6.101884</td>
      <td>5.98454</td>
      <td>6.3</td>
      <td>6.3</td>
      <td>6.4</td>
      <td>6.4</td>
      <td>6.7</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>7.3</td>
      <td>7.5</td>
      <td>8.3</td>
      <td>7.1</td>
      <td>8.5</td>
      <td>9.2</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Kentucky</td>
      <td>6.265454</td>
      <td>6.774234</td>
      <td>7.174146</td>
      <td>7.379354</td>
      <td>7.172506</td>
      <td>6.941724</td>
      <td>7.278692</td>
      <td>7.2</td>
      <td>7.5</td>
      <td>7.4</td>
      <td>7.6</td>
      <td>7.9</td>
      <td>7.8</td>
      <td>8.4</td>
      <td>8.7</td>
      <td>8.8</td>
      <td>9.1</td>
      <td>9</td>
      <td>9</td>
      <td>9.8</td>
      <td>10.9</td>
      <td>12.2</td>
      <td>13.5</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Louisiana</td>
      <td>5.094870</td>
      <td>5.118908</td>
      <td>5.592472</td>
      <td>6.106373</td>
      <td>6.777108</td>
      <td>6.892953</td>
      <td>6.370812</td>
      <td>5.7</td>
      <td>6.4</td>
      <td>6.9</td>
      <td>7.1</td>
      <td>6.8</td>
      <td>7.5</td>
      <td>---</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.2</td>
      <td>8.1</td>
      <td>8.4</td>
      <td>9.1</td>
      <td>9.1</td>
      <td>9.3</td>
      <td>9.6</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Maine</td>
      <td>7.053203</td>
      <td>7.390145</td>
      <td>7.585857</td>
      <td>7.640376</td>
      <td>7.610612</td>
      <td>7.745346</td>
      <td>8.31061</td>
      <td>7.3</td>
      <td>7.2</td>
      <td>7.1</td>
      <td>7.1</td>
      <td>7.4</td>
      <td>7.4</td>
      <td>7.8</td>
      <td>8.2</td>
      <td>8.6</td>
      <td>8.4</td>
      <td>8.4</td>
      <td>8.6</td>
      <td>8.8</td>
      <td>8.6</td>
      <td>8.7</td>
      <td>9.7</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Maryland</td>
      <td>5.592919</td>
      <td>5.867393</td>
      <td>6.268158</td>
      <td>6.308374</td>
      <td>6.187233</td>
      <td>6.461575</td>
      <td>6.823793</td>
      <td>5.6</td>
      <td>5.8</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>5.9</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.1</td>
      <td>7</td>
      <td>7.5</td>
      <td>7.5</td>
      <td>8.4</td>
      <td>9.7</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Massachusetts</td>
      <td>5.019222</td>
      <td>6.269931</td>
      <td>5.749423</td>
      <td>5.777052</td>
      <td>5.497009</td>
      <td>5.60485</td>
      <td>5.501415</td>
      <td>5.5</td>
      <td>5.5</td>
      <td>5.6</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>5.9</td>
      <td>6.2</td>
      <td>6.5</td>
      <td>5.6</td>
      <td>5.9</td>
      <td>6.2</td>
      <td>5.8</td>
      <td>6.2</td>
      <td>7.1</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Michigan</td>
      <td>5.183913</td>
      <td>5.678220</td>
      <td>5.887088</td>
      <td>5.935155</td>
      <td>5.984938</td>
      <td>5.759103</td>
      <td>5.812267</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.5</td>
      <td>5.4</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>6.3</td>
      <td>6.5</td>
      <td>6.7</td>
      <td>6.7</td>
      <td>6.8</td>
      <td>7.3</td>
      <td>8.2</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Minnesota</td>
      <td>5.074090</td>
      <td>5.304589</td>
      <td>5.611836</td>
      <td>5.617984</td>
      <td>5.578555</td>
      <td>5.895727</td>
      <td>5.998288</td>
      <td>5.6</td>
      <td>5.6</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.4</td>
      <td>5.8</td>
      <td>6</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>6.3</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>7.0</td>
      <td>7.7</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Mississippi</td>
      <td>6.018516</td>
      <td>6.282877</td>
      <td>6.720619</td>
      <td>7.013691</td>
      <td>6.993874</td>
      <td>6.930345</td>
      <td>6.715684</td>
      <td>5.8</td>
      <td>4.9</td>
      <td>4.9</td>
      <td>4.8</td>
      <td>5.1</td>
      <td>5.4</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.9</td>
      <td>7.8</td>
      <td>7.9</td>
      <td>9.4</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Missouri</td>
      <td>5.969276</td>
      <td>6.478791</td>
      <td>6.594551</td>
      <td>6.851633</td>
      <td>6.800000</td>
      <td>6.725225</td>
      <td>6.449851</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.8</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>7.1</td>
      <td>7.2</td>
      <td>7.3</td>
      <td>7.5</td>
      <td>7.8</td>
      <td>8.1</td>
      <td>8.3</td>
      <td>9.6</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Montana</td>
      <td>7.886577</td>
      <td>7.713416</td>
      <td>7.963880</td>
      <td>7.840617</td>
      <td>7.962639</td>
      <td>7.857723</td>
      <td>7.398797</td>
      <td>7.8</td>
      <td>7.8</td>
      <td>7.4</td>
      <td>7.3</td>
      <td>7.6</td>
      <td>7.5</td>
      <td>7.4</td>
      <td>7.4</td>
      <td>7.5</td>
      <td>7.2</td>
      <td>7.1</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>7.4</td>
      <td>7.6</td>
      <td>8.6</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Nebraska</td>
      <td>5.498323</td>
      <td>5.976878</td>
      <td>6.313813</td>
      <td>6.465784</td>
      <td>6.378053</td>
      <td>6.415084</td>
      <td>6.294835</td>
      <td>6.7</td>
      <td>6.6</td>
      <td>6.6</td>
      <td>6.6</td>
      <td>6.9</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>7.0</td>
      <td>7.1</td>
      <td>7</td>
      <td>7.5</td>
      <td>7.9</td>
      <td>7.6</td>
      <td>7.5</td>
      <td>7.3</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Nevada</td>
      <td>25.894792</td>
      <td>26.734186</td>
      <td>28.556333</td>
      <td>28.392297</td>
      <td>31.017920</td>
      <td>31.85095</td>
      <td>32.280147</td>
      <td>35.1</td>
      <td>36.9</td>
      <td>38.3</td>
      <td>40.3</td>
      <td>42.3</td>
      <td>48.6</td>
      <td>52.1</td>
      <td>57.4</td>
      <td>62.1</td>
      <td>63.9</td>
      <td>67.4</td>
      <td>69.6</td>
      <td>72.2</td>
      <td>82.3</td>
      <td>85.2</td>
      <td>99.0</td>
    </tr>
    <tr>
      <th>30</th>
      <td>New Hampshire</td>
      <td>6.637440</td>
      <td>6.932762</td>
      <td>7.030857</td>
      <td>6.977101</td>
      <td>6.938182</td>
      <td>7.187147</td>
      <td>6.901612</td>
      <td>6.8</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>6.5</td>
      <td>6.8</td>
      <td>7.1</td>
      <td>7.2</td>
      <td>7.3</td>
      <td>8.0</td>
      <td>8.1</td>
      <td>8.3</td>
      <td>8.5</td>
      <td>9.4</td>
      <td>7.9</td>
      <td>8.3</td>
      <td>9.5</td>
    </tr>
    <tr>
      <th>31</th>
      <td>New Jersey</td>
      <td>5.187009</td>
      <td>5.367783</td>
      <td>5.450804</td>
      <td>5.654780</td>
      <td>5.606042</td>
      <td>5.403116</td>
      <td>5.130831</td>
      <td>4.9</td>
      <td>4.8</td>
      <td>5.1</td>
      <td>5.0</td>
      <td>5.4</td>
      <td>5.4</td>
      <td>5.5</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>5.8</td>
      <td>6</td>
      <td>6.4</td>
      <td>6</td>
      <td>5.9</td>
      <td>6.5</td>
      <td>7.6</td>
    </tr>
    <tr>
      <th>32</th>
      <td>New Mexico</td>
      <td>5.981413</td>
      <td>6.449279</td>
      <td>5.925568</td>
      <td>6.366124</td>
      <td>6.171860</td>
      <td>8.080277</td>
      <td>7.255596</td>
      <td>6.9</td>
      <td>8.0</td>
      <td>7.7</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.6</td>
      <td>6.8</td>
      <td>6.6</td>
      <td>7.4</td>
      <td>6.9</td>
      <td>7.9</td>
      <td>7.6</td>
      <td>8</td>
      <td>8.0</td>
      <td>8.8</td>
      <td>8.8</td>
    </tr>
    <tr>
      <th>33</th>
      <td>New York</td>
      <td>7.217085</td>
      <td>7.106515</td>
      <td>7.344656</td>
      <td>7.451752</td>
      <td>7.056096</td>
      <td>6.689784</td>
      <td>6.890139</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.8</td>
      <td>6.9</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>7.3</td>
      <td>7.6</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>8.0</td>
      <td>8.6</td>
    </tr>
    <tr>
      <th>34</th>
      <td>North Carolina</td>
      <td>6.181491</td>
      <td>6.433883</td>
      <td>6.846406</td>
      <td>6.967624</td>
      <td>6.959910</td>
      <td>6.892221</td>
      <td>6.510013</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.6</td>
      <td>6.6</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.4</td>
      <td>7.7</td>
      <td>7.4</td>
      <td>8.2</td>
      <td>8.5</td>
      <td>8.4</td>
      <td>7.8</td>
    </tr>
    <tr>
      <th>35</th>
      <td>North Dakota</td>
      <td>5.423443</td>
      <td>5.682319</td>
      <td>5.761240</td>
      <td>5.955522</td>
      <td>6.172326</td>
      <td>6.300356</td>
      <td>6.340952</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.5</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.8</td>
      <td>6.9</td>
      <td>7.1</td>
      <td>6.8</td>
      <td>6.5</td>
      <td>7.2</td>
      <td>6.6</td>
      <td>7.1</td>
      <td>7.5</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Ohio</td>
      <td>5.329324</td>
      <td>5.617035</td>
      <td>5.821192</td>
      <td>5.956154</td>
      <td>5.905580</td>
      <td>5.751515</td>
      <td>5.708936</td>
      <td>5.8</td>
      <td>5.9</td>
      <td>5.8</td>
      <td>5.8</td>
      <td>6.0</td>
      <td>6.1</td>
      <td>6.3</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>7</td>
      <td>7.2</td>
      <td>7.8</td>
      <td>7.8</td>
      <td>8.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Oklahoma</td>
      <td>6.336918</td>
      <td>6.371924</td>
      <td>6.815296</td>
      <td>6.678882</td>
      <td>7.418945</td>
      <td>7.075203</td>
      <td>7.083371</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.2</td>
      <td>6.9</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>6.5</td>
      <td>---</td>
      <td>---</td>
      <td>---</td>
      <td>---</td>
      <td>6.8</td>
      <td>8.6</td>
      <td>10.6</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Oregon</td>
      <td>5.991839</td>
      <td>6.322075</td>
      <td>6.660993</td>
      <td>6.859226</td>
      <td>6.887356</td>
      <td>6.834097</td>
      <td>6.334755</td>
      <td>6.6</td>
      <td>6.6</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.9</td>
      <td>7.2</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>8.1</td>
      <td>7.2</td>
      <td>7.1</td>
      <td>7.5</td>
      <td>7.6</td>
      <td>7.6</td>
      <td>8.1</td>
      <td>8.9</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Pennsylvania</td>
      <td>5.351512</td>
      <td>5.545691</td>
      <td>5.724399</td>
      <td>5.778683</td>
      <td>5.684592</td>
      <td>5.84287</td>
      <td>5.432291</td>
      <td>5.5</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.5</td>
      <td>5.7</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>5.9</td>
      <td>5.9</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>6</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>7.1</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Rhode Island</td>
      <td>6.149934</td>
      <td>6.297083</td>
      <td>6.767399</td>
      <td>6.710361</td>
      <td>6.353321</td>
      <td>6.669996</td>
      <td>6.212964</td>
      <td>6.1</td>
      <td>6.0</td>
      <td>5.8</td>
      <td>5.9</td>
      <td>6.1</td>
      <td>6.4</td>
      <td>6.6</td>
      <td>7.0</td>
      <td>7.7</td>
      <td>7.8</td>
      <td>7.8</td>
      <td>8.1</td>
      <td>7.6</td>
      <td>7.5</td>
      <td>7.3</td>
      <td>8.1</td>
    </tr>
    <tr>
      <th>41</th>
      <td>South Carolina</td>
      <td>6.288172</td>
      <td>6.585398</td>
      <td>7.034316</td>
      <td>6.632979</td>
      <td>7.498347</td>
      <td>7.624033</td>
      <td>7.142021</td>
      <td>7.4</td>
      <td>7.2</td>
      <td>7.4</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.9</td>
      <td>7.8</td>
      <td>8.3</td>
      <td>8.2</td>
      <td>9</td>
      <td>9.3</td>
      <td>9.9</td>
      <td>10.6</td>
      <td>10.2</td>
      <td>11.9</td>
      <td>15.9</td>
    </tr>
    <tr>
      <th>42</th>
      <td>South Dakota</td>
      <td>6.144741</td>
      <td>6.535674</td>
      <td>6.742819</td>
      <td>7.247063</td>
      <td>7.214005</td>
      <td>7.073578</td>
      <td>7.005754</td>
      <td>7.5</td>
      <td>7.5</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.7</td>
      <td>7.8</td>
      <td>8</td>
      <td>8.4</td>
      <td>8.4</td>
      <td>8.4</td>
      <td>8.8</td>
      <td>8.9</td>
      <td>9.4</td>
      <td>9.1</td>
      <td>9.9</td>
      <td>11.1</td>
    </tr>
    <tr>
      <th>43</th>
      <td>Tennessee</td>
      <td>7.488753</td>
      <td>7.951096</td>
      <td>8.234385</td>
      <td>8.614092</td>
      <td>8.502342</td>
      <td>8.409229</td>
      <td>8.447843</td>
      <td>8.8</td>
      <td>9.0</td>
      <td>8.8</td>
      <td>8.4</td>
      <td>9.4</td>
      <td>10.1</td>
      <td>10.6</td>
      <td>10.9</td>
      <td>11.4</td>
      <td>11.9</td>
      <td>13.1</td>
      <td>13.5</td>
      <td>15.5</td>
      <td>14.7</td>
      <td>15.5</td>
      <td>13.9</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Texas</td>
      <td>4.867898</td>
      <td>6.121488</td>
      <td>7.096127</td>
      <td>7.077625</td>
      <td>7.214466</td>
      <td>6.851589</td>
      <td>6.976356</td>
      <td>7.3</td>
      <td>7.1</td>
      <td>7.1</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>7.4</td>
      <td>7.6</td>
      <td>7.8</td>
      <td>8.0</td>
      <td>8.1</td>
      <td>8.4</td>
      <td>9.1</td>
      <td>9.4</td>
      <td>9.1</td>
      <td>9.9</td>
      <td>10.5</td>
    </tr>
    <tr>
      <th>45</th>
      <td>Utah</td>
      <td>8.058122</td>
      <td>8.355306</td>
      <td>8.720650</td>
      <td>8.990183</td>
      <td>8.075986</td>
      <td>7.317947</td>
      <td>7.503606</td>
      <td>8.4</td>
      <td>8.6</td>
      <td>8.5</td>
      <td>8.4</td>
      <td>9.0</td>
      <td>9.6</td>
      <td>9.2</td>
      <td>9.8</td>
      <td>9.9</td>
      <td>10.2</td>
      <td>10.4</td>
      <td>10.2</td>
      <td>10.8</td>
      <td>9.6</td>
      <td>10.7</td>
      <td>11.2</td>
    </tr>
    <tr>
      <th>46</th>
      <td>Vermont</td>
      <td>7.726098</td>
      <td>7.943490</td>
      <td>7.908193</td>
      <td>8.299792</td>
      <td>8.124056</td>
      <td>8.698261</td>
      <td>9.155323</td>
      <td>8.2</td>
      <td>8.3</td>
      <td>9.3</td>
      <td>8.7</td>
      <td>7.9</td>
      <td>8.5</td>
      <td>8.6</td>
      <td>8.9</td>
      <td>9.4</td>
      <td>9.7</td>
      <td>9.8</td>
      <td>9.8</td>
      <td>10</td>
      <td>10.0</td>
      <td>10.3</td>
      <td>10.9</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Virginia</td>
      <td>6.128508</td>
      <td>6.398452</td>
      <td>6.783573</td>
      <td>6.988628</td>
      <td>6.980323</td>
      <td>6.744421</td>
      <td>6.657785</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>6.9</td>
      <td>7.2</td>
      <td>7.5</td>
      <td>7.8</td>
      <td>8.2</td>
      <td>8.3</td>
      <td>8.4</td>
      <td>8.6</td>
      <td>8.8</td>
      <td>8.8</td>
      <td>9.2</td>
      <td>10.2</td>
      <td>11.4</td>
    </tr>
    <tr>
      <th>48</th>
      <td>Washington</td>
      <td>5.749260</td>
      <td>6.023947</td>
      <td>6.246909</td>
      <td>6.235593</td>
      <td>6.219361</td>
      <td>6.956141</td>
      <td>7.11033</td>
      <td>6.3</td>
      <td>6.1</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>6.3</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>7</td>
      <td>6.9</td>
      <td>7.2</td>
      <td>7.7</td>
      <td>9.5</td>
    </tr>
    <tr>
      <th>49</th>
      <td>West Virginia</td>
      <td>5.978862</td>
      <td>6.067010</td>
      <td>6.311620</td>
      <td>6.354097</td>
      <td>6.574923</td>
      <td>6.669095</td>
      <td>6.644002</td>
      <td>7.0</td>
      <td>7.2</td>
      <td>6.7</td>
      <td>6.7</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.4</td>
      <td>7.5</td>
      <td>7.5</td>
      <td>8.1</td>
      <td>7.9</td>
      <td>8.7</td>
      <td>7.5</td>
      <td>6.1</td>
      <td>7.2</td>
    </tr>
    <tr>
      <th>50</th>
      <td>Wisconsin</td>
      <td>5.037240</td>
      <td>5.430056</td>
      <td>5.634561</td>
      <td>5.616134</td>
      <td>5.611351</td>
      <td>5.691296</td>
      <td>5.219136</td>
      <td>5.4</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>6</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>6.2</td>
      <td>6.3</td>
      <td>6.5</td>
      <td>6.7</td>
      <td>6.7</td>
      <td>7.0</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Wyoming</td>
      <td>7.008098</td>
      <td>7.051652</td>
      <td>7.125657</td>
      <td>7.079407</td>
      <td>7.341663</td>
      <td>7.658952</td>
      <td>7.549883</td>
      <td>7.6</td>
      <td>7.8</td>
      <td>7.6</td>
      <td>8.0</td>
      <td>8.6</td>
      <td>9.0</td>
      <td>9.3</td>
      <td>9.3</td>
      <td>9.3</td>
      <td>9.3</td>
      <td>9.5</td>
      <td>10</td>
      <td>10</td>
      <td>9.9</td>
      <td>10.6</td>
      <td>10.7</td>
    </tr>
    <tr>
      <th>52</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>53</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>54</th>
      <td>--- Data not available.</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>55</th>
      <td>1 Marriage data includes nonlicensed marriages...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>56</th>
      <td>Note: Rate for 2015 for Missouri and for 2016 ...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>57</th>
      <td>Source: CDC/NCHS, National Vital Statistics Sy...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># remove irrelevant rows</span>
<span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">52</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">57</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>2019</th>
      <th>2018</th>
      <th>2017</th>
      <th>2016</th>
      <th>2015</th>
      <th>2014</th>
      <th>2013</th>
      <th>2012</th>
      <th>2011</th>
      <th>2010</th>
      <th>2009</th>
      <th>2008</th>
      <th>2007</th>
      <th>2006</th>
      <th>2005</th>
      <th>2004</th>
      <th>2003</th>
      <th>2002</th>
      <th>2001</th>
      <th>2000</th>
      <th>1999</th>
      <th>1995</th>
      <th>1990</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>6.697687</td>
      <td>6.760408</td>
      <td>7.047340</td>
      <td>7.147821</td>
      <td>7.351544</td>
      <td>7.806776</td>
      <td>7.817785</td>
      <td>8.2</td>
      <td>8.4</td>
      <td>8.2</td>
      <td>8.3</td>
      <td>8.6</td>
      <td>8.9</td>
      <td>9.2</td>
      <td>9.2</td>
      <td>9.4</td>
      <td>9.6</td>
      <td>9.9</td>
      <td>9.4</td>
      <td>10.1</td>
      <td>10.8</td>
      <td>9.8</td>
      <td>10.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alaska</td>
      <td>6.512245</td>
      <td>6.683952</td>
      <td>6.914078</td>
      <td>7.103441</td>
      <td>7.407588</td>
      <td>7.508836</td>
      <td>7.293928</td>
      <td>7.2</td>
      <td>7.8</td>
      <td>8.0</td>
      <td>7.8</td>
      <td>8.4</td>
      <td>8.5</td>
      <td>8.2</td>
      <td>8.2</td>
      <td>8.5</td>
      <td>8.1</td>
      <td>8.3</td>
      <td>8.1</td>
      <td>8.9</td>
      <td>8.6</td>
      <td>9.0</td>
      <td>10.2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arizona</td>
      <td>5.302995</td>
      <td>5.534434</td>
      <td>5.834867</td>
      <td>5.930541</td>
      <td>5.922469</td>
      <td>5.780449</td>
      <td>5.401091</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>5.6</td>
      <td>6.0</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.5</td>
      <td>6.7</td>
      <td>7.6</td>
      <td>7.5</td>
      <td>8.2</td>
      <td>8.8</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arkansas</td>
      <td>8.377284</td>
      <td>8.863156</td>
      <td>9.456845</td>
      <td>9.860962</td>
      <td>10.040279</td>
      <td>10.112026</td>
      <td>9.751052</td>
      <td>10.9</td>
      <td>10.4</td>
      <td>10.8</td>
      <td>10.7</td>
      <td>10.6</td>
      <td>12.0</td>
      <td>12.4</td>
      <td>12.9</td>
      <td>13.4</td>
      <td>13.4</td>
      <td>14.3</td>
      <td>14.3</td>
      <td>15.4</td>
      <td>14.8</td>
      <td>14.4</td>
      <td>15.3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>California 1</td>
      <td>5.723191</td>
      <td>6.035132</td>
      <td>6.278250</td>
      <td>6.463590</td>
      <td>6.184957</td>
      <td>6.441492</td>
      <td>6.460467</td>
      <td>6.0</td>
      <td>5.8</td>
      <td>5.8</td>
      <td>5.8</td>
      <td>6.7</td>
      <td>6.2</td>
      <td>6.3</td>
      <td>6.4</td>
      <td>6.4</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>6.5</td>
      <td>5.8</td>
      <td>6.4</td>
      <td>6.3</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Colorado</td>
      <td>7.273297</td>
      <td>7.585728</td>
      <td>7.333845</td>
      <td>7.425443</td>
      <td>6.791807</td>
      <td>7.061603</td>
      <td>6.452664</td>
      <td>6.8</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.4</td>
      <td>7.1</td>
      <td>7.2</td>
      <td>7.6</td>
      <td>7.4</td>
      <td>7.8</td>
      <td>8</td>
      <td>8.2</td>
      <td>8.3</td>
      <td>8.2</td>
      <td>9.0</td>
      <td>9.8</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Connecticut</td>
      <td>5.048401</td>
      <td>5.278133</td>
      <td>5.553784</td>
      <td>5.617858</td>
      <td>5.292009</td>
      <td>5.368845</td>
      <td>5.021023</td>
      <td>5.2</td>
      <td>5.5</td>
      <td>5.6</td>
      <td>5.9</td>
      <td>5.4</td>
      <td>5.5</td>
      <td>5.5</td>
      <td>5.8</td>
      <td>5.8</td>
      <td>5.5</td>
      <td>5.7</td>
      <td>5.4</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>6.6</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Delaware</td>
      <td>4.951919</td>
      <td>5.237957</td>
      <td>5.528417</td>
      <td>5.613062</td>
      <td>5.712872</td>
      <td>6.022783</td>
      <td>6.571976</td>
      <td>5.8</td>
      <td>5.2</td>
      <td>5.2</td>
      <td>5.4</td>
      <td>5.5</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>5.9</td>
      <td>6.1</td>
      <td>6</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.7</td>
      <td>7.3</td>
      <td>8.4</td>
    </tr>
    <tr>
      <th>9</th>
      <td>District of Columbia</td>
      <td>7.773302</td>
      <td>7.835377</td>
      <td>8.239526</td>
      <td>8.149214</td>
      <td>8.220425</td>
      <td>11.821343</td>
      <td>10.791261</td>
      <td>8.4</td>
      <td>8.7</td>
      <td>7.6</td>
      <td>4.7</td>
      <td>4.1</td>
      <td>4.2</td>
      <td>4</td>
      <td>4.1</td>
      <td>5.2</td>
      <td>5.1</td>
      <td>5.1</td>
      <td>6.2</td>
      <td>4.9</td>
      <td>6.6</td>
      <td>6.1</td>
      <td>8.2</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Florida</td>
      <td>7.070065</td>
      <td>7.332063</td>
      <td>7.806895</td>
      <td>8.125967</td>
      <td>8.234362</td>
      <td>7.301404</td>
      <td>7.009614</td>
      <td>7.2</td>
      <td>7.4</td>
      <td>7.3</td>
      <td>7.5</td>
      <td>8.0</td>
      <td>8.5</td>
      <td>8.6</td>
      <td>8.9</td>
      <td>9.0</td>
      <td>9</td>
      <td>9.4</td>
      <td>9.3</td>
      <td>8.9</td>
      <td>8.7</td>
      <td>9.9</td>
      <td>10.9</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Georgia</td>
      <td>6.038471</td>
      <td>6.391479</td>
      <td>6.870975</td>
      <td>6.753976</td>
      <td>6.200379</td>
      <td>---</td>
      <td>---</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>7.3</td>
      <td>6.6</td>
      <td>6.0</td>
      <td>6.8</td>
      <td>7.3</td>
      <td>7.0</td>
      <td>7.9</td>
      <td>7</td>
      <td>6.5</td>
      <td>6.1</td>
      <td>6.8</td>
      <td>7.8</td>
      <td>8.4</td>
      <td>10.3</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Hawaii</td>
      <td>14.172891</td>
      <td>15.263736</td>
      <td>15.346702</td>
      <td>15.555557</td>
      <td>15.940173</td>
      <td>17.702656</td>
      <td>16.294245</td>
      <td>17.5</td>
      <td>17.6</td>
      <td>17.6</td>
      <td>17.2</td>
      <td>19.1</td>
      <td>20.8</td>
      <td>21.9</td>
      <td>22.6</td>
      <td>22.6</td>
      <td>22</td>
      <td>20.8</td>
      <td>19.6</td>
      <td>20.6</td>
      <td>18.9</td>
      <td>15.7</td>
      <td>16.4</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Idaho</td>
      <td>7.389770</td>
      <td>7.810362</td>
      <td>7.796997</td>
      <td>8.077759</td>
      <td>8.151402</td>
      <td>8.366045</td>
      <td>8.17859</td>
      <td>8.2</td>
      <td>8.6</td>
      <td>8.8</td>
      <td>8.9</td>
      <td>9.5</td>
      <td>10.0</td>
      <td>10.1</td>
      <td>10.5</td>
      <td>10.8</td>
      <td>10.9</td>
      <td>11</td>
      <td>11.2</td>
      <td>10.8</td>
      <td>12.1</td>
      <td>13.1</td>
      <td>13.9</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Illinois</td>
      <td>5.162794</td>
      <td>5.478499</td>
      <td>5.982023</td>
      <td>5.800000</td>
      <td>5.880873</td>
      <td>6.169054</td>
      <td>5.394059</td>
      <td>5.8</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>5.9</td>
      <td>6.2</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>7.2</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>8.8</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Indiana</td>
      <td>6.176270</td>
      <td>6.554662</td>
      <td>6.854694</td>
      <td>6.935419</td>
      <td>6.856525</td>
      <td>7.08004</td>
      <td>6.607464</td>
      <td>6.7</td>
      <td>6.8</td>
      <td>6.3</td>
      <td>7.9</td>
      <td>8.0</td>
      <td>7.0</td>
      <td>7</td>
      <td>6.9</td>
      <td>7.8</td>
      <td>7.1</td>
      <td>7.9</td>
      <td>7.9</td>
      <td>7.9</td>
      <td>8.1</td>
      <td>8.6</td>
      <td>9.6</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Iowa</td>
      <td>5.403684</td>
      <td>5.737696</td>
      <td>6.176028</td>
      <td>6.149566</td>
      <td>6.255004</td>
      <td>6.863899</td>
      <td>7.390914</td>
      <td>6.8</td>
      <td>6.7</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7</td>
      <td>7.1</td>
      <td>6.9</td>
      <td>7.9</td>
      <td>7.7</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Kansas</td>
      <td>5.341683</td>
      <td>5.366984</td>
      <td>5.970225</td>
      <td>6.210941</td>
      <td>5.936515</td>
      <td>6.101884</td>
      <td>5.98454</td>
      <td>6.3</td>
      <td>6.3</td>
      <td>6.4</td>
      <td>6.4</td>
      <td>6.7</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>7.3</td>
      <td>7.5</td>
      <td>8.3</td>
      <td>7.1</td>
      <td>8.5</td>
      <td>9.2</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Kentucky</td>
      <td>6.265454</td>
      <td>6.774234</td>
      <td>7.174146</td>
      <td>7.379354</td>
      <td>7.172506</td>
      <td>6.941724</td>
      <td>7.278692</td>
      <td>7.2</td>
      <td>7.5</td>
      <td>7.4</td>
      <td>7.6</td>
      <td>7.9</td>
      <td>7.8</td>
      <td>8.4</td>
      <td>8.7</td>
      <td>8.8</td>
      <td>9.1</td>
      <td>9</td>
      <td>9</td>
      <td>9.8</td>
      <td>10.9</td>
      <td>12.2</td>
      <td>13.5</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Louisiana</td>
      <td>5.094870</td>
      <td>5.118908</td>
      <td>5.592472</td>
      <td>6.106373</td>
      <td>6.777108</td>
      <td>6.892953</td>
      <td>6.370812</td>
      <td>5.7</td>
      <td>6.4</td>
      <td>6.9</td>
      <td>7.1</td>
      <td>6.8</td>
      <td>7.5</td>
      <td>---</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.2</td>
      <td>8.1</td>
      <td>8.4</td>
      <td>9.1</td>
      <td>9.1</td>
      <td>9.3</td>
      <td>9.6</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Maine</td>
      <td>7.053203</td>
      <td>7.390145</td>
      <td>7.585857</td>
      <td>7.640376</td>
      <td>7.610612</td>
      <td>7.745346</td>
      <td>8.31061</td>
      <td>7.3</td>
      <td>7.2</td>
      <td>7.1</td>
      <td>7.1</td>
      <td>7.4</td>
      <td>7.4</td>
      <td>7.8</td>
      <td>8.2</td>
      <td>8.6</td>
      <td>8.4</td>
      <td>8.4</td>
      <td>8.6</td>
      <td>8.8</td>
      <td>8.6</td>
      <td>8.7</td>
      <td>9.7</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Maryland</td>
      <td>5.592919</td>
      <td>5.867393</td>
      <td>6.268158</td>
      <td>6.308374</td>
      <td>6.187233</td>
      <td>6.461575</td>
      <td>6.823793</td>
      <td>5.6</td>
      <td>5.8</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>5.9</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.1</td>
      <td>7</td>
      <td>7.5</td>
      <td>7.5</td>
      <td>8.4</td>
      <td>9.7</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Massachusetts</td>
      <td>5.019222</td>
      <td>6.269931</td>
      <td>5.749423</td>
      <td>5.777052</td>
      <td>5.497009</td>
      <td>5.60485</td>
      <td>5.501415</td>
      <td>5.5</td>
      <td>5.5</td>
      <td>5.6</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>5.9</td>
      <td>6.2</td>
      <td>6.5</td>
      <td>5.6</td>
      <td>5.9</td>
      <td>6.2</td>
      <td>5.8</td>
      <td>6.2</td>
      <td>7.1</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Michigan</td>
      <td>5.183913</td>
      <td>5.678220</td>
      <td>5.887088</td>
      <td>5.935155</td>
      <td>5.984938</td>
      <td>5.759103</td>
      <td>5.812267</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.5</td>
      <td>5.4</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>6.3</td>
      <td>6.5</td>
      <td>6.7</td>
      <td>6.7</td>
      <td>6.8</td>
      <td>7.3</td>
      <td>8.2</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Minnesota</td>
      <td>5.074090</td>
      <td>5.304589</td>
      <td>5.611836</td>
      <td>5.617984</td>
      <td>5.578555</td>
      <td>5.895727</td>
      <td>5.998288</td>
      <td>5.6</td>
      <td>5.6</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.4</td>
      <td>5.8</td>
      <td>6</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>6.3</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>7.0</td>
      <td>7.7</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Mississippi</td>
      <td>6.018516</td>
      <td>6.282877</td>
      <td>6.720619</td>
      <td>7.013691</td>
      <td>6.993874</td>
      <td>6.930345</td>
      <td>6.715684</td>
      <td>5.8</td>
      <td>4.9</td>
      <td>4.9</td>
      <td>4.8</td>
      <td>5.1</td>
      <td>5.4</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.9</td>
      <td>7.8</td>
      <td>7.9</td>
      <td>9.4</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Missouri</td>
      <td>5.969276</td>
      <td>6.478791</td>
      <td>6.594551</td>
      <td>6.851633</td>
      <td>6.800000</td>
      <td>6.725225</td>
      <td>6.449851</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.8</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>7.1</td>
      <td>7.2</td>
      <td>7.3</td>
      <td>7.5</td>
      <td>7.8</td>
      <td>8.1</td>
      <td>8.3</td>
      <td>9.6</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Montana</td>
      <td>7.886577</td>
      <td>7.713416</td>
      <td>7.963880</td>
      <td>7.840617</td>
      <td>7.962639</td>
      <td>7.857723</td>
      <td>7.398797</td>
      <td>7.8</td>
      <td>7.8</td>
      <td>7.4</td>
      <td>7.3</td>
      <td>7.6</td>
      <td>7.5</td>
      <td>7.4</td>
      <td>7.4</td>
      <td>7.5</td>
      <td>7.2</td>
      <td>7.1</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>7.4</td>
      <td>7.6</td>
      <td>8.6</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Nebraska</td>
      <td>5.498323</td>
      <td>5.976878</td>
      <td>6.313813</td>
      <td>6.465784</td>
      <td>6.378053</td>
      <td>6.415084</td>
      <td>6.294835</td>
      <td>6.7</td>
      <td>6.6</td>
      <td>6.6</td>
      <td>6.6</td>
      <td>6.9</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>7.0</td>
      <td>7.1</td>
      <td>7</td>
      <td>7.5</td>
      <td>7.9</td>
      <td>7.6</td>
      <td>7.5</td>
      <td>7.3</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Nevada</td>
      <td>25.894792</td>
      <td>26.734186</td>
      <td>28.556333</td>
      <td>28.392297</td>
      <td>31.017920</td>
      <td>31.85095</td>
      <td>32.280147</td>
      <td>35.1</td>
      <td>36.9</td>
      <td>38.3</td>
      <td>40.3</td>
      <td>42.3</td>
      <td>48.6</td>
      <td>52.1</td>
      <td>57.4</td>
      <td>62.1</td>
      <td>63.9</td>
      <td>67.4</td>
      <td>69.6</td>
      <td>72.2</td>
      <td>82.3</td>
      <td>85.2</td>
      <td>99.0</td>
    </tr>
    <tr>
      <th>30</th>
      <td>New Hampshire</td>
      <td>6.637440</td>
      <td>6.932762</td>
      <td>7.030857</td>
      <td>6.977101</td>
      <td>6.938182</td>
      <td>7.187147</td>
      <td>6.901612</td>
      <td>6.8</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>6.5</td>
      <td>6.8</td>
      <td>7.1</td>
      <td>7.2</td>
      <td>7.3</td>
      <td>8.0</td>
      <td>8.1</td>
      <td>8.3</td>
      <td>8.5</td>
      <td>9.4</td>
      <td>7.9</td>
      <td>8.3</td>
      <td>9.5</td>
    </tr>
    <tr>
      <th>31</th>
      <td>New Jersey</td>
      <td>5.187009</td>
      <td>5.367783</td>
      <td>5.450804</td>
      <td>5.654780</td>
      <td>5.606042</td>
      <td>5.403116</td>
      <td>5.130831</td>
      <td>4.9</td>
      <td>4.8</td>
      <td>5.1</td>
      <td>5.0</td>
      <td>5.4</td>
      <td>5.4</td>
      <td>5.5</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>5.8</td>
      <td>6</td>
      <td>6.4</td>
      <td>6</td>
      <td>5.9</td>
      <td>6.5</td>
      <td>7.6</td>
    </tr>
    <tr>
      <th>32</th>
      <td>New Mexico</td>
      <td>5.981413</td>
      <td>6.449279</td>
      <td>5.925568</td>
      <td>6.366124</td>
      <td>6.171860</td>
      <td>8.080277</td>
      <td>7.255596</td>
      <td>6.9</td>
      <td>8.0</td>
      <td>7.7</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.6</td>
      <td>6.8</td>
      <td>6.6</td>
      <td>7.4</td>
      <td>6.9</td>
      <td>7.9</td>
      <td>7.6</td>
      <td>8</td>
      <td>8.0</td>
      <td>8.8</td>
      <td>8.8</td>
    </tr>
    <tr>
      <th>33</th>
      <td>New York</td>
      <td>7.217085</td>
      <td>7.106515</td>
      <td>7.344656</td>
      <td>7.451752</td>
      <td>7.056096</td>
      <td>6.689784</td>
      <td>6.890139</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.8</td>
      <td>6.9</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>7.3</td>
      <td>7.6</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>8.0</td>
      <td>8.6</td>
    </tr>
    <tr>
      <th>34</th>
      <td>North Carolina</td>
      <td>6.181491</td>
      <td>6.433883</td>
      <td>6.846406</td>
      <td>6.967624</td>
      <td>6.959910</td>
      <td>6.892221</td>
      <td>6.510013</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.6</td>
      <td>6.6</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.4</td>
      <td>7.7</td>
      <td>7.4</td>
      <td>8.2</td>
      <td>8.5</td>
      <td>8.4</td>
      <td>7.8</td>
    </tr>
    <tr>
      <th>35</th>
      <td>North Dakota</td>
      <td>5.423443</td>
      <td>5.682319</td>
      <td>5.761240</td>
      <td>5.955522</td>
      <td>6.172326</td>
      <td>6.300356</td>
      <td>6.340952</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.5</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.8</td>
      <td>6.9</td>
      <td>7.1</td>
      <td>6.8</td>
      <td>6.5</td>
      <td>7.2</td>
      <td>6.6</td>
      <td>7.1</td>
      <td>7.5</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Ohio</td>
      <td>5.329324</td>
      <td>5.617035</td>
      <td>5.821192</td>
      <td>5.956154</td>
      <td>5.905580</td>
      <td>5.751515</td>
      <td>5.708936</td>
      <td>5.8</td>
      <td>5.9</td>
      <td>5.8</td>
      <td>5.8</td>
      <td>6.0</td>
      <td>6.1</td>
      <td>6.3</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>7</td>
      <td>7.2</td>
      <td>7.8</td>
      <td>7.8</td>
      <td>8.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Oklahoma</td>
      <td>6.336918</td>
      <td>6.371924</td>
      <td>6.815296</td>
      <td>6.678882</td>
      <td>7.418945</td>
      <td>7.075203</td>
      <td>7.083371</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.2</td>
      <td>6.9</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>6.5</td>
      <td>---</td>
      <td>---</td>
      <td>---</td>
      <td>---</td>
      <td>6.8</td>
      <td>8.6</td>
      <td>10.6</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Oregon</td>
      <td>5.991839</td>
      <td>6.322075</td>
      <td>6.660993</td>
      <td>6.859226</td>
      <td>6.887356</td>
      <td>6.834097</td>
      <td>6.334755</td>
      <td>6.6</td>
      <td>6.6</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.9</td>
      <td>7.2</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>8.1</td>
      <td>7.2</td>
      <td>7.1</td>
      <td>7.5</td>
      <td>7.6</td>
      <td>7.6</td>
      <td>8.1</td>
      <td>8.9</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Pennsylvania</td>
      <td>5.351512</td>
      <td>5.545691</td>
      <td>5.724399</td>
      <td>5.778683</td>
      <td>5.684592</td>
      <td>5.84287</td>
      <td>5.432291</td>
      <td>5.5</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.5</td>
      <td>5.7</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>5.9</td>
      <td>5.9</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>6</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>7.1</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Rhode Island</td>
      <td>6.149934</td>
      <td>6.297083</td>
      <td>6.767399</td>
      <td>6.710361</td>
      <td>6.353321</td>
      <td>6.669996</td>
      <td>6.212964</td>
      <td>6.1</td>
      <td>6.0</td>
      <td>5.8</td>
      <td>5.9</td>
      <td>6.1</td>
      <td>6.4</td>
      <td>6.6</td>
      <td>7.0</td>
      <td>7.7</td>
      <td>7.8</td>
      <td>7.8</td>
      <td>8.1</td>
      <td>7.6</td>
      <td>7.5</td>
      <td>7.3</td>
      <td>8.1</td>
    </tr>
    <tr>
      <th>41</th>
      <td>South Carolina</td>
      <td>6.288172</td>
      <td>6.585398</td>
      <td>7.034316</td>
      <td>6.632979</td>
      <td>7.498347</td>
      <td>7.624033</td>
      <td>7.142021</td>
      <td>7.4</td>
      <td>7.2</td>
      <td>7.4</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.9</td>
      <td>7.8</td>
      <td>8.3</td>
      <td>8.2</td>
      <td>9</td>
      <td>9.3</td>
      <td>9.9</td>
      <td>10.6</td>
      <td>10.2</td>
      <td>11.9</td>
      <td>15.9</td>
    </tr>
    <tr>
      <th>42</th>
      <td>South Dakota</td>
      <td>6.144741</td>
      <td>6.535674</td>
      <td>6.742819</td>
      <td>7.247063</td>
      <td>7.214005</td>
      <td>7.073578</td>
      <td>7.005754</td>
      <td>7.5</td>
      <td>7.5</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.7</td>
      <td>7.8</td>
      <td>8</td>
      <td>8.4</td>
      <td>8.4</td>
      <td>8.4</td>
      <td>8.8</td>
      <td>8.9</td>
      <td>9.4</td>
      <td>9.1</td>
      <td>9.9</td>
      <td>11.1</td>
    </tr>
    <tr>
      <th>43</th>
      <td>Tennessee</td>
      <td>7.488753</td>
      <td>7.951096</td>
      <td>8.234385</td>
      <td>8.614092</td>
      <td>8.502342</td>
      <td>8.409229</td>
      <td>8.447843</td>
      <td>8.8</td>
      <td>9.0</td>
      <td>8.8</td>
      <td>8.4</td>
      <td>9.4</td>
      <td>10.1</td>
      <td>10.6</td>
      <td>10.9</td>
      <td>11.4</td>
      <td>11.9</td>
      <td>13.1</td>
      <td>13.5</td>
      <td>15.5</td>
      <td>14.7</td>
      <td>15.5</td>
      <td>13.9</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Texas</td>
      <td>4.867898</td>
      <td>6.121488</td>
      <td>7.096127</td>
      <td>7.077625</td>
      <td>7.214466</td>
      <td>6.851589</td>
      <td>6.976356</td>
      <td>7.3</td>
      <td>7.1</td>
      <td>7.1</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>7.4</td>
      <td>7.6</td>
      <td>7.8</td>
      <td>8.0</td>
      <td>8.1</td>
      <td>8.4</td>
      <td>9.1</td>
      <td>9.4</td>
      <td>9.1</td>
      <td>9.9</td>
      <td>10.5</td>
    </tr>
    <tr>
      <th>45</th>
      <td>Utah</td>
      <td>8.058122</td>
      <td>8.355306</td>
      <td>8.720650</td>
      <td>8.990183</td>
      <td>8.075986</td>
      <td>7.317947</td>
      <td>7.503606</td>
      <td>8.4</td>
      <td>8.6</td>
      <td>8.5</td>
      <td>8.4</td>
      <td>9.0</td>
      <td>9.6</td>
      <td>9.2</td>
      <td>9.8</td>
      <td>9.9</td>
      <td>10.2</td>
      <td>10.4</td>
      <td>10.2</td>
      <td>10.8</td>
      <td>9.6</td>
      <td>10.7</td>
      <td>11.2</td>
    </tr>
    <tr>
      <th>46</th>
      <td>Vermont</td>
      <td>7.726098</td>
      <td>7.943490</td>
      <td>7.908193</td>
      <td>8.299792</td>
      <td>8.124056</td>
      <td>8.698261</td>
      <td>9.155323</td>
      <td>8.2</td>
      <td>8.3</td>
      <td>9.3</td>
      <td>8.7</td>
      <td>7.9</td>
      <td>8.5</td>
      <td>8.6</td>
      <td>8.9</td>
      <td>9.4</td>
      <td>9.7</td>
      <td>9.8</td>
      <td>9.8</td>
      <td>10</td>
      <td>10.0</td>
      <td>10.3</td>
      <td>10.9</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Virginia</td>
      <td>6.128508</td>
      <td>6.398452</td>
      <td>6.783573</td>
      <td>6.988628</td>
      <td>6.980323</td>
      <td>6.744421</td>
      <td>6.657785</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>6.9</td>
      <td>7.2</td>
      <td>7.5</td>
      <td>7.8</td>
      <td>8.2</td>
      <td>8.3</td>
      <td>8.4</td>
      <td>8.6</td>
      <td>8.8</td>
      <td>8.8</td>
      <td>9.2</td>
      <td>10.2</td>
      <td>11.4</td>
    </tr>
    <tr>
      <th>48</th>
      <td>Washington</td>
      <td>5.749260</td>
      <td>6.023947</td>
      <td>6.246909</td>
      <td>6.235593</td>
      <td>6.219361</td>
      <td>6.956141</td>
      <td>7.11033</td>
      <td>6.3</td>
      <td>6.1</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>6.3</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>7</td>
      <td>6.9</td>
      <td>7.2</td>
      <td>7.7</td>
      <td>9.5</td>
    </tr>
    <tr>
      <th>49</th>
      <td>West Virginia</td>
      <td>5.978862</td>
      <td>6.067010</td>
      <td>6.311620</td>
      <td>6.354097</td>
      <td>6.574923</td>
      <td>6.669095</td>
      <td>6.644002</td>
      <td>7.0</td>
      <td>7.2</td>
      <td>6.7</td>
      <td>6.7</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.4</td>
      <td>7.5</td>
      <td>7.5</td>
      <td>8.1</td>
      <td>7.9</td>
      <td>8.7</td>
      <td>7.5</td>
      <td>6.1</td>
      <td>7.2</td>
    </tr>
    <tr>
      <th>50</th>
      <td>Wisconsin</td>
      <td>5.037240</td>
      <td>5.430056</td>
      <td>5.634561</td>
      <td>5.616134</td>
      <td>5.611351</td>
      <td>5.691296</td>
      <td>5.219136</td>
      <td>5.4</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>6</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>6.2</td>
      <td>6.3</td>
      <td>6.5</td>
      <td>6.7</td>
      <td>6.7</td>
      <td>7.0</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Wyoming</td>
      <td>7.008098</td>
      <td>7.051652</td>
      <td>7.125657</td>
      <td>7.079407</td>
      <td>7.341663</td>
      <td>7.658952</td>
      <td>7.549883</td>
      <td>7.6</td>
      <td>7.8</td>
      <td>7.6</td>
      <td>8.0</td>
      <td>8.6</td>
      <td>9.0</td>
      <td>9.3</td>
      <td>9.3</td>
      <td>9.3</td>
      <td>9.3</td>
      <td>9.5</td>
      <td>10</td>
      <td>10</td>
      <td>9.9</td>
      <td>10.6</td>
      <td>10.7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># replace --- with nan</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;---&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">})</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>2019</th>
      <th>2018</th>
      <th>2017</th>
      <th>2016</th>
      <th>2015</th>
      <th>2014</th>
      <th>2013</th>
      <th>2012</th>
      <th>2011</th>
      <th>2010</th>
      <th>2009</th>
      <th>2008</th>
      <th>2007</th>
      <th>2006</th>
      <th>2005</th>
      <th>2004</th>
      <th>2003</th>
      <th>2002</th>
      <th>2001</th>
      <th>2000</th>
      <th>1999</th>
      <th>1995</th>
      <th>1990</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>6.697687</td>
      <td>6.760408</td>
      <td>7.047340</td>
      <td>7.147821</td>
      <td>7.351544</td>
      <td>7.806776</td>
      <td>7.817785</td>
      <td>8.2</td>
      <td>8.4</td>
      <td>8.2</td>
      <td>8.3</td>
      <td>8.6</td>
      <td>8.9</td>
      <td>9.2</td>
      <td>9.2</td>
      <td>9.4</td>
      <td>9.6</td>
      <td>9.9</td>
      <td>9.4</td>
      <td>10.1</td>
      <td>10.8</td>
      <td>9.8</td>
      <td>10.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alaska</td>
      <td>6.512245</td>
      <td>6.683952</td>
      <td>6.914078</td>
      <td>7.103441</td>
      <td>7.407588</td>
      <td>7.508836</td>
      <td>7.293928</td>
      <td>7.2</td>
      <td>7.8</td>
      <td>8.0</td>
      <td>7.8</td>
      <td>8.4</td>
      <td>8.5</td>
      <td>8.2</td>
      <td>8.2</td>
      <td>8.5</td>
      <td>8.1</td>
      <td>8.3</td>
      <td>8.1</td>
      <td>8.9</td>
      <td>8.6</td>
      <td>9.0</td>
      <td>10.2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arizona</td>
      <td>5.302995</td>
      <td>5.534434</td>
      <td>5.834867</td>
      <td>5.930541</td>
      <td>5.922469</td>
      <td>5.780449</td>
      <td>5.401091</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>5.6</td>
      <td>6.0</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.5</td>
      <td>6.7</td>
      <td>7.6</td>
      <td>7.5</td>
      <td>8.2</td>
      <td>8.8</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arkansas</td>
      <td>8.377284</td>
      <td>8.863156</td>
      <td>9.456845</td>
      <td>9.860962</td>
      <td>10.040279</td>
      <td>10.112026</td>
      <td>9.751052</td>
      <td>10.9</td>
      <td>10.4</td>
      <td>10.8</td>
      <td>10.7</td>
      <td>10.6</td>
      <td>12.0</td>
      <td>12.4</td>
      <td>12.9</td>
      <td>13.4</td>
      <td>13.4</td>
      <td>14.3</td>
      <td>14.3</td>
      <td>15.4</td>
      <td>14.8</td>
      <td>14.4</td>
      <td>15.3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>California 1</td>
      <td>5.723191</td>
      <td>6.035132</td>
      <td>6.278250</td>
      <td>6.463590</td>
      <td>6.184957</td>
      <td>6.441492</td>
      <td>6.460467</td>
      <td>6.0</td>
      <td>5.8</td>
      <td>5.8</td>
      <td>5.8</td>
      <td>6.7</td>
      <td>6.2</td>
      <td>6.3</td>
      <td>6.4</td>
      <td>6.4</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>6.5</td>
      <td>5.8</td>
      <td>6.4</td>
      <td>6.3</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Colorado</td>
      <td>7.273297</td>
      <td>7.585728</td>
      <td>7.333845</td>
      <td>7.425443</td>
      <td>6.791807</td>
      <td>7.061603</td>
      <td>6.452664</td>
      <td>6.8</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.4</td>
      <td>7.1</td>
      <td>7.2</td>
      <td>7.6</td>
      <td>7.4</td>
      <td>7.8</td>
      <td>8.0</td>
      <td>8.2</td>
      <td>8.3</td>
      <td>8.2</td>
      <td>9.0</td>
      <td>9.8</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Connecticut</td>
      <td>5.048401</td>
      <td>5.278133</td>
      <td>5.553784</td>
      <td>5.617858</td>
      <td>5.292009</td>
      <td>5.368845</td>
      <td>5.021023</td>
      <td>5.2</td>
      <td>5.5</td>
      <td>5.6</td>
      <td>5.9</td>
      <td>5.4</td>
      <td>5.5</td>
      <td>5.5</td>
      <td>5.8</td>
      <td>5.8</td>
      <td>5.5</td>
      <td>5.7</td>
      <td>5.4</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>6.6</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Delaware</td>
      <td>4.951919</td>
      <td>5.237957</td>
      <td>5.528417</td>
      <td>5.613062</td>
      <td>5.712872</td>
      <td>6.022783</td>
      <td>6.571976</td>
      <td>5.8</td>
      <td>5.2</td>
      <td>5.2</td>
      <td>5.4</td>
      <td>5.5</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>5.9</td>
      <td>6.1</td>
      <td>6.0</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.7</td>
      <td>7.3</td>
      <td>8.4</td>
    </tr>
    <tr>
      <th>9</th>
      <td>District of Columbia</td>
      <td>7.773302</td>
      <td>7.835377</td>
      <td>8.239526</td>
      <td>8.149214</td>
      <td>8.220425</td>
      <td>11.821343</td>
      <td>10.791261</td>
      <td>8.4</td>
      <td>8.7</td>
      <td>7.6</td>
      <td>4.7</td>
      <td>4.1</td>
      <td>4.2</td>
      <td>4.0</td>
      <td>4.1</td>
      <td>5.2</td>
      <td>5.1</td>
      <td>5.1</td>
      <td>6.2</td>
      <td>4.9</td>
      <td>6.6</td>
      <td>6.1</td>
      <td>8.2</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Florida</td>
      <td>7.070065</td>
      <td>7.332063</td>
      <td>7.806895</td>
      <td>8.125967</td>
      <td>8.234362</td>
      <td>7.301404</td>
      <td>7.009614</td>
      <td>7.2</td>
      <td>7.4</td>
      <td>7.3</td>
      <td>7.5</td>
      <td>8.0</td>
      <td>8.5</td>
      <td>8.6</td>
      <td>8.9</td>
      <td>9.0</td>
      <td>9.0</td>
      <td>9.4</td>
      <td>9.3</td>
      <td>8.9</td>
      <td>8.7</td>
      <td>9.9</td>
      <td>10.9</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Georgia</td>
      <td>6.038471</td>
      <td>6.391479</td>
      <td>6.870975</td>
      <td>6.753976</td>
      <td>6.200379</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>7.3</td>
      <td>6.6</td>
      <td>6.0</td>
      <td>6.8</td>
      <td>7.3</td>
      <td>7.0</td>
      <td>7.9</td>
      <td>7.0</td>
      <td>6.5</td>
      <td>6.1</td>
      <td>6.8</td>
      <td>7.8</td>
      <td>8.4</td>
      <td>10.3</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Hawaii</td>
      <td>14.172891</td>
      <td>15.263736</td>
      <td>15.346702</td>
      <td>15.555557</td>
      <td>15.940173</td>
      <td>17.702656</td>
      <td>16.294245</td>
      <td>17.5</td>
      <td>17.6</td>
      <td>17.6</td>
      <td>17.2</td>
      <td>19.1</td>
      <td>20.8</td>
      <td>21.9</td>
      <td>22.6</td>
      <td>22.6</td>
      <td>22.0</td>
      <td>20.8</td>
      <td>19.6</td>
      <td>20.6</td>
      <td>18.9</td>
      <td>15.7</td>
      <td>16.4</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Idaho</td>
      <td>7.389770</td>
      <td>7.810362</td>
      <td>7.796997</td>
      <td>8.077759</td>
      <td>8.151402</td>
      <td>8.366045</td>
      <td>8.178590</td>
      <td>8.2</td>
      <td>8.6</td>
      <td>8.8</td>
      <td>8.9</td>
      <td>9.5</td>
      <td>10.0</td>
      <td>10.1</td>
      <td>10.5</td>
      <td>10.8</td>
      <td>10.9</td>
      <td>11.0</td>
      <td>11.2</td>
      <td>10.8</td>
      <td>12.1</td>
      <td>13.1</td>
      <td>13.9</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Illinois</td>
      <td>5.162794</td>
      <td>5.478499</td>
      <td>5.982023</td>
      <td>5.800000</td>
      <td>5.880873</td>
      <td>6.169054</td>
      <td>5.394059</td>
      <td>5.8</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>5.9</td>
      <td>6.2</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>7.2</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>8.8</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Indiana</td>
      <td>6.176270</td>
      <td>6.554662</td>
      <td>6.854694</td>
      <td>6.935419</td>
      <td>6.856525</td>
      <td>7.080040</td>
      <td>6.607464</td>
      <td>6.7</td>
      <td>6.8</td>
      <td>6.3</td>
      <td>7.9</td>
      <td>8.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>7.8</td>
      <td>7.1</td>
      <td>7.9</td>
      <td>7.9</td>
      <td>7.9</td>
      <td>8.1</td>
      <td>8.6</td>
      <td>9.6</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Iowa</td>
      <td>5.403684</td>
      <td>5.737696</td>
      <td>6.176028</td>
      <td>6.149566</td>
      <td>6.255004</td>
      <td>6.863899</td>
      <td>7.390914</td>
      <td>6.8</td>
      <td>6.7</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>7.1</td>
      <td>6.9</td>
      <td>7.9</td>
      <td>7.7</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Kansas</td>
      <td>5.341683</td>
      <td>5.366984</td>
      <td>5.970225</td>
      <td>6.210941</td>
      <td>5.936515</td>
      <td>6.101884</td>
      <td>5.984540</td>
      <td>6.3</td>
      <td>6.3</td>
      <td>6.4</td>
      <td>6.4</td>
      <td>6.7</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>7.3</td>
      <td>7.5</td>
      <td>8.3</td>
      <td>7.1</td>
      <td>8.5</td>
      <td>9.2</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Kentucky</td>
      <td>6.265454</td>
      <td>6.774234</td>
      <td>7.174146</td>
      <td>7.379354</td>
      <td>7.172506</td>
      <td>6.941724</td>
      <td>7.278692</td>
      <td>7.2</td>
      <td>7.5</td>
      <td>7.4</td>
      <td>7.6</td>
      <td>7.9</td>
      <td>7.8</td>
      <td>8.4</td>
      <td>8.7</td>
      <td>8.8</td>
      <td>9.1</td>
      <td>9.0</td>
      <td>9.0</td>
      <td>9.8</td>
      <td>10.9</td>
      <td>12.2</td>
      <td>13.5</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Louisiana</td>
      <td>5.094870</td>
      <td>5.118908</td>
      <td>5.592472</td>
      <td>6.106373</td>
      <td>6.777108</td>
      <td>6.892953</td>
      <td>6.370812</td>
      <td>5.7</td>
      <td>6.4</td>
      <td>6.9</td>
      <td>7.1</td>
      <td>6.8</td>
      <td>7.5</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.2</td>
      <td>8.1</td>
      <td>8.4</td>
      <td>9.1</td>
      <td>9.1</td>
      <td>9.3</td>
      <td>9.6</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Maine</td>
      <td>7.053203</td>
      <td>7.390145</td>
      <td>7.585857</td>
      <td>7.640376</td>
      <td>7.610612</td>
      <td>7.745346</td>
      <td>8.310610</td>
      <td>7.3</td>
      <td>7.2</td>
      <td>7.1</td>
      <td>7.1</td>
      <td>7.4</td>
      <td>7.4</td>
      <td>7.8</td>
      <td>8.2</td>
      <td>8.6</td>
      <td>8.4</td>
      <td>8.4</td>
      <td>8.6</td>
      <td>8.8</td>
      <td>8.6</td>
      <td>8.7</td>
      <td>9.7</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Maryland</td>
      <td>5.592919</td>
      <td>5.867393</td>
      <td>6.268158</td>
      <td>6.308374</td>
      <td>6.187233</td>
      <td>6.461575</td>
      <td>6.823793</td>
      <td>5.6</td>
      <td>5.8</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>5.9</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.1</td>
      <td>7.0</td>
      <td>7.5</td>
      <td>7.5</td>
      <td>8.4</td>
      <td>9.7</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Massachusetts</td>
      <td>5.019222</td>
      <td>6.269931</td>
      <td>5.749423</td>
      <td>5.777052</td>
      <td>5.497009</td>
      <td>5.604850</td>
      <td>5.501415</td>
      <td>5.5</td>
      <td>5.5</td>
      <td>5.6</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>5.9</td>
      <td>6.2</td>
      <td>6.5</td>
      <td>5.6</td>
      <td>5.9</td>
      <td>6.2</td>
      <td>5.8</td>
      <td>6.2</td>
      <td>7.1</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Michigan</td>
      <td>5.183913</td>
      <td>5.678220</td>
      <td>5.887088</td>
      <td>5.935155</td>
      <td>5.984938</td>
      <td>5.759103</td>
      <td>5.812267</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.5</td>
      <td>5.4</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>6.3</td>
      <td>6.5</td>
      <td>6.7</td>
      <td>6.7</td>
      <td>6.8</td>
      <td>7.3</td>
      <td>8.2</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Minnesota</td>
      <td>5.074090</td>
      <td>5.304589</td>
      <td>5.611836</td>
      <td>5.617984</td>
      <td>5.578555</td>
      <td>5.895727</td>
      <td>5.998288</td>
      <td>5.6</td>
      <td>5.6</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.4</td>
      <td>5.8</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>6.3</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>7.0</td>
      <td>7.7</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Mississippi</td>
      <td>6.018516</td>
      <td>6.282877</td>
      <td>6.720619</td>
      <td>7.013691</td>
      <td>6.993874</td>
      <td>6.930345</td>
      <td>6.715684</td>
      <td>5.8</td>
      <td>4.9</td>
      <td>4.9</td>
      <td>4.8</td>
      <td>5.1</td>
      <td>5.4</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.9</td>
      <td>7.8</td>
      <td>7.9</td>
      <td>9.4</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Missouri</td>
      <td>5.969276</td>
      <td>6.478791</td>
      <td>6.594551</td>
      <td>6.851633</td>
      <td>6.800000</td>
      <td>6.725225</td>
      <td>6.449851</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.8</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>7.1</td>
      <td>7.2</td>
      <td>7.3</td>
      <td>7.5</td>
      <td>7.8</td>
      <td>8.1</td>
      <td>8.3</td>
      <td>9.6</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Montana</td>
      <td>7.886577</td>
      <td>7.713416</td>
      <td>7.963880</td>
      <td>7.840617</td>
      <td>7.962639</td>
      <td>7.857723</td>
      <td>7.398797</td>
      <td>7.8</td>
      <td>7.8</td>
      <td>7.4</td>
      <td>7.3</td>
      <td>7.6</td>
      <td>7.5</td>
      <td>7.4</td>
      <td>7.4</td>
      <td>7.5</td>
      <td>7.2</td>
      <td>7.1</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>7.4</td>
      <td>7.6</td>
      <td>8.6</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Nebraska</td>
      <td>5.498323</td>
      <td>5.976878</td>
      <td>6.313813</td>
      <td>6.465784</td>
      <td>6.378053</td>
      <td>6.415084</td>
      <td>6.294835</td>
      <td>6.7</td>
      <td>6.6</td>
      <td>6.6</td>
      <td>6.6</td>
      <td>6.9</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>7.0</td>
      <td>7.1</td>
      <td>7.0</td>
      <td>7.5</td>
      <td>7.9</td>
      <td>7.6</td>
      <td>7.5</td>
      <td>7.3</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Nevada</td>
      <td>25.894792</td>
      <td>26.734186</td>
      <td>28.556333</td>
      <td>28.392297</td>
      <td>31.017920</td>
      <td>31.850950</td>
      <td>32.280147</td>
      <td>35.1</td>
      <td>36.9</td>
      <td>38.3</td>
      <td>40.3</td>
      <td>42.3</td>
      <td>48.6</td>
      <td>52.1</td>
      <td>57.4</td>
      <td>62.1</td>
      <td>63.9</td>
      <td>67.4</td>
      <td>69.6</td>
      <td>72.2</td>
      <td>82.3</td>
      <td>85.2</td>
      <td>99.0</td>
    </tr>
    <tr>
      <th>30</th>
      <td>New Hampshire</td>
      <td>6.637440</td>
      <td>6.932762</td>
      <td>7.030857</td>
      <td>6.977101</td>
      <td>6.938182</td>
      <td>7.187147</td>
      <td>6.901612</td>
      <td>6.8</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>6.5</td>
      <td>6.8</td>
      <td>7.1</td>
      <td>7.2</td>
      <td>7.3</td>
      <td>8.0</td>
      <td>8.1</td>
      <td>8.3</td>
      <td>8.5</td>
      <td>9.4</td>
      <td>7.9</td>
      <td>8.3</td>
      <td>9.5</td>
    </tr>
    <tr>
      <th>31</th>
      <td>New Jersey</td>
      <td>5.187009</td>
      <td>5.367783</td>
      <td>5.450804</td>
      <td>5.654780</td>
      <td>5.606042</td>
      <td>5.403116</td>
      <td>5.130831</td>
      <td>4.9</td>
      <td>4.8</td>
      <td>5.1</td>
      <td>5.0</td>
      <td>5.4</td>
      <td>5.4</td>
      <td>5.5</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>5.8</td>
      <td>6.0</td>
      <td>6.4</td>
      <td>6.0</td>
      <td>5.9</td>
      <td>6.5</td>
      <td>7.6</td>
    </tr>
    <tr>
      <th>32</th>
      <td>New Mexico</td>
      <td>5.981413</td>
      <td>6.449279</td>
      <td>5.925568</td>
      <td>6.366124</td>
      <td>6.171860</td>
      <td>8.080277</td>
      <td>7.255596</td>
      <td>6.9</td>
      <td>8.0</td>
      <td>7.7</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.6</td>
      <td>6.8</td>
      <td>6.6</td>
      <td>7.4</td>
      <td>6.9</td>
      <td>7.9</td>
      <td>7.6</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.8</td>
      <td>8.8</td>
    </tr>
    <tr>
      <th>33</th>
      <td>New York</td>
      <td>7.217085</td>
      <td>7.106515</td>
      <td>7.344656</td>
      <td>7.451752</td>
      <td>7.056096</td>
      <td>6.689784</td>
      <td>6.890139</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.8</td>
      <td>6.9</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>7.3</td>
      <td>7.6</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>8.0</td>
      <td>8.6</td>
    </tr>
    <tr>
      <th>34</th>
      <td>North Carolina</td>
      <td>6.181491</td>
      <td>6.433883</td>
      <td>6.846406</td>
      <td>6.967624</td>
      <td>6.959910</td>
      <td>6.892221</td>
      <td>6.510013</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.6</td>
      <td>6.6</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.4</td>
      <td>7.7</td>
      <td>7.4</td>
      <td>8.2</td>
      <td>8.5</td>
      <td>8.4</td>
      <td>7.8</td>
    </tr>
    <tr>
      <th>35</th>
      <td>North Dakota</td>
      <td>5.423443</td>
      <td>5.682319</td>
      <td>5.761240</td>
      <td>5.955522</td>
      <td>6.172326</td>
      <td>6.300356</td>
      <td>6.340952</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.5</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.8</td>
      <td>6.9</td>
      <td>7.1</td>
      <td>6.8</td>
      <td>6.5</td>
      <td>7.2</td>
      <td>6.6</td>
      <td>7.1</td>
      <td>7.5</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Ohio</td>
      <td>5.329324</td>
      <td>5.617035</td>
      <td>5.821192</td>
      <td>5.956154</td>
      <td>5.905580</td>
      <td>5.751515</td>
      <td>5.708936</td>
      <td>5.8</td>
      <td>5.9</td>
      <td>5.8</td>
      <td>5.8</td>
      <td>6.0</td>
      <td>6.1</td>
      <td>6.3</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>7.0</td>
      <td>7.2</td>
      <td>7.8</td>
      <td>7.8</td>
      <td>8.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Oklahoma</td>
      <td>6.336918</td>
      <td>6.371924</td>
      <td>6.815296</td>
      <td>6.678882</td>
      <td>7.418945</td>
      <td>7.075203</td>
      <td>7.083371</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.2</td>
      <td>6.9</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>6.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>6.8</td>
      <td>8.6</td>
      <td>10.6</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Oregon</td>
      <td>5.991839</td>
      <td>6.322075</td>
      <td>6.660993</td>
      <td>6.859226</td>
      <td>6.887356</td>
      <td>6.834097</td>
      <td>6.334755</td>
      <td>6.6</td>
      <td>6.6</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.9</td>
      <td>7.2</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>8.1</td>
      <td>7.2</td>
      <td>7.1</td>
      <td>7.5</td>
      <td>7.6</td>
      <td>7.6</td>
      <td>8.1</td>
      <td>8.9</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Pennsylvania</td>
      <td>5.351512</td>
      <td>5.545691</td>
      <td>5.724399</td>
      <td>5.778683</td>
      <td>5.684592</td>
      <td>5.842870</td>
      <td>5.432291</td>
      <td>5.5</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.5</td>
      <td>5.7</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>5.9</td>
      <td>5.9</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>6.0</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>7.1</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Rhode Island</td>
      <td>6.149934</td>
      <td>6.297083</td>
      <td>6.767399</td>
      <td>6.710361</td>
      <td>6.353321</td>
      <td>6.669996</td>
      <td>6.212964</td>
      <td>6.1</td>
      <td>6.0</td>
      <td>5.8</td>
      <td>5.9</td>
      <td>6.1</td>
      <td>6.4</td>
      <td>6.6</td>
      <td>7.0</td>
      <td>7.7</td>
      <td>7.8</td>
      <td>7.8</td>
      <td>8.1</td>
      <td>7.6</td>
      <td>7.5</td>
      <td>7.3</td>
      <td>8.1</td>
    </tr>
    <tr>
      <th>41</th>
      <td>South Carolina</td>
      <td>6.288172</td>
      <td>6.585398</td>
      <td>7.034316</td>
      <td>6.632979</td>
      <td>7.498347</td>
      <td>7.624033</td>
      <td>7.142021</td>
      <td>7.4</td>
      <td>7.2</td>
      <td>7.4</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.9</td>
      <td>7.8</td>
      <td>8.3</td>
      <td>8.2</td>
      <td>9.0</td>
      <td>9.3</td>
      <td>9.9</td>
      <td>10.6</td>
      <td>10.2</td>
      <td>11.9</td>
      <td>15.9</td>
    </tr>
    <tr>
      <th>42</th>
      <td>South Dakota</td>
      <td>6.144741</td>
      <td>6.535674</td>
      <td>6.742819</td>
      <td>7.247063</td>
      <td>7.214005</td>
      <td>7.073578</td>
      <td>7.005754</td>
      <td>7.5</td>
      <td>7.5</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.7</td>
      <td>7.8</td>
      <td>8.0</td>
      <td>8.4</td>
      <td>8.4</td>
      <td>8.4</td>
      <td>8.8</td>
      <td>8.9</td>
      <td>9.4</td>
      <td>9.1</td>
      <td>9.9</td>
      <td>11.1</td>
    </tr>
    <tr>
      <th>43</th>
      <td>Tennessee</td>
      <td>7.488753</td>
      <td>7.951096</td>
      <td>8.234385</td>
      <td>8.614092</td>
      <td>8.502342</td>
      <td>8.409229</td>
      <td>8.447843</td>
      <td>8.8</td>
      <td>9.0</td>
      <td>8.8</td>
      <td>8.4</td>
      <td>9.4</td>
      <td>10.1</td>
      <td>10.6</td>
      <td>10.9</td>
      <td>11.4</td>
      <td>11.9</td>
      <td>13.1</td>
      <td>13.5</td>
      <td>15.5</td>
      <td>14.7</td>
      <td>15.5</td>
      <td>13.9</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Texas</td>
      <td>4.867898</td>
      <td>6.121488</td>
      <td>7.096127</td>
      <td>7.077625</td>
      <td>7.214466</td>
      <td>6.851589</td>
      <td>6.976356</td>
      <td>7.3</td>
      <td>7.1</td>
      <td>7.1</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>7.4</td>
      <td>7.6</td>
      <td>7.8</td>
      <td>8.0</td>
      <td>8.1</td>
      <td>8.4</td>
      <td>9.1</td>
      <td>9.4</td>
      <td>9.1</td>
      <td>9.9</td>
      <td>10.5</td>
    </tr>
    <tr>
      <th>45</th>
      <td>Utah</td>
      <td>8.058122</td>
      <td>8.355306</td>
      <td>8.720650</td>
      <td>8.990183</td>
      <td>8.075986</td>
      <td>7.317947</td>
      <td>7.503606</td>
      <td>8.4</td>
      <td>8.6</td>
      <td>8.5</td>
      <td>8.4</td>
      <td>9.0</td>
      <td>9.6</td>
      <td>9.2</td>
      <td>9.8</td>
      <td>9.9</td>
      <td>10.2</td>
      <td>10.4</td>
      <td>10.2</td>
      <td>10.8</td>
      <td>9.6</td>
      <td>10.7</td>
      <td>11.2</td>
    </tr>
    <tr>
      <th>46</th>
      <td>Vermont</td>
      <td>7.726098</td>
      <td>7.943490</td>
      <td>7.908193</td>
      <td>8.299792</td>
      <td>8.124056</td>
      <td>8.698261</td>
      <td>9.155323</td>
      <td>8.2</td>
      <td>8.3</td>
      <td>9.3</td>
      <td>8.7</td>
      <td>7.9</td>
      <td>8.5</td>
      <td>8.6</td>
      <td>8.9</td>
      <td>9.4</td>
      <td>9.7</td>
      <td>9.8</td>
      <td>9.8</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.3</td>
      <td>10.9</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Virginia</td>
      <td>6.128508</td>
      <td>6.398452</td>
      <td>6.783573</td>
      <td>6.988628</td>
      <td>6.980323</td>
      <td>6.744421</td>
      <td>6.657785</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>6.9</td>
      <td>7.2</td>
      <td>7.5</td>
      <td>7.8</td>
      <td>8.2</td>
      <td>8.3</td>
      <td>8.4</td>
      <td>8.6</td>
      <td>8.8</td>
      <td>8.8</td>
      <td>9.2</td>
      <td>10.2</td>
      <td>11.4</td>
    </tr>
    <tr>
      <th>48</th>
      <td>Washington</td>
      <td>5.749260</td>
      <td>6.023947</td>
      <td>6.246909</td>
      <td>6.235593</td>
      <td>6.219361</td>
      <td>6.956141</td>
      <td>7.110330</td>
      <td>6.3</td>
      <td>6.1</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>6.3</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>7.2</td>
      <td>7.7</td>
      <td>9.5</td>
    </tr>
    <tr>
      <th>49</th>
      <td>West Virginia</td>
      <td>5.978862</td>
      <td>6.067010</td>
      <td>6.311620</td>
      <td>6.354097</td>
      <td>6.574923</td>
      <td>6.669095</td>
      <td>6.644002</td>
      <td>7.0</td>
      <td>7.2</td>
      <td>6.7</td>
      <td>6.7</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.4</td>
      <td>7.5</td>
      <td>7.5</td>
      <td>8.1</td>
      <td>7.9</td>
      <td>8.7</td>
      <td>7.5</td>
      <td>6.1</td>
      <td>7.2</td>
    </tr>
    <tr>
      <th>50</th>
      <td>Wisconsin</td>
      <td>5.037240</td>
      <td>5.430056</td>
      <td>5.634561</td>
      <td>5.616134</td>
      <td>5.611351</td>
      <td>5.691296</td>
      <td>5.219136</td>
      <td>5.4</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>6.0</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>6.2</td>
      <td>6.3</td>
      <td>6.5</td>
      <td>6.7</td>
      <td>6.7</td>
      <td>7.0</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Wyoming</td>
      <td>7.008098</td>
      <td>7.051652</td>
      <td>7.125657</td>
      <td>7.079407</td>
      <td>7.341663</td>
      <td>7.658952</td>
      <td>7.549883</td>
      <td>7.6</td>
      <td>7.8</td>
      <td>7.6</td>
      <td>8.0</td>
      <td>8.6</td>
      <td>9.0</td>
      <td>9.3</td>
      <td>9.3</td>
      <td>9.3</td>
      <td>9.3</td>
      <td>9.5</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>9.9</td>
      <td>10.6</td>
      <td>10.7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># replace nan&#39;s with column median</span>
<span class="n">data</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/93/6sy7vf8142969b_8w873sxcc0000gn/T/ipykernel_19313/3337134897.py:2: FutureWarning: The default value of numeric_only in DataFrame.median is deprecated. In a future version, it will default to False. In addition, specifying &#39;numeric_only=None&#39; is deprecated. Select only valid columns or specify the value of numeric_only to silence this warning.
  data.fillna(data.median(), inplace=True)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>2019</th>
      <th>2018</th>
      <th>2017</th>
      <th>2016</th>
      <th>2015</th>
      <th>2014</th>
      <th>2013</th>
      <th>2012</th>
      <th>2011</th>
      <th>2010</th>
      <th>2009</th>
      <th>2008</th>
      <th>2007</th>
      <th>2006</th>
      <th>2005</th>
      <th>2004</th>
      <th>2003</th>
      <th>2002</th>
      <th>2001</th>
      <th>2000</th>
      <th>1999</th>
      <th>1995</th>
      <th>1990</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Alabama</td>
      <td>6.697687</td>
      <td>6.760408</td>
      <td>7.047340</td>
      <td>7.147821</td>
      <td>7.351544</td>
      <td>7.806776</td>
      <td>7.817785</td>
      <td>8.2</td>
      <td>8.4</td>
      <td>8.2</td>
      <td>8.3</td>
      <td>8.6</td>
      <td>8.9</td>
      <td>9.2</td>
      <td>9.2</td>
      <td>9.4</td>
      <td>9.6</td>
      <td>9.9</td>
      <td>9.4</td>
      <td>10.10</td>
      <td>10.8</td>
      <td>9.8</td>
      <td>10.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alaska</td>
      <td>6.512245</td>
      <td>6.683952</td>
      <td>6.914078</td>
      <td>7.103441</td>
      <td>7.407588</td>
      <td>7.508836</td>
      <td>7.293928</td>
      <td>7.2</td>
      <td>7.8</td>
      <td>8.0</td>
      <td>7.8</td>
      <td>8.4</td>
      <td>8.5</td>
      <td>8.2</td>
      <td>8.2</td>
      <td>8.5</td>
      <td>8.1</td>
      <td>8.3</td>
      <td>8.1</td>
      <td>8.90</td>
      <td>8.6</td>
      <td>9.0</td>
      <td>10.2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arizona</td>
      <td>5.302995</td>
      <td>5.534434</td>
      <td>5.834867</td>
      <td>5.930541</td>
      <td>5.922469</td>
      <td>5.780449</td>
      <td>5.401091</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>5.6</td>
      <td>6.0</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.5</td>
      <td>6.7</td>
      <td>7.6</td>
      <td>7.50</td>
      <td>8.2</td>
      <td>8.8</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Arkansas</td>
      <td>8.377284</td>
      <td>8.863156</td>
      <td>9.456845</td>
      <td>9.860962</td>
      <td>10.040279</td>
      <td>10.112026</td>
      <td>9.751052</td>
      <td>10.9</td>
      <td>10.4</td>
      <td>10.8</td>
      <td>10.7</td>
      <td>10.6</td>
      <td>12.0</td>
      <td>12.4</td>
      <td>12.9</td>
      <td>13.4</td>
      <td>13.4</td>
      <td>14.3</td>
      <td>14.3</td>
      <td>15.40</td>
      <td>14.8</td>
      <td>14.4</td>
      <td>15.3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>California 1</td>
      <td>5.723191</td>
      <td>6.035132</td>
      <td>6.278250</td>
      <td>6.463590</td>
      <td>6.184957</td>
      <td>6.441492</td>
      <td>6.460467</td>
      <td>6.0</td>
      <td>5.8</td>
      <td>5.8</td>
      <td>5.8</td>
      <td>6.7</td>
      <td>6.2</td>
      <td>6.3</td>
      <td>6.4</td>
      <td>6.4</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>6.5</td>
      <td>5.80</td>
      <td>6.4</td>
      <td>6.3</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Colorado</td>
      <td>7.273297</td>
      <td>7.585728</td>
      <td>7.333845</td>
      <td>7.425443</td>
      <td>6.791807</td>
      <td>7.061603</td>
      <td>6.452664</td>
      <td>6.8</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.4</td>
      <td>7.1</td>
      <td>7.2</td>
      <td>7.6</td>
      <td>7.4</td>
      <td>7.8</td>
      <td>8.0</td>
      <td>8.2</td>
      <td>8.30</td>
      <td>8.2</td>
      <td>9.0</td>
      <td>9.8</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Connecticut</td>
      <td>5.048401</td>
      <td>5.278133</td>
      <td>5.553784</td>
      <td>5.617858</td>
      <td>5.292009</td>
      <td>5.368845</td>
      <td>5.021023</td>
      <td>5.2</td>
      <td>5.5</td>
      <td>5.6</td>
      <td>5.9</td>
      <td>5.4</td>
      <td>5.5</td>
      <td>5.5</td>
      <td>5.8</td>
      <td>5.8</td>
      <td>5.5</td>
      <td>5.7</td>
      <td>5.4</td>
      <td>5.70</td>
      <td>5.8</td>
      <td>6.6</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Delaware</td>
      <td>4.951919</td>
      <td>5.237957</td>
      <td>5.528417</td>
      <td>5.613062</td>
      <td>5.712872</td>
      <td>6.022783</td>
      <td>6.571976</td>
      <td>5.8</td>
      <td>5.2</td>
      <td>5.2</td>
      <td>5.4</td>
      <td>5.5</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>5.9</td>
      <td>6.1</td>
      <td>6.0</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.50</td>
      <td>6.7</td>
      <td>7.3</td>
      <td>8.4</td>
    </tr>
    <tr>
      <th>9</th>
      <td>District of Columbia</td>
      <td>7.773302</td>
      <td>7.835377</td>
      <td>8.239526</td>
      <td>8.149214</td>
      <td>8.220425</td>
      <td>11.821343</td>
      <td>10.791261</td>
      <td>8.4</td>
      <td>8.7</td>
      <td>7.6</td>
      <td>4.7</td>
      <td>4.1</td>
      <td>4.2</td>
      <td>4.0</td>
      <td>4.1</td>
      <td>5.2</td>
      <td>5.1</td>
      <td>5.1</td>
      <td>6.2</td>
      <td>4.90</td>
      <td>6.6</td>
      <td>6.1</td>
      <td>8.2</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Florida</td>
      <td>7.070065</td>
      <td>7.332063</td>
      <td>7.806895</td>
      <td>8.125967</td>
      <td>8.234362</td>
      <td>7.301404</td>
      <td>7.009614</td>
      <td>7.2</td>
      <td>7.4</td>
      <td>7.3</td>
      <td>7.5</td>
      <td>8.0</td>
      <td>8.5</td>
      <td>8.6</td>
      <td>8.9</td>
      <td>9.0</td>
      <td>9.0</td>
      <td>9.4</td>
      <td>9.3</td>
      <td>8.90</td>
      <td>8.7</td>
      <td>9.9</td>
      <td>10.9</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Georgia</td>
      <td>6.038471</td>
      <td>6.391479</td>
      <td>6.870975</td>
      <td>6.753976</td>
      <td>6.200379</td>
      <td>6.892587</td>
      <td>6.769738</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>7.3</td>
      <td>6.6</td>
      <td>6.0</td>
      <td>6.8</td>
      <td>7.3</td>
      <td>7.0</td>
      <td>7.9</td>
      <td>7.0</td>
      <td>6.5</td>
      <td>6.1</td>
      <td>6.80</td>
      <td>7.8</td>
      <td>8.4</td>
      <td>10.3</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Hawaii</td>
      <td>14.172891</td>
      <td>15.263736</td>
      <td>15.346702</td>
      <td>15.555557</td>
      <td>15.940173</td>
      <td>17.702656</td>
      <td>16.294245</td>
      <td>17.5</td>
      <td>17.6</td>
      <td>17.6</td>
      <td>17.2</td>
      <td>19.1</td>
      <td>20.8</td>
      <td>21.9</td>
      <td>22.6</td>
      <td>22.6</td>
      <td>22.0</td>
      <td>20.8</td>
      <td>19.6</td>
      <td>20.60</td>
      <td>18.9</td>
      <td>15.7</td>
      <td>16.4</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Idaho</td>
      <td>7.389770</td>
      <td>7.810362</td>
      <td>7.796997</td>
      <td>8.077759</td>
      <td>8.151402</td>
      <td>8.366045</td>
      <td>8.178590</td>
      <td>8.2</td>
      <td>8.6</td>
      <td>8.8</td>
      <td>8.9</td>
      <td>9.5</td>
      <td>10.0</td>
      <td>10.1</td>
      <td>10.5</td>
      <td>10.8</td>
      <td>10.9</td>
      <td>11.0</td>
      <td>11.2</td>
      <td>10.80</td>
      <td>12.1</td>
      <td>13.1</td>
      <td>13.9</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Illinois</td>
      <td>5.162794</td>
      <td>5.478499</td>
      <td>5.982023</td>
      <td>5.800000</td>
      <td>5.880873</td>
      <td>6.169054</td>
      <td>5.394059</td>
      <td>5.8</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>5.9</td>
      <td>6.2</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>7.2</td>
      <td>6.90</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>8.8</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Indiana</td>
      <td>6.176270</td>
      <td>6.554662</td>
      <td>6.854694</td>
      <td>6.935419</td>
      <td>6.856525</td>
      <td>7.080040</td>
      <td>6.607464</td>
      <td>6.7</td>
      <td>6.8</td>
      <td>6.3</td>
      <td>7.9</td>
      <td>8.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>7.8</td>
      <td>7.1</td>
      <td>7.9</td>
      <td>7.9</td>
      <td>7.90</td>
      <td>8.1</td>
      <td>8.6</td>
      <td>9.6</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Iowa</td>
      <td>5.403684</td>
      <td>5.737696</td>
      <td>6.176028</td>
      <td>6.149566</td>
      <td>6.255004</td>
      <td>6.863899</td>
      <td>7.390914</td>
      <td>6.8</td>
      <td>6.7</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>7.1</td>
      <td>6.90</td>
      <td>7.9</td>
      <td>7.7</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Kansas</td>
      <td>5.341683</td>
      <td>5.366984</td>
      <td>5.970225</td>
      <td>6.210941</td>
      <td>5.936515</td>
      <td>6.101884</td>
      <td>5.984540</td>
      <td>6.3</td>
      <td>6.3</td>
      <td>6.4</td>
      <td>6.4</td>
      <td>6.7</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>7.3</td>
      <td>7.5</td>
      <td>8.30</td>
      <td>7.1</td>
      <td>8.5</td>
      <td>9.2</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Kentucky</td>
      <td>6.265454</td>
      <td>6.774234</td>
      <td>7.174146</td>
      <td>7.379354</td>
      <td>7.172506</td>
      <td>6.941724</td>
      <td>7.278692</td>
      <td>7.2</td>
      <td>7.5</td>
      <td>7.4</td>
      <td>7.6</td>
      <td>7.9</td>
      <td>7.8</td>
      <td>8.4</td>
      <td>8.7</td>
      <td>8.8</td>
      <td>9.1</td>
      <td>9.0</td>
      <td>9.0</td>
      <td>9.80</td>
      <td>10.9</td>
      <td>12.2</td>
      <td>13.5</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Louisiana</td>
      <td>5.094870</td>
      <td>5.118908</td>
      <td>5.592472</td>
      <td>6.106373</td>
      <td>6.777108</td>
      <td>6.892953</td>
      <td>6.370812</td>
      <td>5.7</td>
      <td>6.4</td>
      <td>6.9</td>
      <td>7.1</td>
      <td>6.8</td>
      <td>7.5</td>
      <td>7.1</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.2</td>
      <td>8.1</td>
      <td>8.4</td>
      <td>9.10</td>
      <td>9.1</td>
      <td>9.3</td>
      <td>9.6</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Maine</td>
      <td>7.053203</td>
      <td>7.390145</td>
      <td>7.585857</td>
      <td>7.640376</td>
      <td>7.610612</td>
      <td>7.745346</td>
      <td>8.310610</td>
      <td>7.3</td>
      <td>7.2</td>
      <td>7.1</td>
      <td>7.1</td>
      <td>7.4</td>
      <td>7.4</td>
      <td>7.8</td>
      <td>8.2</td>
      <td>8.6</td>
      <td>8.4</td>
      <td>8.4</td>
      <td>8.6</td>
      <td>8.80</td>
      <td>8.6</td>
      <td>8.7</td>
      <td>9.7</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Maryland</td>
      <td>5.592919</td>
      <td>5.867393</td>
      <td>6.268158</td>
      <td>6.308374</td>
      <td>6.187233</td>
      <td>6.461575</td>
      <td>6.823793</td>
      <td>5.6</td>
      <td>5.8</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>5.9</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.1</td>
      <td>7.0</td>
      <td>7.50</td>
      <td>7.5</td>
      <td>8.4</td>
      <td>9.7</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Massachusetts</td>
      <td>5.019222</td>
      <td>6.269931</td>
      <td>5.749423</td>
      <td>5.777052</td>
      <td>5.497009</td>
      <td>5.604850</td>
      <td>5.501415</td>
      <td>5.5</td>
      <td>5.5</td>
      <td>5.6</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>5.9</td>
      <td>6.2</td>
      <td>6.5</td>
      <td>5.6</td>
      <td>5.9</td>
      <td>6.2</td>
      <td>5.80</td>
      <td>6.2</td>
      <td>7.1</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Michigan</td>
      <td>5.183913</td>
      <td>5.678220</td>
      <td>5.887088</td>
      <td>5.935155</td>
      <td>5.984938</td>
      <td>5.759103</td>
      <td>5.812267</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.5</td>
      <td>5.4</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>6.3</td>
      <td>6.5</td>
      <td>6.7</td>
      <td>6.70</td>
      <td>6.8</td>
      <td>7.3</td>
      <td>8.2</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Minnesota</td>
      <td>5.074090</td>
      <td>5.304589</td>
      <td>5.611836</td>
      <td>5.617984</td>
      <td>5.578555</td>
      <td>5.895727</td>
      <td>5.998288</td>
      <td>5.6</td>
      <td>5.6</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.4</td>
      <td>5.8</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>6.3</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.80</td>
      <td>6.8</td>
      <td>7.0</td>
      <td>7.7</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Mississippi</td>
      <td>6.018516</td>
      <td>6.282877</td>
      <td>6.720619</td>
      <td>7.013691</td>
      <td>6.993874</td>
      <td>6.930345</td>
      <td>6.715684</td>
      <td>5.8</td>
      <td>4.9</td>
      <td>4.9</td>
      <td>4.8</td>
      <td>5.1</td>
      <td>5.4</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.90</td>
      <td>7.8</td>
      <td>7.9</td>
      <td>9.4</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Missouri</td>
      <td>5.969276</td>
      <td>6.478791</td>
      <td>6.594551</td>
      <td>6.851633</td>
      <td>6.800000</td>
      <td>6.725225</td>
      <td>6.449851</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.8</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>7.1</td>
      <td>7.2</td>
      <td>7.3</td>
      <td>7.5</td>
      <td>7.80</td>
      <td>8.1</td>
      <td>8.3</td>
      <td>9.6</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Montana</td>
      <td>7.886577</td>
      <td>7.713416</td>
      <td>7.963880</td>
      <td>7.840617</td>
      <td>7.962639</td>
      <td>7.857723</td>
      <td>7.398797</td>
      <td>7.8</td>
      <td>7.8</td>
      <td>7.4</td>
      <td>7.3</td>
      <td>7.6</td>
      <td>7.5</td>
      <td>7.4</td>
      <td>7.4</td>
      <td>7.5</td>
      <td>7.2</td>
      <td>7.1</td>
      <td>7.1</td>
      <td>7.30</td>
      <td>7.4</td>
      <td>7.6</td>
      <td>8.6</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Nebraska</td>
      <td>5.498323</td>
      <td>5.976878</td>
      <td>6.313813</td>
      <td>6.465784</td>
      <td>6.378053</td>
      <td>6.415084</td>
      <td>6.294835</td>
      <td>6.7</td>
      <td>6.6</td>
      <td>6.6</td>
      <td>6.6</td>
      <td>6.9</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>7.0</td>
      <td>7.1</td>
      <td>7.0</td>
      <td>7.5</td>
      <td>7.9</td>
      <td>7.60</td>
      <td>7.5</td>
      <td>7.3</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Nevada</td>
      <td>25.894792</td>
      <td>26.734186</td>
      <td>28.556333</td>
      <td>28.392297</td>
      <td>31.017920</td>
      <td>31.850950</td>
      <td>32.280147</td>
      <td>35.1</td>
      <td>36.9</td>
      <td>38.3</td>
      <td>40.3</td>
      <td>42.3</td>
      <td>48.6</td>
      <td>52.1</td>
      <td>57.4</td>
      <td>62.1</td>
      <td>63.9</td>
      <td>67.4</td>
      <td>69.6</td>
      <td>72.20</td>
      <td>82.3</td>
      <td>85.2</td>
      <td>99.0</td>
    </tr>
    <tr>
      <th>30</th>
      <td>New Hampshire</td>
      <td>6.637440</td>
      <td>6.932762</td>
      <td>7.030857</td>
      <td>6.977101</td>
      <td>6.938182</td>
      <td>7.187147</td>
      <td>6.901612</td>
      <td>6.8</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>6.5</td>
      <td>6.8</td>
      <td>7.1</td>
      <td>7.2</td>
      <td>7.3</td>
      <td>8.0</td>
      <td>8.1</td>
      <td>8.3</td>
      <td>8.5</td>
      <td>9.40</td>
      <td>7.9</td>
      <td>8.3</td>
      <td>9.5</td>
    </tr>
    <tr>
      <th>31</th>
      <td>New Jersey</td>
      <td>5.187009</td>
      <td>5.367783</td>
      <td>5.450804</td>
      <td>5.654780</td>
      <td>5.606042</td>
      <td>5.403116</td>
      <td>5.130831</td>
      <td>4.9</td>
      <td>4.8</td>
      <td>5.1</td>
      <td>5.0</td>
      <td>5.4</td>
      <td>5.4</td>
      <td>5.5</td>
      <td>5.7</td>
      <td>5.9</td>
      <td>5.8</td>
      <td>6.0</td>
      <td>6.4</td>
      <td>6.00</td>
      <td>5.9</td>
      <td>6.5</td>
      <td>7.6</td>
    </tr>
    <tr>
      <th>32</th>
      <td>New Mexico</td>
      <td>5.981413</td>
      <td>6.449279</td>
      <td>5.925568</td>
      <td>6.366124</td>
      <td>6.171860</td>
      <td>8.080277</td>
      <td>7.255596</td>
      <td>6.9</td>
      <td>8.0</td>
      <td>7.7</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>5.6</td>
      <td>6.8</td>
      <td>6.6</td>
      <td>7.4</td>
      <td>6.9</td>
      <td>7.9</td>
      <td>7.6</td>
      <td>8.00</td>
      <td>8.0</td>
      <td>8.8</td>
      <td>8.8</td>
    </tr>
    <tr>
      <th>33</th>
      <td>New York</td>
      <td>7.217085</td>
      <td>7.106515</td>
      <td>7.344656</td>
      <td>7.451752</td>
      <td>7.056096</td>
      <td>6.689784</td>
      <td>6.890139</td>
      <td>7.0</td>
      <td>6.9</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.8</td>
      <td>6.9</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>7.3</td>
      <td>7.6</td>
      <td>7.10</td>
      <td>7.3</td>
      <td>8.0</td>
      <td>8.6</td>
    </tr>
    <tr>
      <th>34</th>
      <td>North Carolina</td>
      <td>6.181491</td>
      <td>6.433883</td>
      <td>6.846406</td>
      <td>6.967624</td>
      <td>6.959910</td>
      <td>6.892221</td>
      <td>6.510013</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.6</td>
      <td>6.6</td>
      <td>6.9</td>
      <td>7.0</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.4</td>
      <td>7.7</td>
      <td>7.4</td>
      <td>8.20</td>
      <td>8.5</td>
      <td>8.4</td>
      <td>7.8</td>
    </tr>
    <tr>
      <th>35</th>
      <td>North Dakota</td>
      <td>5.423443</td>
      <td>5.682319</td>
      <td>5.761240</td>
      <td>5.955522</td>
      <td>6.172326</td>
      <td>6.300356</td>
      <td>6.340952</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.5</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>6.8</td>
      <td>6.9</td>
      <td>7.1</td>
      <td>6.8</td>
      <td>6.5</td>
      <td>7.20</td>
      <td>6.6</td>
      <td>7.1</td>
      <td>7.5</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Ohio</td>
      <td>5.329324</td>
      <td>5.617035</td>
      <td>5.821192</td>
      <td>5.956154</td>
      <td>5.905580</td>
      <td>5.751515</td>
      <td>5.708936</td>
      <td>5.8</td>
      <td>5.9</td>
      <td>5.8</td>
      <td>5.8</td>
      <td>6.0</td>
      <td>6.1</td>
      <td>6.3</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.7</td>
      <td>7.0</td>
      <td>7.2</td>
      <td>7.80</td>
      <td>7.8</td>
      <td>8.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Oklahoma</td>
      <td>6.336918</td>
      <td>6.371924</td>
      <td>6.815296</td>
      <td>6.678882</td>
      <td>7.418945</td>
      <td>7.075203</td>
      <td>7.083371</td>
      <td>6.9</td>
      <td>6.9</td>
      <td>7.2</td>
      <td>6.9</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>6.5</td>
      <td>7.2</td>
      <td>7.6</td>
      <td>7.6</td>
      <td>7.85</td>
      <td>6.8</td>
      <td>8.6</td>
      <td>10.6</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Oregon</td>
      <td>5.991839</td>
      <td>6.322075</td>
      <td>6.660993</td>
      <td>6.859226</td>
      <td>6.887356</td>
      <td>6.834097</td>
      <td>6.334755</td>
      <td>6.6</td>
      <td>6.6</td>
      <td>6.5</td>
      <td>6.6</td>
      <td>6.9</td>
      <td>7.2</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>8.1</td>
      <td>7.2</td>
      <td>7.1</td>
      <td>7.5</td>
      <td>7.60</td>
      <td>7.6</td>
      <td>8.1</td>
      <td>8.9</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Pennsylvania</td>
      <td>5.351512</td>
      <td>5.545691</td>
      <td>5.724399</td>
      <td>5.778683</td>
      <td>5.684592</td>
      <td>5.842870</td>
      <td>5.432291</td>
      <td>5.5</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.5</td>
      <td>5.7</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>5.9</td>
      <td>5.9</td>
      <td>5.7</td>
      <td>5.8</td>
      <td>6.00</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>7.1</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Rhode Island</td>
      <td>6.149934</td>
      <td>6.297083</td>
      <td>6.767399</td>
      <td>6.710361</td>
      <td>6.353321</td>
      <td>6.669996</td>
      <td>6.212964</td>
      <td>6.1</td>
      <td>6.0</td>
      <td>5.8</td>
      <td>5.9</td>
      <td>6.1</td>
      <td>6.4</td>
      <td>6.6</td>
      <td>7.0</td>
      <td>7.7</td>
      <td>7.8</td>
      <td>7.8</td>
      <td>8.1</td>
      <td>7.60</td>
      <td>7.5</td>
      <td>7.3</td>
      <td>8.1</td>
    </tr>
    <tr>
      <th>41</th>
      <td>South Carolina</td>
      <td>6.288172</td>
      <td>6.585398</td>
      <td>7.034316</td>
      <td>6.632979</td>
      <td>7.498347</td>
      <td>7.624033</td>
      <td>7.142021</td>
      <td>7.4</td>
      <td>7.2</td>
      <td>7.4</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.9</td>
      <td>7.8</td>
      <td>8.3</td>
      <td>8.2</td>
      <td>9.0</td>
      <td>9.3</td>
      <td>9.9</td>
      <td>10.60</td>
      <td>10.2</td>
      <td>11.9</td>
      <td>15.9</td>
    </tr>
    <tr>
      <th>42</th>
      <td>South Dakota</td>
      <td>6.144741</td>
      <td>6.535674</td>
      <td>6.742819</td>
      <td>7.247063</td>
      <td>7.214005</td>
      <td>7.073578</td>
      <td>7.005754</td>
      <td>7.5</td>
      <td>7.5</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.7</td>
      <td>7.8</td>
      <td>8.0</td>
      <td>8.4</td>
      <td>8.4</td>
      <td>8.4</td>
      <td>8.8</td>
      <td>8.9</td>
      <td>9.40</td>
      <td>9.1</td>
      <td>9.9</td>
      <td>11.1</td>
    </tr>
    <tr>
      <th>43</th>
      <td>Tennessee</td>
      <td>7.488753</td>
      <td>7.951096</td>
      <td>8.234385</td>
      <td>8.614092</td>
      <td>8.502342</td>
      <td>8.409229</td>
      <td>8.447843</td>
      <td>8.8</td>
      <td>9.0</td>
      <td>8.8</td>
      <td>8.4</td>
      <td>9.4</td>
      <td>10.1</td>
      <td>10.6</td>
      <td>10.9</td>
      <td>11.4</td>
      <td>11.9</td>
      <td>13.1</td>
      <td>13.5</td>
      <td>15.50</td>
      <td>14.7</td>
      <td>15.5</td>
      <td>13.9</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Texas</td>
      <td>4.867898</td>
      <td>6.121488</td>
      <td>7.096127</td>
      <td>7.077625</td>
      <td>7.214466</td>
      <td>6.851589</td>
      <td>6.976356</td>
      <td>7.3</td>
      <td>7.1</td>
      <td>7.1</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>7.4</td>
      <td>7.6</td>
      <td>7.8</td>
      <td>8.0</td>
      <td>8.1</td>
      <td>8.4</td>
      <td>9.1</td>
      <td>9.40</td>
      <td>9.1</td>
      <td>9.9</td>
      <td>10.5</td>
    </tr>
    <tr>
      <th>45</th>
      <td>Utah</td>
      <td>8.058122</td>
      <td>8.355306</td>
      <td>8.720650</td>
      <td>8.990183</td>
      <td>8.075986</td>
      <td>7.317947</td>
      <td>7.503606</td>
      <td>8.4</td>
      <td>8.6</td>
      <td>8.5</td>
      <td>8.4</td>
      <td>9.0</td>
      <td>9.6</td>
      <td>9.2</td>
      <td>9.8</td>
      <td>9.9</td>
      <td>10.2</td>
      <td>10.4</td>
      <td>10.2</td>
      <td>10.80</td>
      <td>9.6</td>
      <td>10.7</td>
      <td>11.2</td>
    </tr>
    <tr>
      <th>46</th>
      <td>Vermont</td>
      <td>7.726098</td>
      <td>7.943490</td>
      <td>7.908193</td>
      <td>8.299792</td>
      <td>8.124056</td>
      <td>8.698261</td>
      <td>9.155323</td>
      <td>8.2</td>
      <td>8.3</td>
      <td>9.3</td>
      <td>8.7</td>
      <td>7.9</td>
      <td>8.5</td>
      <td>8.6</td>
      <td>8.9</td>
      <td>9.4</td>
      <td>9.7</td>
      <td>9.8</td>
      <td>9.8</td>
      <td>10.00</td>
      <td>10.0</td>
      <td>10.3</td>
      <td>10.9</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Virginia</td>
      <td>6.128508</td>
      <td>6.398452</td>
      <td>6.783573</td>
      <td>6.988628</td>
      <td>6.980323</td>
      <td>6.744421</td>
      <td>6.657785</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>6.8</td>
      <td>6.9</td>
      <td>7.2</td>
      <td>7.5</td>
      <td>7.8</td>
      <td>8.2</td>
      <td>8.3</td>
      <td>8.4</td>
      <td>8.6</td>
      <td>8.8</td>
      <td>8.80</td>
      <td>9.2</td>
      <td>10.2</td>
      <td>11.4</td>
    </tr>
    <tr>
      <th>48</th>
      <td>Washington</td>
      <td>5.749260</td>
      <td>6.023947</td>
      <td>6.246909</td>
      <td>6.235593</td>
      <td>6.219361</td>
      <td>6.956141</td>
      <td>7.110330</td>
      <td>6.3</td>
      <td>6.1</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>6.3</td>
      <td>6.4</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>6.5</td>
      <td>7.0</td>
      <td>6.90</td>
      <td>7.2</td>
      <td>7.7</td>
      <td>9.5</td>
    </tr>
    <tr>
      <th>49</th>
      <td>West Virginia</td>
      <td>5.978862</td>
      <td>6.067010</td>
      <td>6.311620</td>
      <td>6.354097</td>
      <td>6.574923</td>
      <td>6.669095</td>
      <td>6.644002</td>
      <td>7.0</td>
      <td>7.2</td>
      <td>6.7</td>
      <td>6.7</td>
      <td>7.1</td>
      <td>7.3</td>
      <td>7.3</td>
      <td>7.4</td>
      <td>7.5</td>
      <td>7.5</td>
      <td>8.1</td>
      <td>7.9</td>
      <td>8.70</td>
      <td>7.5</td>
      <td>6.1</td>
      <td>7.2</td>
    </tr>
    <tr>
      <th>50</th>
      <td>Wisconsin</td>
      <td>5.037240</td>
      <td>5.430056</td>
      <td>5.634561</td>
      <td>5.616134</td>
      <td>5.611351</td>
      <td>5.691296</td>
      <td>5.219136</td>
      <td>5.4</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.3</td>
      <td>5.6</td>
      <td>5.7</td>
      <td>6.0</td>
      <td>6.1</td>
      <td>6.2</td>
      <td>6.2</td>
      <td>6.3</td>
      <td>6.5</td>
      <td>6.70</td>
      <td>6.7</td>
      <td>7.0</td>
      <td>7.9</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Wyoming</td>
      <td>7.008098</td>
      <td>7.051652</td>
      <td>7.125657</td>
      <td>7.079407</td>
      <td>7.341663</td>
      <td>7.658952</td>
      <td>7.549883</td>
      <td>7.6</td>
      <td>7.8</td>
      <td>7.6</td>
      <td>8.0</td>
      <td>8.6</td>
      <td>9.0</td>
      <td>9.3</td>
      <td>9.3</td>
      <td>9.3</td>
      <td>9.3</td>
      <td>9.5</td>
      <td>10.0</td>
      <td>10.00</td>
      <td>9.9</td>
      <td>10.6</td>
      <td>10.7</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extract to matrices</span>
<span class="n">yearM</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">yearM</span>

<span class="n">statesM</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">statesM</span>

<span class="n">M</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 6.7 ,  6.76,  7.05, ..., 10.8 ,  9.8 , 10.6 ],
       [ 6.51,  6.68,  6.91, ...,  8.6 ,  9.  , 10.2 ],
       [ 5.3 ,  5.53,  5.83, ...,  8.2 ,  8.8 , 10.  ],
       ...,
       [ 5.98,  6.07,  6.31, ...,  7.5 ,  6.1 ,  7.2 ],
       [ 5.04,  5.43,  5.63, ...,  6.7 ,  7.  ,  7.9 ],
       [ 7.01,  7.05,  7.13, ...,  9.9 , 10.6 , 10.7 ]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make some plots</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yearM</span><span class="p">,</span><span class="n">M</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;M. rate (per 1k)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Marriage rates over time&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yearM</span><span class="p">,</span><span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;M. rate (per 1k)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;M. rate (z-norm)&#39;</span><span class="p">)</span>

<span class="c1"># notice that x-axis is non-constant</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yearM</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;ks-&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;M. rate (per 1k)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;State-average&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="c1"># QUESTION: Is this the same as the US average?</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;State index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/5e912b366222a4da31a28476647ae2353ddbd4a879a9054065da39fe2135403a.png" src="../../_images/5e912b366222a4da31a28476647ae2353ddbd4a879a9054065da39fe2135403a.png" />
<img alt="../../_images/d796363752266ec1a6cd2bc1c0d5d79a52d8abe41d08524e74cbb0c026d7c258.png" src="../../_images/d796363752266ec1a6cd2bc1c0d5d79a52d8abe41d08524e74cbb0c026d7c258.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># barplot of average marriage rate</span>

<span class="c1"># average over time</span>
<span class="n">meanMarriageRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># sort index</span>
<span class="n">sidx_M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">meanMarriageRate</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">statesM</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sidx_M</span><span class="p">],</span><span class="n">meanMarriageRate</span><span class="p">[</span><span class="n">sidx_M</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;M. rate (per 1k)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Marriage rates per state&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># QUESTION:</span>
<span class="c1">#   Is Nevada a non-representative datapoint or an error?</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/528e1db32fd9c71bdd1494a6f3353dc071cef822aa755baabf2c014b70864cc3.png" src="../../_images/528e1db32fd9c71bdd1494a6f3353dc071cef822aa755baabf2c014b70864cc3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># show the correlation matrix</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">T</span><span class="p">),</span><span class="n">vmin</span><span class="o">=</span><span class="mf">.9</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">yearM</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yearM</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">yearM</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">yearM</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/47e51b446b0d890c829f01f7c2b6734f3722e12efd8440bae2ea1c87e11fef8b.png" src="../../_images/47e51b446b0d890c829f01f7c2b6734f3722e12efd8440bae2ea1c87e11fef8b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># PCA</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>

<span class="c1"># scree plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">,</span><span class="s1">&#39;ks-&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Percent variance explained&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Component number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PCA scree plot of marriage data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="mi">100</span><span class="o">*</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0c8eb3321af0336a194c21384e677817be8bee85a75c9d46d17ee91870f7e0c7.png" src="../../_images/0c8eb3321af0336a194c21384e677817be8bee85a75c9d46d17ee91870f7e0c7.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([9.82644853e+01, 1.24490055e+00, 2.49245218e-01, 7.49731265e-02,
       4.35304225e-02, 2.51909291e-02, 2.12681736e-02, 1.91562974e-02,
       1.10117312e-02, 7.95298422e-03, 7.04976997e-03, 6.94643370e-03,
       6.04481631e-03, 4.38914561e-03, 2.92379416e-03, 2.73281029e-03,
       2.06630186e-03, 1.75529040e-03, 1.33063465e-03, 1.05079032e-03,
       9.15216526e-04, 7.86044827e-04, 2.94251694e-04])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">divorce_url</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">52</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="mi">56</span><span class="p">,</span><span class="mi">57</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;---&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">})</span>
<span class="n">data</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">yearD</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">statesD</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/93/6sy7vf8142969b_8w873sxcc0000gn/T/ipykernel_19313/4261053346.py:5: FutureWarning: The default value of numeric_only in DataFrame.median is deprecated. In a future version, it will default to False. In addition, specifying &#39;numeric_only=None&#39; is deprecated. Select only valid columns or specify the value of numeric_only to silence this warning.
  data.fillna(data.median(), inplace=True)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make some plots</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yearD</span><span class="p">,</span><span class="n">D</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;D. rate (per 1k)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Divorce rates over time&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yearD</span><span class="p">,</span><span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;D. rate (per 1k)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;D. rate (z-norm)&#39;</span><span class="p">)</span>

<span class="c1"># notice that x-axis is non-constant</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yearD</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;ks-&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;D. rate (per 1k)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;State-average&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">zscore</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;State index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>





<span class="c1"># barplot of average marriage rate</span>
<span class="n">meanDivorceRate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sidx_D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">meanDivorceRate</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">statesD</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sidx_D</span><span class="p">],</span><span class="n">meanDivorceRate</span><span class="p">[</span><span class="n">sidx_D</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;D. rate (per 1k)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Divorce rates per state&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>






<span class="c1"># show the correlation matrix</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">T</span><span class="p">),</span><span class="n">vmin</span><span class="o">=</span><span class="mf">.9</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">yearD</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yearD</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">yearD</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">yearD</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>





<span class="c1"># PCA</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>

<span class="c1"># scree plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">,</span><span class="s1">&#39;ks-&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Percent variance explained&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Component number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PCA scree plot of divorce data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/4999df72f209581b8f914fc3e423c5ca1dacec78d9797d0f99cc99e4b340deab.png" src="../../_images/4999df72f209581b8f914fc3e423c5ca1dacec78d9797d0f99cc99e4b340deab.png" />
<img alt="../../_images/473e9eac970586649cb97ad4a490ae9da1ee469ddb3033703944738ea488f41c.png" src="../../_images/473e9eac970586649cb97ad4a490ae9da1ee469ddb3033703944738ea488f41c.png" />
<img alt="../../_images/563f9123be9363ad75de3fbfcfbfb00a3d1c7b11e2a831a7dd8f4b718f25feee.png" src="../../_images/563f9123be9363ad75de3fbfcfbfb00a3d1c7b11e2a831a7dd8f4b718f25feee.png" />
<img alt="../../_images/82686eb8487842da046267b9a04c46d10161bcfa68864f3421bc48067c4f77ed.png" src="../../_images/82686eb8487842da046267b9a04c46d10161bcfa68864f3421bc48067c4f77ed.png" />
<img alt="../../_images/5e0b9808f3533ad1017e8d2b398daefdb61ef25a7a2c9e46678725a786262213.png" src="../../_images/5e0b9808f3533ad1017e8d2b398daefdb61ef25a7a2c9e46678725a786262213.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### check if marriage and divorce datasets have the same year/state order</span>

<span class="c1"># should be zero</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;Comparison of year vectors: &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yearD</span><span class="o">-</span><span class="n">yearM</span><span class="p">)</span> <span class="p">)</span>

<span class="c1"># should be TRUE</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;Comparison of states vectors: &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="n">statesM</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">statesD</span><span class="p">)</span> <span class="p">)</span>
<span class="c1"># ... uh oh...</span>

<span class="c1"># compare</span>
<span class="n">tmpStateNames</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">statesM</span><span class="p">,</span><span class="n">statesD</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmpStateNames</span><span class="p">)</span>

<span class="c1"># find the difference</span>
<span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tmpStateNames</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">tmpStateNames</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># btw, you can also correlate over states</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">D</span><span class="p">),</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">statesD</span><span class="p">)),</span><span class="n">labels</span><span class="o">=</span><span class="n">statesD</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">statesD</span><span class="p">)),</span><span class="n">labels</span><span class="o">=</span><span class="n">statesD</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/9a77e455db4fdb4c4281346989a671f408c6ce55efe39600f6b2a2e21d1ab0fd.png" src="../../_images/9a77e455db4fdb4c4281346989a671f408c6ce55efe39600f6b2a2e21d1ab0fd.png" />
</div>
</div>
<section id="now-for-some-inferential-statistics">
<h2>Now for some inferential statistics<a class="headerlink" href="#now-for-some-inferential-statistics" title="Permalink to this headline"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Correlate M and D over time per state</span>


<span class="c1"># Bonferroni corrected threshold</span>
<span class="n">pvalThresh</span> <span class="o">=</span> <span class="mf">.05</span><span class="o">/</span><span class="mi">51</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;rg&#39;</span>
<span class="k">for</span> <span class="n">si</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">statesM</span><span class="p">)):</span>
    
    <span class="c1"># compute correlation</span>
    <span class="n">r</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">si</span><span class="p">,:],</span><span class="n">D</span><span class="p">[</span><span class="n">si</span><span class="p">,:])</span>
    
    <span class="c1"># plot the data point</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">r</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="n">si</span><span class="p">,</span><span class="n">si</span><span class="p">],</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">si</span><span class="p">,</span><span class="s1">&#39;ks&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="nb">bool</span><span class="p">(</span><span class="n">p</span><span class="o">&lt;</span><span class="n">pvalThresh</span><span class="p">)])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Correlation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Marriage-divorce correlations per state&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">statesM</span><span class="p">)),</span><span class="n">labels</span><span class="o">=</span><span class="n">statesD</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span><span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">labelright</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">51</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">51</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/04a9bec23cbaaef0b420ca445d32a674bd7a08c59db916e5b9541d59f753b47e.png" src="../../_images/04a9bec23cbaaef0b420ca445d32a674bd7a08c59db916e5b9541d59f753b47e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># have marriage/divorce rates really declined over time?</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>


<span class="c1"># initialize slope differences vector</span>
<span class="n">MvsD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">statesM</span><span class="p">))</span>

<span class="k">for</span> <span class="n">rowi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">statesM</span><span class="p">)):</span>
    
    <span class="c1"># run regression (includes the intercept!)</span>
    <span class="n">bM</span><span class="p">,</span><span class="n">intercept</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">pM</span><span class="p">,</span><span class="n">seM</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">yearM</span><span class="p">,</span><span class="n">M</span><span class="p">[</span><span class="n">rowi</span><span class="p">,:])</span>
    <span class="n">bD</span><span class="p">,</span><span class="n">intercept</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">pD</span><span class="p">,</span><span class="n">seD</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">yearM</span><span class="p">,</span><span class="n">D</span><span class="p">[</span><span class="n">rowi</span><span class="p">,:])</span>
    
    <span class="c1"># normalize beta coefficients</span>
    <span class="n">bM</span> <span class="o">=</span> <span class="n">bM</span> <span class="o">/</span> <span class="n">seM</span>
    <span class="n">bD</span> <span class="o">=</span> <span class="n">bD</span> <span class="o">/</span> <span class="n">seD</span>
    
    <span class="c1"># plot the slope values</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">rowi</span><span class="p">,</span><span class="n">rowi</span><span class="p">],[</span><span class="n">bM</span><span class="p">,</span><span class="n">bD</span><span class="p">],</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rowi</span><span class="p">,</span><span class="n">bM</span><span class="p">,</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="nb">bool</span><span class="p">(</span><span class="n">pM</span><span class="o">&lt;</span><span class="n">pvalThresh</span><span class="p">)])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rowi</span><span class="p">,</span><span class="n">bD</span><span class="p">,</span><span class="s1">&#39;ks&#39;</span><span class="p">,</span><span class="n">markerfacecolor</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="nb">bool</span><span class="p">(</span><span class="n">pD</span><span class="o">&lt;</span><span class="n">pvalThresh</span><span class="p">)])</span>
    
    <span class="c1"># plot the slope differences</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">rowi</span><span class="p">,</span><span class="n">rowi</span><span class="p">],[</span><span class="n">bM</span><span class="o">-</span><span class="n">bD</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">.7</span><span class="p">,</span><span class="mf">.7</span><span class="p">,</span><span class="mf">.7</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">rowi</span><span class="p">,</span><span class="n">rowi</span><span class="p">],[</span><span class="n">bM</span><span class="o">-</span><span class="n">bD</span><span class="p">,</span><span class="n">bM</span><span class="o">-</span><span class="n">bD</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">.7</span><span class="p">,</span><span class="mf">.7</span><span class="p">,</span><span class="mf">.7</span><span class="p">])</span>
    
    <span class="c1"># store the slope differences for subsequent t-test</span>
    <span class="n">MvsD</span><span class="p">[</span><span class="n">rowi</span><span class="p">]</span> <span class="o">=</span> <span class="n">bM</span><span class="o">-</span><span class="n">bD</span>



<span class="c1"># make the plot look nicer</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">51</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">statesD</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">51</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">52</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Decrease per year (norm.)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\Delta$M - $\Delta$D&#39;</span><span class="p">)</span>



<span class="c1">### ttest on whether the M-vs-D rates are really different</span>
<span class="n">t</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_1samp</span><span class="p">(</span><span class="n">MvsD</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">MvsD</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>

<span class="c1"># set the title</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Marriage vs. divorce: t(</span><span class="si">%g</span><span class="s1">)=</span><span class="si">%g</span><span class="s1">, p=</span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">p</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/var/folders/93/6sy7vf8142969b_8w873sxcc0000gn/T/ipykernel_19313/3579887585.py:25: UserWarning: color is redundantly defined by the &#39;color&#39; keyword argument and the fmt string &quot;k-&quot; (-&gt; color=&#39;k&#39;). The keyword argument will take precedence.
  ax[1].plot([rowi,rowi],[bM-bD, 0],&#39;k-&#39;,color=[.7,.7,.7])
/var/folders/93/6sy7vf8142969b_8w873sxcc0000gn/T/ipykernel_19313/3579887585.py:26: UserWarning: color is redundantly defined by the &#39;color&#39; keyword argument and the fmt string &quot;ko&quot; (-&gt; color=&#39;k&#39;). The keyword argument will take precedence.
  ax[1].plot([rowi,rowi],[bM-bD,bM-bD],&#39;ko&#39;,color=[.7,.7,.7])
</pre></div>
</div>
<img alt="../../_images/574a0c3b35c0290ba879e87c39689c2a6474753f44e8acc4ea5f3d7b9a610646.png" src="../../_images/574a0c3b35c0290ba879e87c39689c2a6474753f44e8acc4ea5f3d7b9a610646.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./data_science/stats"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ds.html" class="btn btn-neutral float-left" title="Data Science" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../quantum_information/quantum_mechanics/quantum_mechanics.html" class="btn btn-neutral float-right" title="Quantum Mechanics" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>